title:如何实现一个基本的微信文章分类器
create_date:2018/04/04
praise_nums:1
fav_nums:1
comments_nums:0
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113691 post type-post status-publish format-standard hentry category-it-tech tag-5725 tag-machinelearning odd" id="post-113691">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>如何实现一个基本的微信文章分类器</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/04/04 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
            

            
             ·  <a href="http://blog.jobbole.com/tag/%e6%96%87%e6%9c%ac%e5%88%86%e7%b1%bb/">文本分类</a>, <a href="http://blog.jobbole.com/tag/machinelearning/">机器学习</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">本文作者： <a href="http://blog.jobbole.com">伯乐在线</a> - <a href="http://www.jobbole.com/members/2653yy">fullstackyang</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href="http://blog.jobbole.com/99322" target="_blank">专栏作者</a>。</div><p>微信公众号发布的文章和一般门户网站的新闻文本类型有所不同，通常不能用现有的文本分类器直接对这些文章进行分类，不过文本分类的原理是相通的，本文以微信公众号文章为对象，介绍朴素贝叶斯分类器的实现过程。</p>
<p>文本分类的科学原理和数学证明在网上有很多，这里就不做赘述，本文尽量使用通熟易懂的表述方式，简明扼要地梳理一下文本分类器的各个知识点。</p>
<p>参考了一下Github，发现少有Java 8风格的实现，所以这里的实现尽量利用Java 8的特性，相比之前优势有很多，例如stream在统计聚合等运算上比较方便，代码不仅简洁，而且更加语义化，另外在多线程并行控制上也省去不少的工作。</p>
<p>本项目的地址：<a href="https://github.com/fullstackyang/article-classifier">https://github.com/fullstacky…</a></p>
<h1>一、文本分类器的概述</h1>
<p>文本分类器可以看作是一个预测函数，在给定的文本时，在预定的类别集合中，判断该文本最可能属于哪个类。</p>
<p>这里需要注意两个问题：</p>
<ul>
<li>在文本中含有比较多的标点符号和停用词（的，是，了等），直接使用整段文本处理肯定会产生很多不必要的计算，而且计算量也非常大，因此需要把给定的文本有效地进行表示，也就是选择一系列的特征词来代表这篇文本，这些特征词既可以比较好地反应所属文本的内容，又可以对不同文本有比较好的区分能力。</li>
<li>在进行文本表示之后，如何对这些特征词进行预测，这就是分类器的算法设计问题了，比较常见的模型有朴素贝叶斯，基于支持向量机（SVM），K-近邻（KNN），决策树等分类算法。这里我们选择简单易懂的朴素贝叶斯算法。在机器学习中，朴素贝叶斯建模属于有监督学习，因此需要收集大量的文本作为训练语料，并标注分类结果</li>
</ul>
<p>综上，实现一个分类器通常分为以下几个步骤：</p>
<ol>
<li>收集并处理训练语料，以及最后测试用的测试语料</li>
<li>在训练集上进行特征选择，得到一系列的特征项（词），这些特征项组成了所谓的特征空间</li>
<li>为了表示某个特征项在不同文档中的重要程度，计算该特征项的权重，常用的计算方法有TF-IDF，本文采用的是“经典”朴素贝叶斯模型，这里不考虑特征项的权重（当然，一定要做也可以）</li>
<li>训练模型，对于朴素贝叶斯模型来说，主要的是计算每个特征项在不同类别中的条件概率，这点下面再做解释。</li>
<li>预测文本，模型训练完成之后可以保存到文件中，在预测时直接读入模型的数据进行计算。</li>
</ol>
<h1>二、准备训练语料</h1>
<p>这里需要的语料就是微信公众号的文章，我们可以抓取搜狗微信搜索网站（<a href="http://weixin.sogou.com/">http://weixin.sogou.com/</a>）首页上已经分类好的文章，直接采用其分类结果，这样也省去了标注的工作。至于如何开发爬虫去抓取文章，这里就不再讨论了。</p>
<p><img src="http://www.fullstackyang.com/wp-content/uploads/2018/02/QQ20180228-161923.png" width="936" height="245"></p>
<p>“热门”这类别下的文章不具有一般性，因此不把它当作一个类别。剔除“热门”类别之后，最终我们抓取了30410篇文章，总共20个类别，每个类别的文章数并不均衡，其中最多 的是“养生堂”类别，有2569篇文章，最少的是“军事”类别，有654篇，大体符合微信上文章的分布情况。在保存时，我们保留了文章的标题，公众号名称，文章正文。</p>
<h1>三、特征选择</h1>
<p>如前文所述，特征选择的目的是降低特征空间的维度，避免维度灾难。简单地说，假设我们选择了2万个特征词，也就是说计算机通过学习，得到了一张有2万个词的“单词表”，以后它遇到的所有文本可以够用这张单词表中的词去表示其内容大意。这些特征词针对不同的类别有一定的区分能力，举例来说，“歼击机”可能来自“军事”，“越位”可能来自“体育”，“涨停”可能来自“财经”等等，而通常中文词汇量要比这个数字大得多，一本常见的汉语词典收录的词条数可达数十万。</p>
<p>常见的特征选择方法有两个，信息增益法和卡方检验法。</p>
<h2>3.1 信息增益</h2>
<p>信息增益法的衡量标准是，这个特征项可以为分类系统带来多少信息量，所谓的信息增益就是该特征项包含的能够帮预测类别的信息量，这里所说的信息量可以用熵来衡量，计算信息增益时还需要引入条件熵的概念，公式如下</p>
<p><img src="http://www.fullstackyang.com/wp-content/uploads/2018/02/IG.png" width="967" height="287"></p>
<p>可能有些见到公式就头大的小伙伴不太友好，不过这个公式虽然看起来有点复杂，其实在计算中还是比较简单的，解释一下：</p>
<p>P(Cj)：Cj类文档在整个语料中出现的概率；</p>
<p>P(ti)：语料中包含特征项ti的文档的概率，取反就是不包含特征项ti的文档的概率；</p>
<p>P(Cj|ti)：文档包含特征项ti且属于Cj类的条件概率，取反就是文档不包含特征项ti且属于Cj类的条件概率</p>
<p>上面几个概率值，都可以比较方便地从训练语料上统计得到。若还有不明白的小伙伴，推荐阅读这篇博客：<a href="http://www.blogjava.net/zhenandaci/archive/2009/03/24/261701.html">文本分类入门（十一）特征选择方法之信息增益</a></p>
<h2>3.2 卡方检验</h2>
<p>卡方检验，基于χ2统计量(CHI)来衡量特征项ti和类别Cj之间的相关联程度，CHI统计值越高，该特征项与该类的相关性越大，如果两者相互独立，则CHI统计值接近零。计算时需要根据一张相依表（contingency table），公式也比较简单：</p>
<p><img class="aligncenter" src="http://www.fullstackyang.com/wp-content/uploads/2018/02/ct.png" width="1061" height="183"></p>
<p><img class="aligncenter" src="http://www.fullstackyang.com/wp-content/uploads/2018/02/chi.png" width="517" height="90"></p>
<p>其中N就是文档总数，如果想继续讨论这个公式，推荐阅读这篇博客：<a href="http://www.deeplearn.me/1446.html">特征选择（3）-卡方检验</a></p>
<h2>3.3 算法实现</h2>
<p>不论何种方式都需要对每个特征项进行估算，然后根据所得的数值进行筛选，通常可以设定一个阈值，低于阈值的特征项可以直接从特征空间中移除，另外也可以按照数值从高到低排序，并指定选择前N个。这里我们采用后者，总共截取前2万个特征项。</p>
<p>特征选择实现类的代码如下，其中，不同特征选择方法需实现Strategy接口，以获得不同方法计算得到的估值，这里在截取特征项时为了避免不必要的麻烦，剔除了字符串长度为1的词。</p>
<p>Doc对象表示一篇文档，其中包含了该文档的所属分类，以及分词结果（已经滤掉了停用词等），即Term集合；</p>
<p>Term对象主要包含3个字段，词本身的字符串，词性（用于过滤），词频TF；</p>
<p>Feature表示特征项，一个特征项对应一个Term对象，还包含两个hashmap，一个用来统计不同类别下该特征项出现的文档数量（categoryDocCounter），另一个用来统计不同类别下该特征项出现的频度（categoryTermCounter）（对应朴素贝叶斯两种不同模型，下文详述）</p>
<p><strong>统计时引入FeatureCounter对象，使用stream的reduce方法进行归约。主要的思想就是把每一个文档中的Term集合，映射为Term和Feature的键值对，然后再和已有的Map进行合并，合并时如果遇到相同的Term，则调用Feature的Merge方法，该方法会将双方term的词频，以及categoryDocCounter和categoryTermCounter中的统计结果进行累加。最终将所有文档全部统计完成返回Feature集合。</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c7e744c4893611032" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
@AllArgsConstructor
public class FeatureSelection {

    interface Strategy {
        Feature estimate(Feature feature);
    }

    private final Strategy strategy;
    private final static int FEATURE_SIZE = 20000;

    public List select(List docs) {
        return createFeatureSpace(docs.stream())
                .stream()
                .map(strategy::estimate)
                .filter(f -&gt; f.getTerm().getWord().length() &gt; 1)
                .sorted(comparing(Feature::getScore).reversed())
                .limit(FEATURE_SIZE)
                .collect(toList());
    }

    private Collection createFeatureSpace(Stream docs) {

        @AllArgsConstructor
        class FeatureCounter {
            private final Map featureMap;

            private FeatureCounter accumulate(Doc doc) {
                Map temp = doc.getTerms().parallelStream()
                        .map(t -&gt; new Feature(t, doc.getCategory()))
                        .collect(toMap(Feature::getTerm, Function.identity()));
                if (!featureMap.isEmpty())
                    featureMap.values().forEach(f -&gt; temp.merge(f.getTerm(), f, Feature::merge));
                return new FeatureCounter(temp);
            }

            private FeatureCounter combine(FeatureCounter featureCounter) {
                Map temp = Maps.newHashMap(featureMap);
                featureCounter.featureMap.values().forEach(f -&gt; temp.merge(f.getTerm(), f, Feature::merge));
                return new FeatureCounter(temp);
            }
        }

        FeatureCounter counter = docs.parallel()
                .reduce(new FeatureCounter(Maps.newHashMap()),
                        FeatureCounter::accumulate,
                        FeatureCounter::combine);
        return counter.featureMap.values();
    }
}
public class Feature {
...
    public Feature merge(Feature feature) {
        if (this.term.equals(feature.getTerm())) {
            this.term.setTf(this.term.getTf() + feature.getTerm().getTf());
            feature.getCategoryDocCounter()
                    .forEach((k, v) -&gt; categoryDocCounter.merge(k, v, (oldValue, newValue) -&gt; oldValue + newValue));
            feature.getCategoryTermCounter()
                    .forEach((k, v) -&gt; categoryTermCounter.merge(k, v, (oldValue, newValue) -&gt; oldValue + newValue));
        }
        return this;
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-2">2</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-4">4</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-6">6</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-8">8</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-10">10</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-12">12</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-14">14</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-16">16</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-18">18</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-20">20</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-22">22</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-24">24</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-26">26</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-28">28</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-30">30</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-32">32</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-34">34</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-36">36</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-38">38</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-40">40</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-42">42</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-44">44</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-46">46</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-48">48</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-50">50</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-52">52</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-54">54</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-56">56</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-58">58</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-60">60</div><div class="crayon-num" data-line="crayon-5ac97c7e744c4893611032-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744c4893611032-62">62</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-1"><span class="crayon-sy">@</span><span class="crayon-e">AllArgsConstructor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-2"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">FeatureSelection</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-4"><span class="crayon-h">    </span><span class="crayon-t">interface</span><span class="crayon-h"> </span><span class="crayon-e">Strategy</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-5"><span class="crayon-h">        </span><span class="crayon-e">Feature </span><span class="crayon-e">estimate</span><span class="crayon-sy">(</span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-6"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-8"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Strategy </span><span class="crayon-v">strategy</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-9"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">FEATURE_SIZE</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">20000</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-10"> </div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-11"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">List </span><span class="crayon-e">select</span><span class="crayon-sy">(</span><span class="crayon-e">List </span><span class="crayon-v">docs</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-12"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">createFeatureSpace</span><span class="crayon-sy">(</span><span class="crayon-v">docs</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-13"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-14"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">strategy</span><span class="crayon-o">::</span><span class="crayon-v">estimate</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-15"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">filter</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">getTerm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">getWord</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">length</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-16"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">comparing</span><span class="crayon-sy">(</span><span class="crayon-v">Feature</span><span class="crayon-o">::</span><span class="crayon-v">getScore</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reversed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-17"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">limit</span><span class="crayon-sy">(</span><span class="crayon-v">FEATURE_SIZE</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-18"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toList</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-19"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-20"> </div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-21"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">Collection </span><span class="crayon-e">createFeatureSpace</span><span class="crayon-sy">(</span><span class="crayon-e">Stream </span><span class="crayon-v">docs</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-22"> </div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-23"><span class="crayon-h">        </span><span class="crayon-sy">@</span><span class="crayon-e">AllArgsConstructor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-24"><span class="crayon-h">        </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">FeatureCounter</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-25"><span class="crayon-h">            </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Map </span><span class="crayon-v">featureMap</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-26"> </div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-27"><span class="crayon-h">            </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">FeatureCounter </span><span class="crayon-e">accumulate</span><span class="crayon-sy">(</span><span class="crayon-e">Doc </span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-28"><span class="crayon-h">                </span><span class="crayon-e">Map </span><span class="crayon-v">temp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">getTerms</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">parallelStream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-29"><span class="crayon-h">                        </span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">t</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Feature</span><span class="crayon-sy">(</span><span class="crayon-v">t</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">getCategory</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-30"><span class="crayon-h">                        </span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toMap</span><span class="crayon-sy">(</span><span class="crayon-v">Feature</span><span class="crayon-o">::</span><span class="crayon-v">getTerm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Function</span><span class="crayon-sy">.</span><span class="crayon-e">identity</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-31"><span class="crayon-h">                </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">featureMap</span><span class="crayon-sy">.</span><span class="crayon-e">isEmpty</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-32"><span class="crayon-h">                    </span><span class="crayon-v">featureMap</span><span class="crayon-sy">.</span><span class="crayon-e">values</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">temp</span><span class="crayon-sy">.</span><span class="crayon-e">merge</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">getTerm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Feature</span><span class="crayon-o">::</span><span class="crayon-v">merge</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-33"><span class="crayon-h">                </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FeatureCounter</span><span class="crayon-sy">(</span><span class="crayon-v">temp</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-34"><span class="crayon-h">            </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-35"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-36"><span class="crayon-h">            </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">FeatureCounter </span><span class="crayon-e">combine</span><span class="crayon-sy">(</span><span class="crayon-e">FeatureCounter </span><span class="crayon-v">featureCounter</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-37"><span class="crayon-h">                </span><span class="crayon-e">Map </span><span class="crayon-v">temp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Maps</span><span class="crayon-sy">.</span><span class="crayon-e">newHashMap</span><span class="crayon-sy">(</span><span class="crayon-v">featureMap</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-38"><span class="crayon-h">                </span><span class="crayon-v">featureCounter</span><span class="crayon-sy">.</span><span class="crayon-v">featureMap</span><span class="crayon-sy">.</span><span class="crayon-e">values</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">temp</span><span class="crayon-sy">.</span><span class="crayon-e">merge</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">getTerm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Feature</span><span class="crayon-o">::</span><span class="crayon-v">merge</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-39"><span class="crayon-h">                </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FeatureCounter</span><span class="crayon-sy">(</span><span class="crayon-v">temp</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-40"><span class="crayon-h">            </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-41"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-42"> </div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-43"><span class="crayon-h">        </span><span class="crayon-e">FeatureCounter </span><span class="crayon-v">counter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">docs</span><span class="crayon-sy">.</span><span class="crayon-e">parallel</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-44"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">reduce</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FeatureCounter</span><span class="crayon-sy">(</span><span class="crayon-v">Maps</span><span class="crayon-sy">.</span><span class="crayon-e">newHashMap</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-45"><span class="crayon-h">                        </span><span class="crayon-v">FeatureCounter</span><span class="crayon-o">::</span><span class="crayon-v">accumulate</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-46"><span class="crayon-h">                        </span><span class="crayon-v">FeatureCounter</span><span class="crayon-o">::</span><span class="crayon-v">combine</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-47"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">counter</span><span class="crayon-sy">.</span><span class="crayon-v">featureMap</span><span class="crayon-sy">.</span><span class="crayon-e">values</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-48"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-49"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-50"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Feature</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-51"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-52"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Feature </span><span class="crayon-e">merge</span><span class="crayon-sy">(</span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-53"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">term</span><span class="crayon-sy">.</span><span class="crayon-e">equals</span><span class="crayon-sy">(</span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getTerm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-54"><span class="crayon-h">            </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">term</span><span class="crayon-sy">.</span><span class="crayon-e">setTf</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">term</span><span class="crayon-sy">.</span><span class="crayon-e">getTf</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getTerm</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">getTf</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-55"><span class="crayon-h">            </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getCategoryDocCounter</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-56"><span class="crayon-h">                    </span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">categoryDocCounter</span><span class="crayon-sy">.</span><span class="crayon-e">merge</span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">oldValue</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">newValue</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">oldValue</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">newValue</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-57"><span class="crayon-h">            </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getCategoryTermCounter</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-58"><span class="crayon-h">                    </span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">categoryTermCounter</span><span class="crayon-sy">.</span><span class="crayon-e">merge</span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">oldValue</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">newValue</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">oldValue</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">newValue</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-59"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-60"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744c4893611032-61"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744c4893611032-62"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0115 seconds] -->
<p>信息增益实现如下，在计算条件熵时，利用了stream的collect方法，将包含和不包含特征项的两种情况用一个hashmap分开再进行归约。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c7e744d0315540225" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
@AllArgsConstructor
public class IGStrategy implements FeatureSelection.Strategy {

    private final Collection categories;

    private final int total;

    public Feature estimate(Feature feature) {
        double totalEntropy = calcTotalEntropy();
        double conditionalEntrogy = calcConditionEntropy(feature);
        feature.setScore(totalEntropy - conditionalEntrogy);
        return feature;
    }

    private double calcTotalEntropy() {
        return Calculator.entropy(categories.stream().map(c -&gt; (double) c.getDocCount() / total).collect(toList()));
    }

    private double calcConditionEntropy(Feature feature) {
        int featureCount = feature.getFeatureCount();
        double Pfeature = (double) featureCount / total;

        Map&gt; Pcondition = categories.parallelStream().collect(() -&gt; new HashMap&gt;() {{
                    put(true, Lists.newArrayList());
                    put(false, Lists.newArrayList());
                }}, (map, category) -&gt; {
                    int countDocWithFeature = feature.getDocCountByCategory(category);
                    //出现该特征词且属于类别key的文档数量/出现该特征词的文档总数量
                    map.get(true).add((double) countDocWithFeature / featureCount);
                    //未出现该特征词且属于类别key的文档数量/未出现该特征词的文档总数量
                    map.get(false).add((double) (category.getDocCount() - countDocWithFeature) / (total - featureCount));
                },
                (map1, map2) -&gt; {
                    map1.get(true).addAll(map2.get(true));
                    map1.get(false).addAll(map2.get(false));
                }
        );
        return Calculator.conditionalEntrogy(Pfeature, Pcondition.get(true), Pcondition.get(false));
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-2">2</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-4">4</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-6">6</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-8">8</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-10">10</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-12">12</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-14">14</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-16">16</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-18">18</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-20">20</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-22">22</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-24">24</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-26">26</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-28">28</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-30">30</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-32">32</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-34">34</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-36">36</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-38">38</div><div class="crayon-num" data-line="crayon-5ac97c7e744d0315540225-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d0315540225-40">40</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-1"><span class="crayon-sy">@</span><span class="crayon-e">AllArgsConstructor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-2"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">IGStrategy </span><span class="crayon-r">implements</span><span class="crayon-h"> </span><span class="crayon-v">FeatureSelection</span><span class="crayon-sy">.</span><span class="crayon-i">Strategy</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-4"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Collection </span><span class="crayon-v">categories</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-6"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-8"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Feature </span><span class="crayon-e">estimate</span><span class="crayon-sy">(</span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-9"><span class="crayon-h">        </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">totalEntropy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calcTotalEntropy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-10"><span class="crayon-h">        </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">conditionalEntrogy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">calcConditionEntropy</span><span class="crayon-sy">(</span><span class="crayon-v">feature</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-11"><span class="crayon-h">        </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">setScore</span><span class="crayon-sy">(</span><span class="crayon-v">totalEntropy</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">conditionalEntrogy</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-12"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-13"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-14"> </div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-15"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-e">calcTotalEntropy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-16"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Calculator</span><span class="crayon-sy">.</span><span class="crayon-e">entropy</span><span class="crayon-sy">(</span><span class="crayon-v">categories</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">double</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">.</span><span class="crayon-e">getDocCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toList</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-17"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-18"> </div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-19"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-e">calcConditionEntropy</span><span class="crayon-sy">(</span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-20"><span class="crayon-h">        </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">featureCount</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getFeatureCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-21"><span class="crayon-h">        </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">Pfeature</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">double</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">featureCount</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-22"> </div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-23"><span class="crayon-h">        </span><span class="crayon-v">Map</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">Pcondition</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">categories</span><span class="crayon-sy">.</span><span class="crayon-e">parallelStream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">HashMap</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-24"><span class="crayon-h">                    </span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Lists</span><span class="crayon-sy">.</span><span class="crayon-e">newArrayList</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-25"><span class="crayon-h">                    </span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Lists</span><span class="crayon-sy">.</span><span class="crayon-e">newArrayList</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-26"><span class="crayon-h">                </span><span class="crayon-sy">}</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">map</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-27"><span class="crayon-h">                    </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">countDocWithFeature</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getDocCountByCategory</span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-28"><span class="crayon-h">                    </span><span class="crayon-c">//出现该特征词且属于类别key的文档数量/出现该特征词的文档总数量</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-29"><span class="crayon-h">                    </span><span class="crayon-v">map</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">double</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">countDocWithFeature</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">featureCount</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-30"><span class="crayon-h">                    </span><span class="crayon-c">//未出现该特征词且属于类别key的文档数量/未出现该特征词的文档总数量</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-31"><span class="crayon-h">                    </span><span class="crayon-v">map</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">double</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">.</span><span class="crayon-e">getDocCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">countDocWithFeature</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">featureCount</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-32"><span class="crayon-h">                </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-33"><span class="crayon-h">                </span><span class="crayon-sy">(</span><span class="crayon-v">map1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">map2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-34"><span class="crayon-h">                    </span><span class="crayon-v">map1</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">addAll</span><span class="crayon-sy">(</span><span class="crayon-v">map2</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-35"><span class="crayon-h">                    </span><span class="crayon-v">map1</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">addAll</span><span class="crayon-sy">(</span><span class="crayon-v">map2</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-36"><span class="crayon-h">                </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-37"><span class="crayon-h">        </span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-38"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Calculator</span><span class="crayon-sy">.</span><span class="crayon-e">conditionalEntrogy</span><span class="crayon-sy">(</span><span class="crayon-v">Pfeature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Pcondition</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Pcondition</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d0315540225-39"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d0315540225-40"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0208 seconds] -->
<p>卡方检验实现如下，每个特征项要在每个类别上分别计算CHI值，最终保留其最大值</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c7e744d6009421989" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
@AllArgsConstructor
public class ChiSquaredStrategy implements Strategy {

    private final Collection categories;

    private final int total;

    @ Override
    public Feature estimate(Feature feature) {

        class ContingencyTable {
            private final int A, B, C, D;

            private ContingencyTable(Feature feature, Category category) {
                A = feature.getDocCountByCategory(category);
                B = feature.getFeatureCount() - A;
                C = category.getDocCount() - A;
                D = total - A - B - C;
            }
        }

        Double chisquared = categories.stream()
                .map(c -&gt; new ContingencyTable(feature, c))
                .map(ct -&gt; Calculator.chisquare(ct.A, ct.B, ct.C, ct.D))
                .max(Comparator.comparingDouble(Double::valueOf)).get();
        feature.setScore(chisquared);
        return feature;
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-2">2</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-4">4</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-6">6</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-8">8</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-10">10</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-12">12</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-14">14</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-16">16</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-18">18</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-20">20</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-22">22</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-24">24</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-26">26</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744d6009421989-28">28</div><div class="crayon-num" data-line="crayon-5ac97c7e744d6009421989-29">29</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-1"><span class="crayon-sy">@</span><span class="crayon-e">AllArgsConstructor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-2"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">ChiSquaredStrategy</span><span class="crayon-h"> </span><span class="crayon-r">implements</span><span class="crayon-h"> </span><span class="crayon-e">Strategy</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-4"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Collection </span><span class="crayon-v">categories</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-6"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-8"><span class="crayon-h">    </span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-9"><span class="crayon-e">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Feature </span><span class="crayon-e">estimate</span><span class="crayon-sy">(</span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-10"> </div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-11"><span class="crayon-h">        </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">ContingencyTable</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-12"><span class="crayon-h">            </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">C</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">D</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-14"><span class="crayon-h">            </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">ContingencyTable</span><span class="crayon-sy">(</span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Category </span><span class="crayon-v">category</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-15"><span class="crayon-h">                </span><span class="crayon-v">A</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getDocCountByCategory</span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-16"><span class="crayon-h">                </span><span class="crayon-v">B</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getFeatureCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">A</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-17"><span class="crayon-h">                </span><span class="crayon-v">C</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">.</span><span class="crayon-e">getDocCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">A</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-18"><span class="crayon-h">                </span><span class="crayon-v">D</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">A</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">B</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">C</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-19"><span class="crayon-h">            </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-20"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-22"><span class="crayon-h">        </span><span class="crayon-t">Double</span><span class="crayon-h"> </span><span class="crayon-v">chisquared</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">categories</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-23"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ContingencyTable</span><span class="crayon-sy">(</span><span class="crayon-v">feature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-24"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">ct</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">Calculator</span><span class="crayon-sy">.</span><span class="crayon-e">chisquare</span><span class="crayon-sy">(</span><span class="crayon-v">ct</span><span class="crayon-sy">.</span><span class="crayon-v">A</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ct</span><span class="crayon-sy">.</span><span class="crayon-v">B</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ct</span><span class="crayon-sy">.</span><span class="crayon-v">C</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ct</span><span class="crayon-sy">.</span><span class="crayon-v">D</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-25"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-v">Comparator</span><span class="crayon-sy">.</span><span class="crayon-e">comparingDouble</span><span class="crayon-sy">(</span><span class="crayon-t">Double</span><span class="crayon-o">::</span><span class="crayon-v">valueOf</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-26"><span class="crayon-h">        </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">setScore</span><span class="crayon-sy">(</span><span class="crayon-v">chisquared</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-27"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744d6009421989-28"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744d6009421989-29"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0104 seconds] -->
<p></p>
<h1>四、朴素贝叶斯模型</h1>
<h2>4.1 原理简介</h2>
<p>朴素贝叶斯模型之所以称之“朴素”，是因为其假设特征之间是相互独立的，在文本分类中，也就是说，一篇文档中出现的词都是相互独立，彼此没有关联，显然文档中出现的词都是有逻辑性的，这种假设在现实中几乎是不成立的，但是这种假设却大大简化了计算，根据贝叶斯公式，文档Doc属于类别Ci的概率为：</p>
<p><img class="aligncenter" src="http://www.fullstackyang.com/wp-content/uploads/2018/03/nb.png" width="405" height="86"></p>
<p>P(Ci|Doc)是所求的后验概率，我们在判定分类时，根据每个类别计算P(Ci|Doc)，最终把P(Ci|Doc)取得最大值的那个分类作为文档的类别。其中，P(Doc)对于类别Ci来说是常量，在比较大小时可以不用参与计算，而P(Ci)表示类别Ci出现的概率，我们称之为先验概率，这可以方便地从训练集中统计得出，至于P(Doc|Ci)，也就是类别的条件概率，如果没有朴素贝叶斯的假设，那么计算是非常困难的。</p>
<p>举例来说，假设有一篇文章，内容为“王者荣耀：两款传说品质皮肤将优化，李白最新模型海报爆料”，经过特征选择，文档可以表示为Doc=(王者荣耀，传说，品质，皮肤，优化，李白，最新，模型，海报，爆料)，那么在预测时需要计算P(王者荣耀，传说，品质，皮肤，优化，李白，最新，模型，海报，爆料|Ci)，这样一个条件概率是不可计算的，因为第一个特征取值为“王者荣耀”，第二个特征取值“传说”……第十个特征取值“爆料”的文档很可能为没有，那么概率就为零，而基于朴素贝叶斯的假设，这个条件概率可以转化为：</p>
<p>P(王者荣耀，传说，品质，皮肤，优化，李白，最新，模型，海报，爆料|Ci)=P(王者荣耀|Ci)<em>P(传说|Ci)……</em>P(爆料|Ci)</p>
<p>于是我们就可以统计这些特征词在每个类别中出现的概率了，在这个例子中，游戏类别中“王者荣耀”这个特征项会频繁出现，因此P(王者荣耀|游戏)的条件概率要明显高于其他类别，这就是朴素贝叶斯模型的朴素之处，粗鲁的聪明。</p>
<h2>4.2 多项式模型与伯努利模型</h2>
<p>在具体实现中，朴素贝叶斯又可以分为两种模型，多项式模型（Multinomial）和伯努利模型（Bernoulli），另外还有高斯模型，主要用于处理连续型变量，在文本分类中不讨论。</p>
<p>多项式模型和伯努利模型的区别在于对词频的考察，在多项式模型中文档中特征项的频度是参与计算的，这对于长文本来说是比较公平的，例如上面的例子，“王者荣耀”在游戏类的文档中频度会比较高，而伯努利模型中，所有特征词都均等地对待，只要出现就记为1，未出现就记为0，两者公式如下：</p>
<p><img class="aligncenter" src="http://www.fullstackyang.com/wp-content/uploads/2018/03/nb-b-m.png" width="755" height="238"></p>
<p>在伯努利模型计算公式中，N(Doc(tj)|Ci)表示Ci类文档中特征tj出现的文档数，|D|表示类别Ci的文档数，P(Ci)可以用类别Ci的文档数/文档总数来计算，</p>
<p>在多项式模型计算公式中，TF(ti,Doc)是文档Doc中特征ti出现的频度，TF(ti,Ci)就表示类别Ci中特征ti出现的频度，|V|表示特征空间的大小，也就是特征选择之后，不同（即去掉重复之后）的特征项的总个数，而P(Ci)可以用类别Ci中特征词的总数/所有特征词的总数，所有特征词的总数也就是所有特征词的词频之和。</p>
<p>至于分子和分母都加上一定的常量，这是为了防止数据稀疏而产生结果为零的现象，这种操作称为拉普拉斯平滑，至于背后的原理，推荐阅读这篇博客：<a href="https://zhuanlan.zhihu.com/p/24291822">贝叶斯统计观点下的拉普拉斯平滑</a></p>
<h2>4.3 算法实现</h2>
<p>这里使用了枚举类来封装两个模型，并实现了分类器NaiveBayesClassifier和训练器NaiveBayesLearner中的两个接口，其中Pprior和Pcondition是训练器所需的方法，前者用来计算先验概率，后者用来计算不同特征项在不同类别下的条件概率；getConditionProbability是分类器所需的方法，NaiveBayesKnowledgeBase对象是模型数据的容器，它的getPconditionByWord方法就是用于查询不同特征词在不同类别下的条件概率</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c7e744dd032982791" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public enum NaiveBayesModels implements NaiveBayesClassifier.Model, NaiveBayesLearner.Model {
    Bernoulli {
        @ Override
        public double Pprior(int total, Category category) {
            int Nc = category.getDocCount();
            return Math.log((double) Nc / total);
        }

        @ Override
        public double Pcondition(Feature feature, Category category, double smoothing) {
            int Ncf = feature.getDocCountByCategory(category);
            int Nc = category.getDocCount();
            return Math.log((double) (1 + Ncf) / (Nc + smoothing));
        }

        @ Override
        public List getConditionProbability(String category, List terms, final NaiveBayesKnowledgeBase knowledgeBase) {
            return terms.stream().map(term -&gt; knowledgeBase.getPconditionByWord(category, term.getWord())).collect(toList());
        }
    },
    Multinomial {
        @ Override
        public double Pprior(int total, Category category) {
            int Nt = category.getTermCount();
            return Math.log((double) Nt / total);
        }

        @ Override
        public double Pcondition(Feature feature, Category category, double smoothing) {
            int Ntf = feature.getTermCountByCategory(category);
            int Nt = category.getTermCount();
            return Math.log((double) (1 + Ntf) / (Nt + smoothing));
        }

        @ Override
        public List getConditionProbability(String category, List terms, final NaiveBayesKnowledgeBase knowledgeBase) {
            return terms.stream().map(term -&gt; term.getTf() * knowledgeBase.getPconditionByWord(category, term.getWord())).collect(toList());
        }
    };
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-2">2</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-4">4</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-6">6</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-8">8</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-10">10</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-12">12</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-14">14</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-16">16</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-18">18</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-20">20</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-22">22</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-24">24</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-26">26</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-28">28</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-30">30</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-32">32</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-34">34</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-36">36</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-38">38</div><div class="crayon-num" data-line="crayon-5ac97c7e744dd032982791-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744dd032982791-40">40</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">enum</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesModels </span><span class="crayon-r">implements</span><span class="crayon-h"> </span><span class="crayon-v">NaiveBayesClassifier</span><span class="crayon-sy">.</span><span class="crayon-v">Model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">NaiveBayesLearner</span><span class="crayon-sy">.</span><span class="crayon-i">Model</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-2"><span class="crayon-h">    </span><span class="crayon-e">Bernoulli</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-3"><span class="crayon-h">        </span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-e">Override</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-4"><span class="crayon-e">        </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-e">Pprior</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Category </span><span class="crayon-v">category</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-5"><span class="crayon-h">            </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">Nc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">.</span><span class="crayon-e">getDocCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-6"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">double</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">Nc</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-7"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-8"> </div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-9"><span class="crayon-h">        </span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-e">Override</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-10"><span class="crayon-e">        </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-e">Pcondition</span><span class="crayon-sy">(</span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Category </span><span class="crayon-v">category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">smoothing</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-11"><span class="crayon-h">            </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">Ncf</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getDocCountByCategory</span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-12"><span class="crayon-h">            </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">Nc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">.</span><span class="crayon-e">getDocCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-13"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">double</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">Ncf</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Nc</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">smoothing</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-14"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-16"><span class="crayon-h">        </span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-17"><span class="crayon-e">        </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">List </span><span class="crayon-e">getConditionProbability</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">List </span><span class="crayon-v">terms</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesKnowledgeBase </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-18"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">terms</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">term</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-e">getPconditionByWord</span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">term</span><span class="crayon-sy">.</span><span class="crayon-e">getWord</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toList</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-19"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-20"><span class="crayon-h">    </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-21"><span class="crayon-h">    </span><span class="crayon-e">Multinomial</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-22"><span class="crayon-h">        </span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-23"><span class="crayon-e">        </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-e">Pprior</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Category </span><span class="crayon-v">category</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-24"><span class="crayon-h">            </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">Nt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">.</span><span class="crayon-e">getTermCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-25"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">double</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">Nt</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-26"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-27"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-28"><span class="crayon-h">        </span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-29"><span class="crayon-e">        </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-e">Pcondition</span><span class="crayon-sy">(</span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Category </span><span class="crayon-v">category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">smoothing</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-30"><span class="crayon-h">            </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">Ntf</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">feature</span><span class="crayon-sy">.</span><span class="crayon-e">getTermCountByCategory</span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-31"><span class="crayon-h">            </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">Nt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">.</span><span class="crayon-e">getTermCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-32"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">double</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">Ntf</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Nt</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">smoothing</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-33"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-34"> </div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-35"><span class="crayon-h">        </span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-e">Override</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-36"><span class="crayon-e">        </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">List </span><span class="crayon-e">getConditionProbability</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">List </span><span class="crayon-v">terms</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesKnowledgeBase </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-37"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">terms</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">term</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">term</span><span class="crayon-sy">.</span><span class="crayon-e">getTf</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-e">getPconditionByWord</span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">term</span><span class="crayon-sy">.</span><span class="crayon-e">getWord</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toList</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-38"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744dd032982791-39"><span class="crayon-h">    </span><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744dd032982791-40"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0108 seconds] -->
<p></p>
<h2>五、训练模型</h2>
<p>根据朴素贝叶斯模型的定义，训练模型的过程就是计算每个类的先验概率，以及每个特征项在不同类别下的条件概率，NaiveBayesKnowledgeBase对象将训练器在训练时得到的结果都保存起来，训练完成时写入文件，启动分类时从文件中读入数据交由分类器使用，那么在分类时就可以直接参与到计算过程中。</p>
<p>训练器的实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c7e744e2275796657" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public class NaiveBayesLearner {
    ……
    ……
    public NaiveBayesLearner statistics() {
        log.info("开始统计...");
        this.total = total();
        log.info("total : " + total);
        this.categorySet = trainSet.getCategorySet();
        featureSet.forEach(f -&gt; f.getCategoryTermCounter().forEach((category, count) -&gt; category.setTermCount(category.getTermCount() + count)));
        return this;
    }

    public NaiveBayesKnowledgeBase build() {
        this.knowledgeBase.setCategories(createCategorySummaries(categorySet));
        this.knowledgeBase.setFeatures(createFeatureSummaries(featureSet, categorySet));
        return knowledgeBase;
    }

    private Map createFeatureSummaries(final Set featureSet, final Set categorySet) {
        return featureSet.parallelStream()
                .map(f -&gt; knowledgeBase.createFeatureSummary(f, getPconditions(f, categorySet)))
                .collect(toMap(NaiveBayesKnowledgeBase.FeatureSummary::getWord, Function.identity()));
    }

    private Map createCategorySummaries(final Set categorySet) {
        return categorySet.stream().collect(toMap(Category::getName, c -&gt; model.Pprior(total, c)));
    }

    private Map getPconditions(final Feature feature, final Set categorySet) {
        final double smoothing = smoothing();
        return categorySet.stream()
                .collect(toMap(Category::getName, c -&gt; model.Pcondition(feature, c, smoothing)));
    }

    private int total() {
        if (model == Multinomial)
            return featureSet.parallelStream().map(Feature::getTerm).mapToInt(Term::getTf).sum();//总词频数
        else if (model == Bernoulli)
            return trainSet.getTotalDoc();//总文档数
        return 0;
    }

    private double smoothing() {
        if (model == Multinomial)
            return this.featureSet.size();
        else if (model == Bernoulli)
            return 2.0;
        return 0.0;
    }

    public static void main(String[] args) {
        TrainSet trainSet = new TrainSet(System.getProperty("user.dir") + "/trainset/");

        log.info("特征选择开始...");
        FeatureSelection featureSelection = new FeatureSelection(new ChiSquaredStrategy(trainSet.getCategorySet(), trainSet.getTotalDoc()));
        List features = featureSelection.select(trainSet.getDocs());
        log.info("特征选择完成,特征数:[" + features.size() + "]");

        NaiveBayesModels model = NaiveBayesModels.Multinomial;
        NaiveBayesLearner learner = new NaiveBayesLearner(model, trainSet, Sets.newHashSet(features));
        learner.statistics().build().write(model.getModelPath());
        log.info("模型文件写入完成,路径:" + model.getModelPath());
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-2">2</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-4">4</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-6">6</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-8">8</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-10">10</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-12">12</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-14">14</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-16">16</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-18">18</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-20">20</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-22">22</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-24">24</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-26">26</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-28">28</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-30">30</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-32">32</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-34">34</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-36">36</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-38">38</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-40">40</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-42">42</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-44">44</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-46">46</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-48">48</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-50">50</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-52">52</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-54">54</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-56">56</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-58">58</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-60">60</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-62">62</div><div class="crayon-num" data-line="crayon-5ac97c7e744e2275796657-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e2275796657-64">64</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesLearner</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-2"><span class="crayon-h">    </span>……</div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-3"><span class="crayon-h">    </span>……</div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-4"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesLearner </span><span class="crayon-e">statistics</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-5"><span class="crayon-h">        </span><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">info</span><span class="crayon-sy">(</span><span class="crayon-s">"开始统计..."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-6"><span class="crayon-h">        </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">total</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">total</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-7"><span class="crayon-h">        </span><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">info</span><span class="crayon-sy">(</span><span class="crayon-s">"total : "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-8"><span class="crayon-h">        </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">categorySet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainSet</span><span class="crayon-sy">.</span><span class="crayon-e">getCategorySet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-9"><span class="crayon-h">        </span><span class="crayon-v">featureSet</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">getCategoryTermCounter</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-st">forEach</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">count</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">.</span><span class="crayon-e">setTermCount</span><span class="crayon-sy">(</span><span class="crayon-v">category</span><span class="crayon-sy">.</span><span class="crayon-e">getTermCount</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">count</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-10"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-11"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-12"> </div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-13"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesKnowledgeBase </span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-14"><span class="crayon-h">        </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-e">setCategories</span><span class="crayon-sy">(</span><span class="crayon-e">createCategorySummaries</span><span class="crayon-sy">(</span><span class="crayon-v">categorySet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-15"><span class="crayon-h">        </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-e">setFeatures</span><span class="crayon-sy">(</span><span class="crayon-e">createFeatureSummaries</span><span class="crayon-sy">(</span><span class="crayon-v">featureSet</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">categorySet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-16"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-17"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-18"> </div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-19"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">Map </span><span class="crayon-e">createFeatureSummaries</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Set </span><span class="crayon-v">featureSet</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Set </span><span class="crayon-v">categorySet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-20"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">featureSet</span><span class="crayon-sy">.</span><span class="crayon-e">parallelStream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-21"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-e">createFeatureSummary</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">getPconditions</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">categorySet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-22"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toMap</span><span class="crayon-sy">(</span><span class="crayon-v">NaiveBayesKnowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-v">FeatureSummary</span><span class="crayon-o">::</span><span class="crayon-v">getWord</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Function</span><span class="crayon-sy">.</span><span class="crayon-e">identity</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-23"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-24"> </div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-25"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">Map </span><span class="crayon-e">createCategorySummaries</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Set </span><span class="crayon-v">categorySet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-26"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">categorySet</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toMap</span><span class="crayon-sy">(</span><span class="crayon-v">Category</span><span class="crayon-o">::</span><span class="crayon-v">getName</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">Pprior</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-27"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-28"> </div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-29"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">Map </span><span class="crayon-e">getPconditions</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Feature </span><span class="crayon-v">feature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Set </span><span class="crayon-v">categorySet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-30"><span class="crayon-h">        </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">smoothing</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">smoothing</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-31"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">categorySet</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-32"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toMap</span><span class="crayon-sy">(</span><span class="crayon-v">Category</span><span class="crayon-o">::</span><span class="crayon-v">getName</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">Pcondition</span><span class="crayon-sy">(</span><span class="crayon-v">feature</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">smoothing</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-33"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-34"> </div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-35"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">total</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-36"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">Multinomial</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-37"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">featureSet</span><span class="crayon-sy">.</span><span class="crayon-e">parallelStream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">Feature</span><span class="crayon-o">::</span><span class="crayon-v">getTerm</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">mapToInt</span><span class="crayon-sy">(</span><span class="crayon-v">Term</span><span class="crayon-o">::</span><span class="crayon-v">getTf</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//总词频数</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-38"><span class="crayon-h">        </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">Bernoulli</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-39"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">trainSet</span><span class="crayon-sy">.</span><span class="crayon-e">getTotalDoc</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//总文档数</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-40"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-41"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-42"> </div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-43"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-e">smoothing</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-44"><span class="crayon-h">        </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">Multinomial</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-45"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">featureSet</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-46"><span class="crayon-h">        </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">Bernoulli</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-47"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">2.0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-48"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-49"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-50"> </div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-51"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-52"><span class="crayon-h">        </span><span class="crayon-e">TrainSet </span><span class="crayon-v">trainSet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TrainSet</span><span class="crayon-sy">(</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-e">getProperty</span><span class="crayon-sy">(</span><span class="crayon-s">"user.dir"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"/trainset/"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-53"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-54"><span class="crayon-h">        </span><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">info</span><span class="crayon-sy">(</span><span class="crayon-s">"特征选择开始..."</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-55"><span class="crayon-h">        </span><span class="crayon-e">FeatureSelection </span><span class="crayon-v">featureSelection</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FeatureSelection</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ChiSquaredStrategy</span><span class="crayon-sy">(</span><span class="crayon-v">trainSet</span><span class="crayon-sy">.</span><span class="crayon-e">getCategorySet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainSet</span><span class="crayon-sy">.</span><span class="crayon-e">getTotalDoc</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-56"><span class="crayon-h">        </span><span class="crayon-e">List </span><span class="crayon-v">features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">featureSelection</span><span class="crayon-sy">.</span><span class="crayon-e">select</span><span class="crayon-sy">(</span><span class="crayon-v">trainSet</span><span class="crayon-sy">.</span><span class="crayon-e">getDocs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-57"><span class="crayon-h">        </span><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">info</span><span class="crayon-sy">(</span><span class="crayon-s">"特征选择完成,特征数:["</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">features</span><span class="crayon-sy">.</span><span class="crayon-e">size</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"]"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-58"> </div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-59"><span class="crayon-h">        </span><span class="crayon-e">NaiveBayesModels </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">NaiveBayesModels</span><span class="crayon-sy">.</span><span class="crayon-v">Multinomial</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-60"><span class="crayon-h">        </span><span class="crayon-e">NaiveBayesLearner </span><span class="crayon-v">learner</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesLearner</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainSet</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Sets</span><span class="crayon-sy">.</span><span class="crayon-e">newHashSet</span><span class="crayon-sy">(</span><span class="crayon-v">features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-61"><span class="crayon-h">        </span><span class="crayon-v">learner</span><span class="crayon-sy">.</span><span class="crayon-e">statistics</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">getModelPath</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-62"><span class="crayon-h">        </span><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">info</span><span class="crayon-sy">(</span><span class="crayon-s">"模型文件写入完成,路径:"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">getModelPath</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e2275796657-63"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e2275796657-64"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0132 seconds] -->
<p>在main函数中执行整个训练过程，首先执行特征选择，这里使用卡方检验法，然后将得到特征空间，朴素贝叶斯模型（多项式模型），以及训练集TrainSet对象作为参数，初始化训练器，接着训练器开始进行统计的工作，事实上有一部分的统计工作，在初始化训练集对象时，就已经完成了，例如总文档数，每个类别下的文档数等，这些可以直接拿过来使用，最终将数据都装载到NaiveBayesKnowledgeBase对象当中去，并写入文件，格式为第一行是不同类别的先验概率，余下每一行对应一个特征项，每一列对应不同类别的条件概率值。</p>
<h1>六，测试模型</h1>
<p>分类器预测过程就相对于比较简单了，通过NaiveBayesKnowledgeBase读入数据，然后将指定的文本进行分词，匹配特征项，然后计算在不同类别下的后验概率，返回取得最大值对应的那个类别。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c7e744e7067194829" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
public class NaiveBayesClassifier {
    ……
    private final Model model;

    private final NaiveBayesKnowledgeBase knowledgeBase;

    public NaiveBayesClassifier(Model model) {
        this.model = model;
        this.knowledgeBase = new NaiveBayesKnowledgeBase(model.getModelPath());
    }

    public String predict(String content) {
        Set allFeatures = knowledgeBase.getFeatures().keySet();
        List terms = NLPTools.instance().segment(content).stream()
                .filter(t -&gt; allFeatures.contains(t.getWord())).distinct().collect(toList());

        @AllArgsConstructor
        class Result {
            final String category;
            final double probability;
        }

        Result result = knowledgeBase.getCategories().keySet().stream()
                .map(c -&gt; new Result(c, Calculator.Ppost(knowledgeBase.getCategoryProbability(c),
                        model.getConditionProbability(c, terms, knowledgeBase))))
                .max(Comparator.comparingDouble(r -&gt; r.probability)).get();
        return result.category;
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-2">2</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-4">4</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-6">6</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-8">8</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-10">10</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-12">12</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-14">14</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-16">16</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-18">18</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-20">20</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-22">22</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-24">24</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-26">26</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c7e744e7067194829-28">28</div><div class="crayon-num" data-line="crayon-5ac97c7e744e7067194829-29">29</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesClassifier</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-2"><span class="crayon-h">    </span>……</div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-3"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Model </span><span class="crayon-v">model</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-4"> </div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-5"><span class="crayon-h">    </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesKnowledgeBase </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-6"> </div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-7"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesClassifier</span><span class="crayon-sy">(</span><span class="crayon-e">Model </span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-8"><span class="crayon-h">        </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-9"><span class="crayon-h">        </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">knowledgeBase</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">NaiveBayesKnowledgeBase</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">getModelPath</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-10"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-12"><span class="crayon-h">    </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-13"><span class="crayon-h">        </span><span class="crayon-e">Set </span><span class="crayon-v">allFeatures</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-e">getFeatures</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">keySet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-14"><span class="crayon-h">        </span><span class="crayon-e">List </span><span class="crayon-v">terms</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">NLPTools</span><span class="crayon-sy">.</span><span class="crayon-e">instance</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">segment</span><span class="crayon-sy">(</span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-15"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">filter</span><span class="crayon-sy">(</span><span class="crayon-v">t</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">allFeatures</span><span class="crayon-sy">.</span><span class="crayon-e">contains</span><span class="crayon-sy">(</span><span class="crayon-v">t</span><span class="crayon-sy">.</span><span class="crayon-e">getWord</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">distinct</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">collect</span><span class="crayon-sy">(</span><span class="crayon-e">toList</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-16"> </div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-17"><span class="crayon-h">        </span><span class="crayon-sy">@</span><span class="crayon-e">AllArgsConstructor</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-18"><span class="crayon-h">        </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Result</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-19"><span class="crayon-h">            </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">category</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-20"><span class="crayon-h">            </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">double</span><span class="crayon-h"> </span><span class="crayon-v">probability</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-21"><span class="crayon-h">        </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-22"> </div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-23"><span class="crayon-h">        </span><span class="crayon-e">Result </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-e">getCategories</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">keySet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">stream</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-24"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">map</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Result</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Calculator</span><span class="crayon-sy">.</span><span class="crayon-e">Ppost</span><span class="crayon-sy">(</span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">.</span><span class="crayon-e">getCategoryProbability</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-25"><span class="crayon-h">                        </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">getConditionProbability</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">terms</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">knowledgeBase</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-26"><span class="crayon-h">                </span><span class="crayon-sy">.</span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-v">Comparator</span><span class="crayon-sy">.</span><span class="crayon-e">comparingDouble</span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-sy">.</span><span class="crayon-v">probability</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-27"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-v">category</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c7e744e7067194829-28"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97c7e744e7067194829-29"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0056 seconds] -->
<p>在实际测试时，我们又单独抓取了搜狗微信搜索网站上的文章，按照100篇一组，一共30组进行分类的测试，最终结果每一组的准确率均在90%以上，最高达98%，效果良好。当然正规的评测需要同时评估准确率和召回率，这里就偷懒不做了。</p>
<p>另外还需要说明一点的是，由于训练集是来源于搜狗微信搜索网站的文章，类别仅限于这20个，这不足以覆盖所有微信公众号文章的类别，因此在测试其他来源的微信文章准确率一定会有所影响。当然如果有更加丰富的微信文章训练集的话，也可以利用这个模型重新训练，那么效果也会越来越好。</p>
<h1>七、参考文献与引用</h1>
<ol>
<li>宗成庆. 统计自然语言处理[M]. 清华大学出版社, 2013.</li>
<li>T.M.Mitchell. 机器学习[M]. 机械工业出版社, 2003.</li>
<li>吴军. 数学之美[M]. 人民邮电出版社, 2012.</li>
<li>Raoul-Gabriel Urma, Mario Fusco, Alan Mycroft. Java 8 实战[M]. 人民邮电出版社, 2016.</li>
<li>Ansj中文分词器，<a href="https://github.com/NLPchina/ansj_seg">https://github.com/NLPchina/a…</a></li>
<li>HanLP中文分词器，<a href="https://github.com/hankcs/HanLP">https://github.com/hankcs/HanLP</a></li>
</ol>

        
        
        
    <div class="post-adds">
        <span data-post-id="113691" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113691votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113691" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 1 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i>  评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->

<div id="author-bio">
	
	<h3 class="widget-title">
	关于作者：<a target="_blank" href="http://www.jobbole.com/members/2653yy">fullstackyang</a>
	</h3>
	<div class="alignleft">
		<a target="_blank" href="http://www.jobbole.com/members/2653yy">
			<img src="http://tp2.sinaimg.cn/2233098320/180/0/1">
		</a>
	</div>

    <div class="author-bio-info">

        <span class="author-bio-info-block">
            会当凌绝顶，一览众山小——全栈之路        </span>
        <span class="author-bio-info-block">
            <a href="http://www.jobbole.com/members/2653yy" target="_blank"><i class="fa fa-user"></i> 个人主页</a> ·
            <a href="http://blog.jobbole.com/author/2653yy/" target="_blank"><i class="fa fa-file-text-o"></i> 我的文章</a>

             · <a title="声望值" target="_blank" href="http://www.jobbole.com/members/2653yy/reputation/"><i class="fa fa-graduation-cap"></i> 7</a> · <a title="我的网站" target="_blank" href="http://www.fullstackyang.com"><i class="fa fa-link"></i></a> <a title="微博主页" target="_blank" href="http://weibo.com/2653yy"><i class="fa fa-weibo"></i></a>         </span>
    </div>
	<div class="clear"></div>
</div>

<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《如何实现一个基本的微信文章分类器》",
	pic:"http://jbcdn2.b0.upaiyun.com/2016/09/3fb6592ac92133a71f0ae78e43683e83.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="AI 从业者都会用到的 10 个深度学习方法" target="_blank" href="http://blog.jobbole.com/113740/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">AI 从业者都会用到的 10 个深度学习方法</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="做 ML 有关的工作，需要哪些技能？" target="_blank" href="http://blog.jobbole.com/113592/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">做 ML 有关的工作，需要哪些技能？</a>
                         · <a href="http://blog.jobbole.com/113592/#comments" target="_blank"><i class="fa fa-comments-o"></i> 11</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="如果你还不了解机器学习的简史，请看这篇文章" target="_blank" href="http://blog.jobbole.com/113180/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">如果你还不了解机器学习的简史，请看这篇文章</a>
                         · <a href="http://blog.jobbole.com/113180/#comments" target="_blank"><i class="fa fa-comments-o"></i> 9</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="机器学习之Logistic回归算法" target="_blank" href="http://blog.jobbole.com/113182/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">机器学习之Logistic回归算法</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="2017 机器学习调查报告：Python 最火，R 极具潜力" target="_blank" href="http://blog.jobbole.com/112832/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">2017 机器学习调查报告：Python 最火，R 极具潜力</a>
                         · <a href="http://blog.jobbole.com/112832/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                    </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113691/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113691%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113691%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113691%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113691%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113691%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113691/
url_object_id:56e79f596a3a59be443b4a4f909b938a
front_image_url:['http://jbcdn2.b0.upaiyun.com/2016/09/3fb6592ac92133a71f0ae78e43683e83.jpg']
front_image_path:full/9a51fcef743ae4aca8b8c39bcc18e02a01782e9c.jpg
tag:IT技术-文本分类-机器学习









title:给初学者的 type 命令教程
create_date:2018/04/06
praise_nums:1
fav_nums:1
comments_nums:0
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113817 post type-post status-publish format-standard hentry category-it-tech tag-linux odd" id="post-113817">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>给初学者的 type 命令教程</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/04/06 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
            

            
             ·  <a href="http://blog.jobbole.com/tag/linux/">Linux</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a ref="nofollow" target="_blank" href="https://www.ostechnix.com/the-type-command-tutorial-with-examples-for-beginners/">SK</a>   译文出处：<a target="_blank" href="https://linux.cn/article-9519-1.html">Linux中国/geekpi</a>   </div><p><code>type</code> 命令用于查找 Linux 命令的信息。顾名思义，你可以使用 <code>type</code> 命令轻松找出给定的命令是否是别名、shell 内置命令、文件、函数或关键字。另外，你也可以找到命令的实际路径。为什么有人需要找到命令类型？例如，如果你经常在共享的计算机上工作，则某些人可能会故意或意外地为特定的 Linux 命令创建别名来执行不需要的操作，例如 <code>alias ls = rm -rf /</code>。因此，在发生更糟糕的事情之前检查它们总是一个好主意。这是 <code>type</code> 命令有用的地方。</p>
<p>让我给你看一些例子。</p>
<p>不带任何选项运行 <code>type</code> 命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9861742e33666506314" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ type ls
ls is aliased to `ls --color=auto'</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9861742e33666506314-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e33666506314-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9861742e33666506314-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">type </span><span class="crayon-e">ls</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e33666506314-2"><span class="crayon-e">ls </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">aliased </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-sy">`</span><span class="crayon-v">ls</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-i">auto</span>'</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>正如你在上面的输出中看到的那样，<code>ls</code> 命令已被别名为 <code>ls -color-auto</code>。但是，它是无害的。但只要想想 <code>ls</code> 如果被别名为了其他一些危险的命令。你不想那样，是吗？</p>
<p>你可以使用 <code>-t</code> 选项仅找出 Linux 命令的类型。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9861742e3e217544575" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ type -t ls
alias
$ type -t mkdir
file
$ type -t pwd
builtin
$ type -t if
keyword
$ type -t rvm
function</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9861742e3e217544575-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e3e217544575-2">2</div><div class="crayon-num" data-line="crayon-5ac9861742e3e217544575-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e3e217544575-4">4</div><div class="crayon-num" data-line="crayon-5ac9861742e3e217544575-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e3e217544575-6">6</div><div class="crayon-num" data-line="crayon-5ac9861742e3e217544575-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e3e217544575-8">8</div><div class="crayon-num" data-line="crayon-5ac9861742e3e217544575-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e3e217544575-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9861742e3e217544575-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-e">ls</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e3e217544575-2"><span class="crayon-i">alias</span></div><div class="crayon-line" id="crayon-5ac9861742e3e217544575-3"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-e">mkdir</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e3e217544575-4"><span class="crayon-i">file</span></div><div class="crayon-line" id="crayon-5ac9861742e3e217544575-5"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-e">pwd</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e3e217544575-6"><span class="crayon-i">builtin</span></div><div class="crayon-line" id="crayon-5ac9861742e3e217544575-7"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">if</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e3e217544575-8"><span class="crayon-i">keyword</span></div><div class="crayon-line" id="crayon-5ac9861742e3e217544575-9"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-e">rvm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e3e217544575-10"><span class="crayon-t">function</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>该命令仅显示命令的类型，例如别名。它不显示被别名的内容。如果该命令找不到，你将在终端中看不到任何内容。</p>
<p><code>type</code> 命令的另一个有用的地方是我们可以很容易地找出给定 Linux 命令的绝对路径。为此，请使用 <code>-p</code> 选项，如下所示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9861742e42666943496" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ type -p cal
/usr/bin/cal</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9861742e42666943496-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e42666943496-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9861742e42666943496-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">p</span><span class="crayon-h"> </span><span class="crayon-v">cal</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e42666943496-2"><span class="crayon-o">/</span><span class="crayon-v">usr</span><span class="crayon-o">/</span><span class="crayon-v">bin</span><span class="crayon-o">/</span><span class="crayon-v">cal</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>这与 <code>which ls</code> 命令类似。如果给定的命令是别名，则不会打印任何内容。</p>
<p>要显示命令的所有信息，请使用 <code>-a</code> 选项。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9861742e46504864384" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ type -a ls
ls is aliased to `ls --color=auto'
ls is /usr/bin/ls
ls is /bin/ls</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9861742e46504864384-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e46504864384-2">2</div><div class="crayon-num" data-line="crayon-5ac9861742e46504864384-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9861742e46504864384-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9861742e46504864384-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">ls</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e46504864384-2"><span class="crayon-e">ls </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">aliased </span><span class="crayon-st">to</span><span class="crayon-h"> </span><span class="crayon-sy">`</span><span class="crayon-v">ls</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-i">auto</span>'</div><div class="crayon-line" id="crayon-5ac9861742e46504864384-3"><span class="crayon-e">ls </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">usr</span><span class="crayon-o">/</span><span class="crayon-v">bin</span><span class="crayon-o">/</span><span class="crayon-e">ls</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9861742e46504864384-4"><span class="crayon-e">ls </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">bin</span><span class="crayon-o">/</span><span class="crayon-v">ls</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>如你所见，<code>-a</code> 标志显示给定命令的类型及其绝对路径。有关更多详细信息，请参阅手册页。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9861742e49528274305" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ man type</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9861742e49528274305-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9861742e49528274305-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">man </span><span class="crayon-v">type</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>希望这有帮助。会有更多的好东西。请继续访问！</p>
<p>干杯!</p>

        
        
        
    <div class="post-adds">
        <span data-post-id="113817" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113817votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113817" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 1 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i>  评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《给初学者的 type 命令教程》",
	pic:"http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="为初学者准备的 ln 命令教程（5 个示例）" target="_blank" href="http://blog.jobbole.com/113800/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">为初学者准备的 ln 命令教程（5 个示例）</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="如何在 Linux 上安装应用程序" target="_blank" href="http://blog.jobbole.com/113793/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">如何在 Linux 上安装应用程序</a>
                         · <a href="http://blog.jobbole.com/113793/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux 中的“大内存页”（hugepage）是个什么？" target="_blank" href="http://blog.jobbole.com/113782/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux 中的“大内存页”（hugepage）是个什么？</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="du 及 df 命令的使用（附带示例）" target="_blank" href="http://blog.jobbole.com/113780/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">du 及 df 命令的使用（附带示例）</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux 新用户？来试试这 8 款重要的软件" target="_blank" href="http://blog.jobbole.com/113775/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux 新用户？来试试这 8 款重要的软件</a>
                                            </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113817/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113817%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113817%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113817%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113817%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113817%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113817/
url_object_id:3ddc63f75c52601a85de2d939777f079
front_image_url:['http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg']
front_image_path:full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg
tag:IT技术-Linux









title:Redis源码阅读：sds字符串实现
create_date:2018/04/04
praise_nums:1
fav_nums:0
comments_nums:0
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113798 post type-post status-publish format-standard hentry category-it-tech tag-redis odd" id="post-113798">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>Redis源码阅读：sds字符串实现</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/04/04 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
            

            
             ·  <a href="http://blog.jobbole.com/tag/redis/">Redis</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">本文作者： <a href="http://blog.jobbole.com">伯乐在线</a> - <a href="http://www.jobbole.com/members/hector">hoohack</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href="http://blog.jobbole.com/99322" target="_blank">专栏作者</a>。</div><h2 id="初衷">初衷</h2>
<p>从开始工作就开始使用Redis，也有一段时间了，但都只是停留在使用阶段，没有往更深的角度探索，每次想读源码都止步在阅读书籍上，因为看完书很快又忘了，这次逼自己先读代码。因为个人觉得写作需要阅读文字来增强灵感，那么写代码的，就阅读更多代码来增强灵感吧。</p>
<p>redis的实现原理，在《Redis设计与实现》一书中讲得很详细了，但是想通过结合代码的形式再深入探索，加深自己的理解，现在将自己探索的心得写在这儿。</p>
<h2 id="sds结构体的定义">sds结构体的定义</h2>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d0107e715198162" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
#define SDS_TYPE_5  0
#define SDS_TYPE_8  1
#define SDS_TYPE_16 2
#define SDS_TYPE_32 3
#define SDS_TYPE_64 4
#define SDS_TYPE_MASK 7

// sds结构体，使用不同的结构体来保存不同长度大小的字符串
typedef char *sds;

struct __attribute__ ((__packed__)) sdshdr5 {
    unsigned char flags; /* flags共8位，低三位保存类型标志，高5位保存字符串长度，小于32(2^5-1) */
    char buf[]; // 保存具体的字符串
};
struct __attribute__ ((__packed__)) sdshdr8 {
    uint8_t len; /* 字符串长度，buf已用的长度 */
    uint8_t alloc; /* 为buf分配的总长度，alloc-len就是sds结构体剩余的空间 */
    unsigned char flags; /* 低三位保存类型标志 */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr16 {
    uint16_t len; /* used */
    uint16_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr32 {
    uint32_t len; /* used */
    uint32_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr64 {
    uint64_t len; /* used */
    uint64_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-2">2</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-4">4</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-6">6</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-8">8</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-10">10</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-12">12</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-14">14</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-16">16</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-18">18</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-20">20</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-22">22</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-24">24</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-26">26</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-28">28</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-30">30</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-32">32</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-34">34</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-36">36</div><div class="crayon-num" data-line="crayon-5ac97f0d0107e715198162-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0107e715198162-38">38</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-1"><span class="crayon-p">#define SDS_TYPE_5  0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-2"><span class="crayon-p">#define SDS_TYPE_8  1</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-3"><span class="crayon-p">#define SDS_TYPE_16 2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-4"><span class="crayon-p">#define SDS_TYPE_32 3</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-5"><span class="crayon-p">#define SDS_TYPE_64 4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-6"><span class="crayon-p">#define SDS_TYPE_MASK 7</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-8"><span class="crayon-c">// sds结构体，使用不同的结构体来保存不同长度大小的字符串</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-9"><span class="crayon-r">typedef</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">sds</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-10"> </div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-11"><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e">__attribute__</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">__packed__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">sdshdr5</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-12"><span class="crayon-h">    </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* flags共8位，低三位保存类型标志，高5位保存字符串长度，小于32(2^5-1) */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-13"><span class="crayon-h">    </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">buf</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 保存具体的字符串</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-14"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-15"><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e">__attribute__</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">__packed__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">sdshdr8</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-16"><span class="crayon-h">    </span><span class="crayon-e">uint8_t </span><span class="crayon-v">len</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* 字符串长度，buf已用的长度 */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-17"><span class="crayon-h">    </span><span class="crayon-e">uint8_t </span><span class="crayon-v">alloc</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* 为buf分配的总长度，alloc-len就是sds结构体剩余的空间 */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-18"><span class="crayon-h">    </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* 低三位保存类型标志 */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-19"><span class="crayon-h">    </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">buf</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-20"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-21"><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e">__attribute__</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">__packed__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">sdshdr16</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-22"><span class="crayon-h">    </span><span class="crayon-e">uint16_t </span><span class="crayon-v">len</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* used */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-23"><span class="crayon-h">    </span><span class="crayon-e">uint16_t </span><span class="crayon-v">alloc</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* excluding the header and null terminator */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-24"><span class="crayon-h">    </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* 3 lsb of type, 5 unused bits */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-25"><span class="crayon-h">    </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">buf</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-26"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-27"><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e">__attribute__</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">__packed__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">sdshdr32</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-28"><span class="crayon-h">    </span><span class="crayon-e">uint32_t </span><span class="crayon-v">len</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* used */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-29"><span class="crayon-h">    </span><span class="crayon-e">uint32_t </span><span class="crayon-v">alloc</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* excluding the header and null terminator */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-30"><span class="crayon-h">    </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* 3 lsb of type, 5 unused bits */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-31"><span class="crayon-h">    </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">buf</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-32"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-33"><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e">__attribute__</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">__packed__</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">sdshdr64</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-34"><span class="crayon-h">    </span><span class="crayon-e">uint64_t </span><span class="crayon-v">len</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* used */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-35"><span class="crayon-h">    </span><span class="crayon-e">uint64_t </span><span class="crayon-v">alloc</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* excluding the header and null terminator */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-36"><span class="crayon-h">    </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">/* 3 lsb of type, 5 unused bits */</span></div><div class="crayon-line" id="crayon-5ac97f0d0107e715198162-37"><span class="crayon-h">    </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">buf</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0107e715198162-38"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0046 seconds] -->
<p>sds结构体从4.0开始就使用了5种header定义，节省内存的使用，但是不会用到sdshdr5，我认为是因为sdshdr5能保存的大小较少，2^5=32，因此就不使用它。</p>
<p>其他的结构体保存了len、alloc、flags以及buf四个属性。各自的含义见代码的注释。</p>
<h2 id="sds结构体的获取">sds结构体的获取</h2>
<p>上面可以看到有5种结构体的定义，在使用的时候是通过一个宏来获取的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d01088291021547" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
#define SDS_HDR(T,s) ((struct sdshdr##T *)((s)-(sizeof(struct sdshdr##T))))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d01088291021547-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d01088291021547-1"><span class="crayon-p">#define SDS_HDR(T,s) ((struct sdshdr##T *)((s)-(sizeof(struct sdshdr##T))))</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p><strong>”##”</strong>被称为连接符，它是一种预处理运算符， 用来把两个语言符号(Token)组合成单个语言符号。比如<code>SDS_HDR(8, s)</code>，根据宏定义展开是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d0108d053942505" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
((struct sdshdr8 *)((s)-(sizeof(struct sdshdr8))))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d0108d053942505-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d0108d053942505-1"><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e ">sdshdr8 *</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-sy">(</span><span class="crayon-e">sizeof</span><span class="crayon-sy">(</span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-v">sdshdr8</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>而具体使用哪一个结构体，sds底层是通过flags属性与<code>SDS_TYPE_MASK</code>做与运算得出具体的类型（具体的实现可见下面的sdslen函数），然后再根据类型去获取具体的结构体。</p>
<h2 id="sds特性的实现">sds特性的实现</h2>
<p>在Redis设计与实现一书中讲到，相比C字符串而言，sds的特性如下：</p>
<blockquote>
<ul>
<li>常数复杂度获取字符串长度</li>
<li>杜绝缓冲区溢出</li>
<li>减少内存重新分配次数</li>
<li>二进制安全</li>
</ul>
</blockquote>
<p>那么，它是怎么做到的呢？看代码。</p>
<h3 id="常数复杂度获取字符串长度">常数复杂度获取字符串长度</h3>
<p>因为sds将长度属性保存在结构体中，所以只需要读取这个属性就能获取到sds的长度，具体调用的函数时sdslen，实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d01091996536101" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
static inline size_t sdslen(const sds s) {
    unsigned char flags = s[-1];
    switch(flags&amp;SDS_TYPE_MASK) {
        case SDS_TYPE_5:
            return SDS_TYPE_5_LEN(flags);
        case SDS_TYPE_8:
            return SDS_HDR(8,s)-&gt;len;
        case SDS_TYPE_16:
            return SDS_HDR(16,s)-&gt;len;
        case SDS_TYPE_32:
            return SDS_HDR(32,s)-&gt;len;
        case SDS_TYPE_64:
            return SDS_HDR(64,s)-&gt;len;
    }
    return 0;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d01091996536101-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01091996536101-2">2</div><div class="crayon-num" data-line="crayon-5ac97f0d01091996536101-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01091996536101-4">4</div><div class="crayon-num" data-line="crayon-5ac97f0d01091996536101-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01091996536101-6">6</div><div class="crayon-num" data-line="crayon-5ac97f0d01091996536101-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01091996536101-8">8</div><div class="crayon-num" data-line="crayon-5ac97f0d01091996536101-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01091996536101-10">10</div><div class="crayon-num" data-line="crayon-5ac97f0d01091996536101-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01091996536101-12">12</div><div class="crayon-num" data-line="crayon-5ac97f0d01091996536101-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01091996536101-14">14</div><div class="crayon-num" data-line="crayon-5ac97f0d01091996536101-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01091996536101-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d01091996536101-1"><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">inline </span><span class="crayon-e">size_t </span><span class="crayon-e">sdslen</span><span class="crayon-sy">(</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-i">sds</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01091996536101-2"><span class="crayon-h">    </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">flags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01091996536101-3"><span class="crayon-h">    </span><span class="crayon-st">switch</span><span class="crayon-sy">(</span><span class="crayon-v">flags</span><span class="crayon-o">&amp;</span><span class="crayon-v">SDS_TYPE_MASK</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01091996536101-4"><span class="crayon-h">        </span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">SDS_TYPE_5</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5ac97f0d01091996536101-5"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">SDS_TYPE_5_LEN</span><span class="crayon-sy">(</span><span class="crayon-v">flags</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01091996536101-6"><span class="crayon-h">        </span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">SDS_TYPE_8</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5ac97f0d01091996536101-7"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">SDS_HDR</span><span class="crayon-sy">(</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-v">len</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01091996536101-8"><span class="crayon-h">        </span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">SDS_TYPE_16</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5ac97f0d01091996536101-9"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">SDS_HDR</span><span class="crayon-sy">(</span><span class="crayon-cn">16</span><span class="crayon-sy">,</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-v">len</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01091996536101-10"><span class="crayon-h">        </span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">SDS_TYPE_32</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5ac97f0d01091996536101-11"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">SDS_HDR</span><span class="crayon-sy">(</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-v">len</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01091996536101-12"><span class="crayon-h">        </span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-v">SDS_TYPE_64</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5ac97f0d01091996536101-13"><span class="crayon-h">            </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">SDS_HDR</span><span class="crayon-sy">(</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-o">-&gt;</span><span class="crayon-v">len</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01091996536101-14"><span class="crayon-h">    </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97f0d01091996536101-15"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01091996536101-16"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0027 seconds] -->
<p>可以看到，函数是根据类型调用SDS_HDR宏来获取具体的sds结构，然后直接返回结构体的len属性。</p>
<h3 id="杜绝缓冲区溢出">杜绝缓冲区溢出</h3>
<p>对于C字符串的操作函数来说，如果在修改字符串的时候忘了为字符串分配足够的空间，就有可能出现缓冲区溢出的情况。而sds中的API就不会出现这种情况，因为它在修改sds之前，都会判断它是否有足够的空间完成接下来的操作。</p>
<p>拿书中举例的<code>sdscat</code>函数来看，如果<code>strcat</code>想在原来的”Redis”字符串的基础上进行字符串拼接的操作，但是没有检查空间是否满足，就有可能会修改了”Redis”字符串之后使用到的内存，可能是其他结构使用了，也有可能是一段没有被使用的空间，因此有可能会出现缓冲区溢出。但是<code>sdscat</code>就不会，如下面代码所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d01095933216115" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
sds sdscatlen(sds s, const void *t, size_t len) {
    size_t curlen = sdslen(s);

    s = sdsMakeRoomFor(s,len);
    if (s == NULL) return NULL;
    memcpy(s+curlen, t, len);
    sdssetlen(s, curlen+len);
    s[curlen+len] = '\0';
    return s;
}

sds sdscat(sds s, const char *t) {
    return sdscatlen(s, t, strlen(t));
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d01095933216115-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01095933216115-2">2</div><div class="crayon-num" data-line="crayon-5ac97f0d01095933216115-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01095933216115-4">4</div><div class="crayon-num" data-line="crayon-5ac97f0d01095933216115-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01095933216115-6">6</div><div class="crayon-num" data-line="crayon-5ac97f0d01095933216115-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01095933216115-8">8</div><div class="crayon-num" data-line="crayon-5ac97f0d01095933216115-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01095933216115-10">10</div><div class="crayon-num" data-line="crayon-5ac97f0d01095933216115-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01095933216115-12">12</div><div class="crayon-num" data-line="crayon-5ac97f0d01095933216115-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01095933216115-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d01095933216115-1"><span class="crayon-e">sds </span><span class="crayon-e">sdscatlen</span><span class="crayon-sy">(</span><span class="crayon-i">sds</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">t</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">size_t </span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01095933216115-2"><span class="crayon-h">    </span><span class="crayon-e">size_t </span><span class="crayon-v">curlen</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sdslen</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01095933216115-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01095933216115-4"><span class="crayon-h">    </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sdsMakeRoomFor</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01095933216115-5"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">NULL</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01095933216115-6"><span class="crayon-h">    </span><span class="crayon-e">memcpy</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-o">+</span><span class="crayon-v">curlen</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01095933216115-7"><span class="crayon-h">    </span><span class="crayon-e">sdssetlen</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">curlen</span><span class="crayon-o">+</span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01095933216115-8"><span class="crayon-h">    </span><span class="crayon-v">s</span><span class="crayon-sy">[</span><span class="crayon-v">curlen</span><span class="crayon-o">+</span><span class="crayon-v">len</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'\0'</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01095933216115-9"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01095933216115-10"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5ac97f0d01095933216115-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01095933216115-12"><span class="crayon-e">sds </span><span class="crayon-e">sdscat</span><span class="crayon-sy">(</span><span class="crayon-i">sds</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">t</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5ac97f0d01095933216115-13"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sdscatlen</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">strlen</span><span class="crayon-sy">(</span><span class="crayon-v">t</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01095933216115-14"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0028 seconds] -->
<p>从代码中可以看到，在执行<code>memcpy</code>将字符串写入sds之前会调用<code>sdsMakeRoomFor</code>函数去检查sds字符串s是否有足够的空间，如果没有足够空间，就为其分配足够的空间，从而杜绝了缓冲区溢出。<code>sdsMakeRoomFor</code>函数的实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d01099269540028" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
sds sdsMakeRoomFor(sds s, size_t addlen) {
    void *sh, *newsh;
    size_t avail = sdsavail(s);
    size_t len, newlen;
    char type, oldtype = s[-1] &amp; SDS_TYPE_MASK;
    int hdrlen;

    /* 只有有足够空间就马上返回，否则就继续执行分配空间的操作 */
    if (avail &gt;= addlen) return s;

    len = sdslen(s);
    sh = (char*)s-sdsHdrSize(oldtype);
    newlen = (len+addlen);
    // SDS_MAX_PREALLOC == 1MB，如果修改后的长度小于1M，则分配的空间是原来的2倍，否则增加1MB的空间
    if (newlen</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d01099269540028-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01099269540028-2">2</div><div class="crayon-num" data-line="crayon-5ac97f0d01099269540028-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01099269540028-4">4</div><div class="crayon-num" data-line="crayon-5ac97f0d01099269540028-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01099269540028-6">6</div><div class="crayon-num" data-line="crayon-5ac97f0d01099269540028-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01099269540028-8">8</div><div class="crayon-num" data-line="crayon-5ac97f0d01099269540028-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01099269540028-10">10</div><div class="crayon-num" data-line="crayon-5ac97f0d01099269540028-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01099269540028-12">12</div><div class="crayon-num" data-line="crayon-5ac97f0d01099269540028-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d01099269540028-14">14</div><div class="crayon-num" data-line="crayon-5ac97f0d01099269540028-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d01099269540028-1"><span class="crayon-e">sds </span><span class="crayon-e">sdsMakeRoomFor</span><span class="crayon-sy">(</span><span class="crayon-i">sds</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">size_t </span><span class="crayon-v">addlen</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01099269540028-2"><span class="crayon-h">    </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">sh</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">newsh</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01099269540028-3"><span class="crayon-h">    </span><span class="crayon-e">size_t </span><span class="crayon-v">avail</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sdsavail</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01099269540028-4"><span class="crayon-h">    </span><span class="crayon-e">size_t </span><span class="crayon-v">len</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">newlen</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01099269540028-5"><span class="crayon-h">    </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-v">type</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">oldtype</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-v">SDS_TYPE_MASK</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01099269540028-6"><span class="crayon-h">    </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">hdrlen</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01099269540028-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01099269540028-8"><span class="crayon-h">    </span><span class="crayon-c">/* 只有有足够空间就马上返回，否则就继续执行分配空间的操作 */</span></div><div class="crayon-line" id="crayon-5ac97f0d01099269540028-9"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">avail</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-v">addlen</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01099269540028-10"> </div><div class="crayon-line" id="crayon-5ac97f0d01099269540028-11"><span class="crayon-h">    </span><span class="crayon-v">len</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sdslen</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01099269540028-12"><span class="crayon-h">    </span><span class="crayon-v">sh</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-o">*</span><span class="crayon-sy">)</span><span class="crayon-v">s</span><span class="crayon-o">-</span><span class="crayon-e">sdsHdrSize</span><span class="crayon-sy">(</span><span class="crayon-v">oldtype</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d01099269540028-13"><span class="crayon-h">    </span><span class="crayon-v">newlen</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">len</span><span class="crayon-o">+</span><span class="crayon-v">addlen</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d01099269540028-14"><span class="crayon-h">    </span><span class="crayon-c">// SDS_MAX_PREALLOC == 1MB，如果修改后的长度小于1M，则分配的空间是原来的2倍，否则增加1MB的空间</span></div><div class="crayon-line" id="crayon-5ac97f0d01099269540028-15"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">newlen</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0028 seconds] -->
<p></p>
<h3 id="减少内存分配操作">减少内存分配操作</h3>
<p>sds字符串的很多操作都涉及到修改字符串内容，比如<code>sdscat</code>拼接字符串、<code>sdscpy</code>拷贝字符串等等。这时候就需要内存的分配与释放，如果每次操作都分配刚刚好的大小，那么对程序的性能必定有影响，因为内存分配涉及到系统调用以及一些复杂的算法。</p>
<p>sds使用了空间预分配以及惰性空间释放的策略来减少内存分配操作。</p>
<h4 id="空间预分配">空间预分配</h4>
<p>前面提到，每次涉及到字符串的修改时，都会调用<code>sdsMakeRoomFor</code>检查sds字符串，如果大小不够再进行大小的重新分配。<code>sdsMakeRoomFor</code>函数有下面这几行判断：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d0109d212390208" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
// SDS_MAX_PREALLOC == 1MB，如果修改后的长度小于1M，则分配的空间是原来的2倍，否则增加1MB的空间
if (newlen</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d0109d212390208-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d0109d212390208-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d0109d212390208-1"><span class="crayon-c">// SDS_MAX_PREALLOC == 1MB，如果修改后的长度小于1M，则分配的空间是原来的2倍，否则增加1MB的空间</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d0109d212390208-2"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">newlen</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>函数判断字符串修改后的大小，如果修改后的长度小于1M，则分配给sds的空间是原来的2倍，否则增加1MB的空间。</p>
<h4 id="惰性空间释放">惰性空间释放</h4>
<p>如果操作后减少了字符串的大小，比如下面的<code>sdstrim</code>函数，只是在最后修改len属性，不会马上释放多余的空间，而是继续保留多余的空间，这样在下次需要增加sds字符串的大小时，就不需要再为其分配空间了。当然，如果之后检查到sds的大小实在太大，也会调用<code>sdsRemoveFreeSpac</code>e函数释放多余的空间。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d010a1777844357" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
sds sdstrim(sds s, const char *cset) {
    char *start, *end, *sp, *ep;
    size_t len;

    sp = start = s;
    ep = end = s+sdslen(s)-1;
    /* 从头部和尾部逐个字符遍历往中间靠拢，如果字符在cest中，则继续前进 */
    while(sp  sp &amp;&amp; strchr(cset, *ep)) ep--;
    len = (sp &gt; ep) ? 0 : ((ep-sp)+1); // 全部被去除了，长度就是0
    if (s != sp) memmove(s, sp, len); // 拷贝内容
    s[len] = '\0';
    sdssetlen(s,len);
    return s;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d010a1777844357-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a1777844357-2">2</div><div class="crayon-num" data-line="crayon-5ac97f0d010a1777844357-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a1777844357-4">4</div><div class="crayon-num" data-line="crayon-5ac97f0d010a1777844357-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a1777844357-6">6</div><div class="crayon-num" data-line="crayon-5ac97f0d010a1777844357-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a1777844357-8">8</div><div class="crayon-num" data-line="crayon-5ac97f0d010a1777844357-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a1777844357-10">10</div><div class="crayon-num" data-line="crayon-5ac97f0d010a1777844357-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a1777844357-12">12</div><div class="crayon-num" data-line="crayon-5ac97f0d010a1777844357-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a1777844357-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d010a1777844357-1"><span class="crayon-e">sds </span><span class="crayon-e">sdstrim</span><span class="crayon-sy">(</span><span class="crayon-i">sds</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">cset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a1777844357-2"><span class="crayon-h">    </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">start</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-st">end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">sp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">ep</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d010a1777844357-3"><span class="crayon-h">    </span><span class="crayon-e">size_t </span><span class="crayon-v">len</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a1777844357-4"> </div><div class="crayon-line" id="crayon-5ac97f0d010a1777844357-5"><span class="crayon-h">    </span><span class="crayon-v">sp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a1777844357-6"><span class="crayon-h">    </span><span class="crayon-v">ep</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-st">end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-o">+</span><span class="crayon-e">sdslen</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d010a1777844357-7"><span class="crayon-h">    </span><span class="crayon-c">/* 从头部和尾部逐个字符遍历往中间靠拢，如果字符在cest中，则继续前进 */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a1777844357-8"><span class="crayon-h">    </span><span class="crayon-st">while</span><span class="crayon-sy">(</span><span class="crayon-e">sp  </span><span class="crayon-v">sp</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-e">strchr</span><span class="crayon-sy">(</span><span class="crayon-v">cset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">ep</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">ep</span><span class="crayon-o">--</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d010a1777844357-9"><span class="crayon-h">    </span><span class="crayon-v">len</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sp</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">ep</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">ep</span><span class="crayon-o">-</span><span class="crayon-v">sp</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 全部被去除了，长度就是0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a1777844357-10"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">sp</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">memmove</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sp</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// 拷贝内容</span></div><div class="crayon-line" id="crayon-5ac97f0d010a1777844357-11"><span class="crayon-h">    </span><span class="crayon-v">s</span><span class="crayon-sy">[</span><span class="crayon-v">len</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'\0'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a1777844357-12"><span class="crayon-h">    </span><span class="crayon-e">sdssetlen</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-v">len</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d010a1777844357-13"><span class="crayon-h">    </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a1777844357-14"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0034 seconds] -->
<p></p>
<h3 id="二进制安全">二进制安全</h3>
<p>二进制安全指的是只关心二进制化的字符串，不关心具体格式。只会严格的按照二进制的数据存取，不会妄图以某种特殊格式解析数据。比如遇到’\0’字符不会停止解析。</p>
<p>对于C字符串来说，<code>strlen</code>是判断遇到’\0’之前的字符数量。如果需要保存二进制的数据，就不能通过传统的C字符串来保存，因为获取不到它真实的长度。而sds字符串是通过len属性保存字符串的大小，所以它是二进制安全的。</p>
<h2 id="其他小函数实现">其他小函数实现</h2>
<p>在阅读源码的过程中，也发现了两个个人比较感兴趣趣的函数：</p>
<blockquote>
<ul>
<li>sdsll2str（将long long类型的整型数字转成字符串）</li>
<li>sdstrim （去除头部和尾部的指定字符）</li>
</ul>
</blockquote>
<p>我这两个函数拉出来做了测试，在项目的<code>redis-4.0/tests</code>目录下。<code>sdstrim</code>函数的实现源码上面有列出，看看<code>sdsll2str</code>的实现：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97f0d010a5490344046" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
int sdsll2str(char *s, long long value) {
    char *p, aux;
    unsigned long long v;
    size_t l;

    /* 通过取余数得到原字符串的逆转形式 */
    v = (value</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97f0d010a5490344046-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a5490344046-2">2</div><div class="crayon-num" data-line="crayon-5ac97f0d010a5490344046-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a5490344046-4">4</div><div class="crayon-num" data-line="crayon-5ac97f0d010a5490344046-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97f0d010a5490344046-6">6</div><div class="crayon-num" data-line="crayon-5ac97f0d010a5490344046-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97f0d010a5490344046-1"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">sdsll2str</span><span class="crayon-sy">(</span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a5490344046-2"><span class="crayon-h">    </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">p</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">aux</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d010a5490344046-3"><span class="crayon-h">    </span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-v">v</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a5490344046-4"><span class="crayon-h">    </span><span class="crayon-v">size</span><span class="crayon-sy">_</span>t<span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac97f0d010a5490344046-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac97f0d010a5490344046-6"><span class="crayon-h">    </span><span class="crayon-c">/* 通过取余数得到原字符串的逆转形式 */</span></div><div class="crayon-line" id="crayon-5ac97f0d010a5490344046-7"><span class="crayon-h">    </span><span class="crayon-v">v</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">value</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>函数是通过不断取余数，得到原字符串的逆转形式，接着，通过从尾部开始将字符逐个放到字符串s中，看起来像是一个反转操作，从而实现了将整型转为字符串的操作。</p>
<p>觉得感兴趣是因为<code>sdsll2str</code>这个函数在之前学习C语言的时候经常能看到作为问题出现，能看到如此简洁的实现，表示眼前一亮。而在PHP开发时经常使用trim函数，所以想看看它们的区别。</p>
<h2 id="总结">总结</h2>
<p>通过详细地阅读sds的源码，不仅学习到sds的实现细节，还学习到了一些常用字符串操作函数的实现。如果只是仅仅看看数据结构的定义也可以初步了解，但是要深入了解的话还是需要详细的阅读具体函数的实现代码。还是那句，写代码的，需要阅读更多代码来增强灵感。</p>
<p>我在github有对Redis源码更详细的注解。感兴趣的可以围观一下，给个star。<a href="https://github.com/hoohack/read-redis-src">Redis4.0源码注解</a>。可以通过<a href="https://github.com/hoohack/read-redis-src/commits/master">commit记录</a>查看已添加的注解。</p>
<p>原创文章，文笔有限，才疏学浅，文中若有不正之处，万望告知。</p>

        
            <blockquote class="rewards">
        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>
        <a href="#rewardbox" id="rewards-button" class="fancybox"><span class="btn-bluet-blue href-style"><i class="fa fa-jpy"></i> 打赏作者</span></a>
    </blockquote>

    <div id="rewardbox">
        <h4>打赏支持我写出更多好文章，谢谢！</h4>
                <p>任选一种支付方式</p>
                <p>
                        <img src="http://jbcdn2.b0.upaiyun.com/2016/05/7aa70eaa311d5a5dec82ca0d49624741.png">
            
                            <img src="http://jbcdn2.b0.upaiyun.com/2016/05/1a4b335ec981d013f4002205a23fedd0.jpg">
                    </p>
    </div>

    
        
    <div class="post-adds">
        <span data-post-id="113798" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113798votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113798" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i>  收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i>  评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->

<div id="author-bio">
	
	<h3 class="widget-title">
	关于作者：<a target="_blank" href="http://www.jobbole.com/members/hector">hoohack</a>
	</h3>
	<div class="alignleft">
		<a target="_blank" href="http://www.jobbole.com/members/hector">
			<img src="http://jbcdn2.b0.upaiyun.com/2017/07/df22a501f19a5bba1b3331e2001f8ec2.jpeg">
		</a>
	</div>

    <div class="author-bio-info">

        <span class="author-bio-info-block">
            一个正在努力的菜鸟        </span>
        <span class="author-bio-info-block">
            <a href="http://www.jobbole.com/members/hector" target="_blank"><i class="fa fa-user"></i> 个人主页</a> ·
            <a href="http://blog.jobbole.com/author/hector/" target="_blank"><i class="fa fa-file-text-o"></i> 我的文章</a>

             · <a title="声望值" target="_blank" href="http://www.jobbole.com/members/hector/reputation/"><i class="fa fa-graduation-cap"></i> 27</a> · <a title="我的网站" target="_blank" href="http://www.hoohack.me"><i class="fa fa-link"></i></a> <a title="微博主页" target="_blank" href="http://weibo.com/u/2388493434?is_all=1"><i class="fa fa-weibo"></i></a> <a title="QQ：914099943" target="_blank" href="#"><i class="fa fa-qq"></i></a> <a title="个人微信：hhq8307231" target="_blank" href="#"><i class="fa fa-weixin"></i></a> <a title="GitHub主页" target="_blank" href="https://github.com/hoohack"><i class="fa fa-github"></i></a>         </span>
    </div>
	<div class="clear"></div>
</div>

<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《Redis源码阅读：sds字符串实现》",
	pic:"http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="深入学习 Redis（1）：Redis 内存模型" target="_blank" href="http://blog.jobbole.com/113789/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">深入学习 Redis（1）：Redis 内存模型</a>
                         · <a href="http://blog.jobbole.com/113789/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Redis 集群部署及踩过的坑" target="_blank" href="http://blog.jobbole.com/113760/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Redis 集群部署及踩过的坑</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="布隆过滤器:Google Guava类库源码分析及基于Redis Bitmaps的重构" target="_blank" href="http://blog.jobbole.com/113396/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">布隆过滤器:Google Guava类库源码分析及基于Redis Bitmaps的重构</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="如何让网站不下线而从 Redis 2 迁移到 Redis 3" target="_blank" href="http://blog.jobbole.com/112744/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">如何让网站不下线而从 Redis 2 迁移到 Redis 3</a>
                         · <a href="http://blog.jobbole.com/112744/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="基于 Redis 实现分布式应用限流" target="_blank" href="http://blog.jobbole.com/112381/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">基于 Redis 实现分布式应用限流</a>
                                            </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113798/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113798%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113798%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113798%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113798%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113798%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113798/
url_object_id:1bd4810b83c51a23ef605311000781f3
front_image_url:['http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png']
front_image_path:full/c766feed221138f7946130756cddfc7e86e388b4.jpg
tag:IT技术-Redis









title:du 及 df 命令的使用（附带示例）
create_date:2018/03/23
praise_nums:1
fav_nums:2
comments_nums:0
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113780 post type-post status-publish format-standard hentry category-it-tech tag-linux odd" id="post-113780">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>du 及 df 命令的使用（附带示例）</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/03/23 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
            

            
             ·  <a href="http://blog.jobbole.com/tag/linux/">Linux</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a ref="nofollow" target="_blank" href="http://linuxtechlab.com/du-df-commands-examples/">shusain</a>   译文出处：<a target="_blank" href="https://linux.cn/article-9457-1.html">Linux中国/geekpi</a>   </div><p>在本文中，我将讨论 <code>du</code> 和 <code>df</code> 命令。<code>du</code> 和 <code>df</code> 命令都是 Linux 系统的重要工具，来显示 Linux 文件系统的磁盘使用情况。这里我们将通过一些例子来分享这两个命令的用法。</p>
<ul>
<li><strong>（推荐阅读：<a href="http://linuxtechlab.com/files-transfer-scp-rsync-commands/">使用 scp 和 rsync 命令传输文件</a>）</strong></li>
<li><strong>（另请阅读：<a href="http://linuxtechlab.com/linux-cloning-disks-using-dd-cat-commands/">使用 dd 和 cat 命令为 Linux 系统克隆磁盘</a>）</strong></li>
</ul>
<h3 id="toc_1">du 命令</h3>
<p><code>du</code>（disk usage 的简称）是用于查找文件和目录的磁盘使用情况的命令。<code>du</code> 命令在与各种选项一起使用时能以多种格式提供结果。</p>
<p>下面是一些例子：</p>
<h4 id="toc_2">1、 得到一个目录下所有子目录的磁盘使用概况</h4>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b7c29f2c997117985" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ du /home
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b7c29f2c997117985-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b7c29f2c997117985-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b7c29f2c997117985-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">du</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">home</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b7c29f2c997117985-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/a7080196ba5d69aefcecf7bbf44c9556.jpg" alt="du command"></p>
<p>该命令的输出将显示 <code>/home</code> 中的所有文件和目录以及显示块大小。</p>
<h4 id="toc_3">2、 以人类可读格式也就是 kb、mb 等显示文件/目录大小</h4>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b7c29f35554267743" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ du -h /home
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b7c29f35554267743-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b7c29f35554267743-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b7c29f35554267743-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">du</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">h</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">home</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b7c29f35554267743-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/1b9dd42d7efa627e663eeb719c31051b.jpg" alt="du command"></p>
<h4 id="toc_4">3、 目录的总磁盘大小</h4>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b7c29f3f002952667" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ du -s /home
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b7c29f3f002952667-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b7c29f3f002952667-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b7c29f3f002952667-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">du</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">home</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b7c29f3f002952667-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/3d49dd172fc018cabd4747f4db263811.jpg" alt="du command"></p>
<p>它是 <code>/home</code> 目录的总大小</p>
<h3 id="toc_5">df 命令</h3>
<p>df（disk filesystem 的简称）用于显示 Linux 系统的磁盘利用率。（LCTT 译注：<code>df</code> 可能应该是 disk free 的简称。）</p>
<p>下面是一些例子。</p>
<h4 id="toc_6">1、 显示设备名称、总块数、总磁盘空间、已用磁盘空间、可用磁盘空间和文件系统上的挂载点。</h4>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b7c29f44865299941" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ df
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b7c29f44865299941-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b7c29f44865299941-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b7c29f44865299941-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-i">df</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b7c29f44865299941-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/ab5724c46d3e98a63c869827c65cd227.jpg" alt="df command"></p>
<h4 id="toc_7">2、 人类可读格式的信息</h4>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b7c29f47203667419" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ df -h
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b7c29f47203667419-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b7c29f47203667419-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b7c29f47203667419-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">h</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b7c29f47203667419-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/5e54bd24a629aad15d72114b57687e18.jpg" alt="df command"></p>
<p>上面的命令以人类可读格式显示信息。</p>
<h4 id="toc_8">3、 显示特定分区的信息</h4>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b7c29f4b026816673" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ df -hT /etc
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b7c29f4b026816673-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b7c29f4b026816673-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b7c29f4b026816673-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">hT</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">etc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b7c29f4b026816673-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/5b29e87fdba47b650c6958d569d553c2.jpg" alt="df command"></p>
<p><code>-hT</code> 加上目标目录将以可读格式显示 <code>/etc</code> 的信息。</p>
<p>虽然 <code>du</code> 和 <code>df</code> 命令有更多选项，但是这些例子可以让你初步了解。如果在这里找不到你要找的东西，那么你可以参考有关命令的 man 页面。</p>
<p>另外，<a href="http://linuxtechlab.com/tips-tricks/"><strong>在这</strong></a>阅读我的其他帖子，在那里我分享了一些其他重要和经常使用的 Linux 命令。</p>
<p>如往常一样，欢迎你留下评论和疑问，因此在下面留下你的评论和疑问，我会回复你。</p>

        
        
        
    <div class="post-adds">
        <span data-post-id="113780" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113780votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113780" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 2 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i>  评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《du 及 df 命令的使用（附带示例）》",
	pic:"http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="给初学者的 type 命令教程" target="_blank" href="http://blog.jobbole.com/113817/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">给初学者的 type 命令教程</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="为初学者准备的 ln 命令教程（5 个示例）" target="_blank" href="http://blog.jobbole.com/113800/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">为初学者准备的 ln 命令教程（5 个示例）</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="如何在 Linux 上安装应用程序" target="_blank" href="http://blog.jobbole.com/113793/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">如何在 Linux 上安装应用程序</a>
                         · <a href="http://blog.jobbole.com/113793/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux 中的“大内存页”（hugepage）是个什么？" target="_blank" href="http://blog.jobbole.com/113782/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux 中的“大内存页”（hugepage）是个什么？</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux 新用户？来试试这 8 款重要的软件" target="_blank" href="http://blog.jobbole.com/113775/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux 新用户？来试试这 8 款重要的软件</a>
                                            </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113780/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113780%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113780%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113780%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113780%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113780%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113780/
url_object_id:9f16c4dc5a6cd2f4b07fef3690f49f8b
front_image_url:['http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg']
front_image_path:full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg
tag:IT技术-Linux









title:DNS 解析器性能比较：CloudFlare vs Google vs Quad9
create_date:2018/04/03
praise_nums:1
fav_nums:0
comments_nums:1
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113809 post type-post status-publish format-standard hentry category-it-tech tag-dns tag-web odd" id="post-113809">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>DNS 解析器性能比较：CloudFlare vs Google vs Quad9</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/04/03 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
                            · <a href="#article-comment"> 1 评论 </a>
            

            
             ·  <a href="http://blog.jobbole.com/tag/dns/">DNS</a>, <a href="http://blog.jobbole.com/tag/web/">Web</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a ref="nofollow" target="_blank" href="https://medium.com/@nykolas.z/dns-resolvers-performance-compared-cloudflare-x-google-x-quad9-x-opendns-149e803734e5">medium</a>   译文出处：<a target="_blank" href="https://www.oschina.net/news/94836/dns-resolvers-performance-compared">开源中国社区</a>   </div><p>几个月前，我做了一些可用的顶级免费 DNS 解析器之间的性能比较。恰好在 Quad9 发布之后，我试图根据性能决定使用哪一个：Google，OpenDNS，Quad9 等等…</p>
<p>CloudFlare 是最了解互联网性能的公司之一，最近推出了自己的免费 DNS 解析器。它默认支持基于 TLS 和 HTTPS 上的 DNS。</p>
<p>现在进行一个更加有趣的测试：Google 的 8.8.8.8，Quad9 的 9.9.9.9 和 CloudFlare 的 1.1.1.1  ，以及OpenDNS 的 208.67.222.222 和一些其他供应商进行比较。</p>
<h3>供应商测试</h3>
<p>这些是选择评估的前 8 位免费 DNS 提供商：</p>
<ul class=" list-paddingleft-2">
<li><strong>Google 8.8.8.8</strong>：私有和未过滤，最受欢迎。</li>
<li><strong>CloudFlare 1.1.1.1</strong>：私有和未过滤的新玩家。</li>
<li><strong>Quad 9 9.9.9.9</strong>：私有和安全意识很高的新玩家。</li>
<li><strong>OpenDNS 208.67.222.222</strong>：阻止恶意网域并提供阻止成人内容的旧玩家。</li>
<li><strong>Norton DNS 199.85.126.20</strong>：阻止恶意域名并与其防病毒软件集成的旧玩家。</li>
<li><strong>CleanBrowsing 185.228.168.168</strong>：私有和阻止访问成人内容，新玩家。</li>
<li><strong>Yandex DNS 77.88.8.7</strong>：阻止恶意域名的旧玩家，在俄罗斯非常受欢迎。</li>
<li><strong>Comodo DNS 8.26.56.26</strong>：阻止恶意域名的旧玩家。</li>
</ul>
<p>这是他们之间关于隐私选项的快速功能分解：</p>
<p><img src="https://static.oschina.net/uploads/space/2018/0402/175742_67ED_3703517.png" alt=""></p>
<h3>地点</h3>
<p>从全球18个地点运行测试。主要使用 VPS 提供商和一些宽带位置尝试从尽可能多的地方查询他们的DNS。它会告诉我们它们的连接程度如何，数据中心的位置以及某个人在该领域的经验有多接近。选择的地点：</p>
<ul class=" list-paddingleft-2">
<li><strong>北美</strong>：圣地亚哥，洛杉矶，纽约，多伦多，蒙特利尔，亚特兰大，达拉斯，弗里蒙特，旧金山</li>
<li><strong>欧洲</strong>：伦敦，巴黎，阿姆斯特丹，法兰克福</li>
<li><strong>亚洲</strong>：东京，新加坡，班加罗尔（印度），悉尼，布里斯班（澳大利亚）</li>
<li><strong>南美洲</strong>：圣保罗</li>
</ul>
<h3>结果摘要</h3>
<p>测试非常简单，针对不同流行的域名（google, facebook, twitter, gmail 等）在整个一小时内执行了 70 次DNS 查询。对每个位置的所有请求进行平均，以获得每个 DNS 解析程序的整体性能指标。</p>
<h4>TLDR /摘要</h4>
<ul class=" list-paddingleft-2">
<li>所有供应商（Yandex 除外）在北美和欧洲表现非常好。他们在美国，加拿大和欧洲的响应时间均小于 15 毫秒。然而，亚洲和南美洲在总体平均数上有所不同，因为一些提供商在那里连接不好。</li>
<li>CloudFlare 是所有位置中最快的 DNS。它在全球的平均值为 4.98 毫秒，令人惊叹。</li>
<li>谷歌和 Quad9 分别接近第二和第三。Quad9 在北美和欧洲比谷歌速度快，但在亚洲/南美洲表现不佳。</li>
<li>CloudFlare 在任何地方都有强大的存在。尽管 Google 和 Quad9 在某些地方的响应时间很高，但CloudFlare 在各个地方都表现良好。</li>
<li>Yandex 仅适用于俄罗斯。它不像其他提供商那样使用 Anycast，并且在任何地方都非常缓慢。</li>
<li>CleanBrowsing 是成人（色情）内容过滤的最快速的提供商。</li>
</ul>
<h4>全球平均</h4>
<blockquote><p>＃1 CloudFlare：4.98 ms<br>
＃2 Google：16.44 ms<br>
＃3 Quad9：18.25 ms<br>
＃4 CleanBrowsing：19.14 ms<br>
＃5 Norton：34.75 ms<br>
＃6 OpenDNS：46.51 ms<br>
＃7 Comodo：71.90<br>
＃8 Yandex：169.91</p></blockquote>
<h4>北美平均水平</h4>
<blockquote><p>＃1 CloudFlare：3.93 ms<br>
＃2 Quad9：7.21 ms<br>
＃3 Norton：8.32 ms<br>
＃4 Google：8.53 ms<br>
＃5 CleanBrowsing：11.83 ms<br>
＃6 OpenDNS：14.66 ms<br>
＃7 Comodo：25.91 ms<br>
＃8 Yandex：119.09 ms</p></blockquote>
<h4>欧洲平均</h4>
<blockquote><p>＃1 CloudFlare：2.96<br>
＃2 Quad9：4.35<br>
＃3 CleanBrowsing：5.74<br>
＃4 Google：7.17<br>
＃5 OpenDNS：8.99<br>
＃6 Norton：10.35<br>
＃7 Comodo：13.06<br>
＃8 Yandex：35.74</p></blockquote>

        
        
        
    <div class="post-adds">
        <span data-post-id="113809" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113809votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113809" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i>  收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i> 1 评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《DNS 解析器性能比较：CloudFlare vs Google vs Quad9》",
	pic:"http://jbcdn2.b0.upaiyun.com/2015/03/912be8d20ca700194c3aced111cc833d1.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Nginx 教程（3）：SSL 设置" target="_blank" href="http://blog.jobbole.com/113654/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Nginx 教程（3）：SSL 设置</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Nginx 教程（2）：性能" target="_blank" href="http://blog.jobbole.com/113572/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Nginx 教程（2）：性能</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Nginx 教程 （1）：基本概念" target="_blank" href="http://blog.jobbole.com/113555/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Nginx 教程 （1）：基本概念</a>
                         · <a href="http://blog.jobbole.com/113555/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Facebook 这类网站如何处理数十亿请求并保持高可用性的？" target="_blank" href="http://blog.jobbole.com/111996/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Facebook 这类网站如何处理数十亿请求并保持高可用性的？</a>
                         · <a href="http://blog.jobbole.com/111996/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux DNS 服务器安装、配置和维护" target="_blank" href="http://blog.jobbole.com/110903/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux DNS 服务器安装、配置和维护</a>
                         · <a href="http://blog.jobbole.com/110903/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113809/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113809%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113809%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113809%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113809%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113809%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

                    <h5 id="comments" class="sub-title"><i class="glyphicon"></i>最新评论</h5>
            <ul class="cmnt-list">

                        <li id="comment-162379" class="comment cmnt odd">
    
    <div class="cmnt-box">
        <div class="cmnt-header">
                            <a href="http://www.jobbole.com/members/evolighting" class="cmnt-img"><img width="37" height="37" src="http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png" alt=""></a>
                <div class="cmnt-meta">
                    <span><a href="http://www.jobbole.com/members/evolighting">evolighting</a><label class="comment_author_data"> （ <a title="声望值" target="_blank" href="http://www.jobbole.com/members/evolighting/reputation/"><i class="fa fa-graduation-cap"></i> 1</a> ）</label></span>
                    <span class="c-title">
                        master                    </span>

                    <span class="c-date">
                        <a href="http://blog.jobbole.com/113809/#comment-162379">4 天前</a>
                    </span>

                    
                    
                </div>
                    </div>
        <div class="cmnt-body">
            <p>
                </p><p>机翻可还行....</p>
<p> </p>
<p>但是在国内，其实dns还是只能用ips的，不然会有各种奇葩的问题，也享受不到ips的专线加速（如果你是某些ips的受害者，其实靠着这些东西，网勉强还是能用的很愉快的）</p>
            
                    </div>
                    <div class="cmnt-footer">

                
                <p class="c-like">
                    <a title="赞同" alt="赞同" class="162379voteflag  t-up  href-style vote-comment-up  register-user-only   " data-comment-id="162379"><i class="fa fa-thumbs-o-up"></i> <span id="162379voteuptotal"> 赞</span></a>

                    
                    <a rel="nofollow" class="comment-reply-link register-user-only" href="http://blog.jobbole.com/113809/?replytocom=162379#respond" data-onclick='return addComment.moveForm( "comment-162379", "162379", "respond", "113809" )' aria-label="回复给evolighting">回复 <i class="fa fa-reply"></i></a>
                </p>
            </div>
            </div>
    </li>
<!-- #comment-## -->
            </ul>
        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113809/
url_object_id:9f64c90d116e8593354ebaf19462978b
front_image_url:['http://jbcdn2.b0.upaiyun.com/2015/03/912be8d20ca700194c3aced111cc833d1.jpg']
front_image_path:full/bbd3c66a3badc127bce3c714ce00a0e73265cc91.jpg
tag:IT技术-DNS-Web









title:Linux 中的“大内存页”（hugepage）是个什么？
create_date:2018/03/24
praise_nums:1
fav_nums:1
comments_nums:0
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113782 post type-post status-publish format-standard hentry category-it-tech tag-linux odd" id="post-113782">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>Linux 中的“大内存页”（hugepage）是个什么？</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/03/24 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
            

            
             ·  <a href="http://blog.jobbole.com/tag/linux/">Linux</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a ref="nofollow" target="_blank" href="https://kerneltalks.com/services/what-is-huge-pages-in-linux/">Shrikant Lavhate</a>   译文出处：<a target="_blank" href="https://linux.cn/article-9450-1.html">Linux中国/DarkSun</a>   </div><blockquote><p>学习 Linux 中的大内存页hugepage。理解什么是“大内存页”，如何进行配置，如何查看当前状态以及如何禁用它。</p></blockquote>
<p>本文中我们会详细介绍大内存页huge page，让你能够回答：Linux 中的“大内存页”是什么？在 RHEL6、RHEL7、Ubuntu 等 Linux 中，如何启用/禁用“大内存页”？如何查看“大内存页”的当前值？</p>
<p>首先让我们从“大内存页”的基础知识开始讲起。</p>
<h3 id="toc_1">Linux 中的“大内存页”是个什么玩意？</h3>
<p>“大内存页”有助于 Linux 系统进行虚拟内存管理。顾名思义，除了标准的 4KB 大小的页面外，它们还能帮助管理内存中的巨大的页面。使用“大内存页”，你最大可以定义 1GB 的页面大小。</p>
<p>在系统启动期间，你能用“大内存页”为应用程序预留一部分内存。这部分内存，即被“大内存页”占用的这些存储器永远不会被交换出内存。它会一直保留其中，除非你修改了配置。这会极大地提高像 Oracle 数据库这样的需要海量内存的应用程序的性能。</p>
<h3 id="toc_2">为什么使用“大内存页”？</h3>
<p>在虚拟内存管理中，内核维护一个将虚拟内存地址映射到物理地址的表，对于每个页面操作，内核都需要加载相关的映射。如果你的内存页很小，那么你需要加载的页就会很多，导致内核会加载更多的映射表。而这会降低性能。</p>
<p>使用“大内存页”，意味着所需要的页变少了。从而大大减少由内核加载的映射表的数量。这提高了内核级别的性能最终有利于应用程序的性能。</p>
<p>简而言之，通过启用“大内存页”，系统具只需要处理较少的页面映射表，从而减少访问/维护它们的开销！</p>
<h3 id="toc_3">如何配置“大内存页”？</h3>
<p>运行下面命令来查看当前“大内存页”的详细内容。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b5ea7b54450985871" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
root@kerneltalks # grep Huge /proc/meminfo
AnonHugePages:         0 kB
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b5ea7b54450985871-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b54450985871-2">2</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b54450985871-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b54450985871-4">4</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b54450985871-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b54450985871-6">6</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b54450985871-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b54450985871-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b5ea7b54450985871-1"><span class="crayon-v">root</span><span class="crayon-sy">@</span><span class="crayon-v">kerneltalks</span><span class="crayon-h"> </span><span class="crayon-p"># grep Huge /proc/meminfo</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b54450985871-2"><span class="crayon-v">AnonHugePages</span><span class="crayon-o">:</span><span class="crayon-h">         </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-e">kB</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b54450985871-3"><span class="crayon-v">HugePages_Total</span><span class="crayon-o">:</span><span class="crayon-h">       </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b54450985871-4"><span class="crayon-v">HugePages_Free</span><span class="crayon-o">:</span><span class="crayon-h">        </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b54450985871-5"><span class="crayon-v">HugePages_Rsvd</span><span class="crayon-o">:</span><span class="crayon-h">        </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b54450985871-6"><span class="crayon-v">HugePages_Surp</span><span class="crayon-o">:</span><span class="crayon-h">        </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b54450985871-7"><span class="crayon-v">Hugepagesize</span><span class="crayon-o">:</span><span class="crayon-h">       </span><span class="crayon-cn">2048</span><span class="crayon-h"> </span><span class="crayon-i">kB</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b54450985871-8"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>从上面输出可以看到，每个页的大小为 2MB（<code>Hugepagesize</code>），并且系统中目前有 <code>0</code> 个“大内存页”（<code>HugePages_Total</code>）。这里“大内存页”的大小可以从 <code>2MB</code> 增加到 <code>1GB</code>。</p>
<p>运行下面的脚本可以知道系统当前需要多少个巨大页。该脚本取之于 Oracle。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b5ea7b5f743160770" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
#!/bin/bash
#
# hugepages_settings.sh
#
# Linux bash script to compute values for the
# recommended HugePages/HugeTLB configuration
#
# Note: This script does calculation for all shared memory
# segments available when the script is run, no matter it
# is an Oracle RDBMS shared memory segment or not.
# Check for the kernel version
KERN=`uname -r | awk -F. '{ printf("%d.%d\n",$1,$2); }'`
# Find out the HugePage size
HPG_SZ=`grep Hugepagesize /proc/meminfo | awk {'print $2'}`
# Start from 1 pages to be on the safe side and guarantee 1 free HugePage
NUM_PG=1
# Cumulative number of pages required to handle the running shared memory segments
for SEG_BYTES in `ipcs -m | awk {'print $5'} | grep "[0-9][0-9]*"`
do
   MIN_PG=`echo "$SEG_BYTES/($HPG_SZ*1024)" | bc -q`
   if [ $MIN_PG -gt 0 ]; then
      NUM_PG=`echo "$NUM_PG+$MIN_PG+1" | bc -q`
   fi
done
# Finish with results
case $KERN in
   '2.4') HUGETLB_POOL=`echo "$NUM_PG*$HPG_SZ/1024" | bc -q`;
          echo "Recommended setting: vm.hugetlb_pool = $HUGETLB_POOL" ;;
   '2.6' | '3.8' | '3.10' | '4.1' ) echo "Recommended setting: vm.nr_hugepages = $NUM_PG" ;;
    *) echo "Unrecognized kernel version $KERN. Exiting." ;;
esac
# End
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-2">2</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-4">4</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-6">6</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-8">8</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-10">10</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-12">12</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-14">14</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-16">16</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-18">18</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-20">20</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-22">22</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-24">24</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-26">26</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-28">28</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-30">30</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b5f743160770-32">32</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b5f743160770-33">33</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-1"><span class="crayon-p">#!/bin/bash</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-2"><span class="crayon-p">#</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-3"><span class="crayon-p"># hugepages_settings.sh</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-4"><span class="crayon-p">#</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-5"><span class="crayon-p"># Linux bash script to compute values for the</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-6"><span class="crayon-p"># recommended HugePages/HugeTLB configuration</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-7"><span class="crayon-p">#</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-8"><span class="crayon-p"># Note: This script does calculation for all shared memory</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-9"><span class="crayon-p"># segments available when the script is run, no matter it</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-10"><span class="crayon-p"># is an Oracle RDBMS shared memory segment or not.</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-11"><span class="crayon-p"># Check for the kernel version</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-12"><span class="crayon-v">KERN</span><span class="crayon-o">=</span><span class="crayon-sy">`</span><span class="crayon-v">uname</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">awk</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">F</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'{ printf("%d.%d\n",$1,$2); }'</span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-13"><span class="crayon-p"># Find out the HugePage size</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-14"><span class="crayon-v">HPG_SZ</span><span class="crayon-o">=</span><span class="crayon-sy">`</span><span class="crayon-e">grep </span><span class="crayon-v">Hugepagesize</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">proc</span><span class="crayon-o">/</span><span class="crayon-v">meminfo</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-e">awk</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'print $2'</span><span class="crayon-sy">}</span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-15"><span class="crayon-p"># Start from 1 pages to be on the safe side and guarantee 1 free HugePage</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-16"><span class="crayon-v">NUM_PG</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-17"><span class="crayon-p"># Cumulative number of pages required to handle the running shared memory segments</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-18"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">SEG_BYTES </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-sy">`</span><span class="crayon-v">ipcs</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">m</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-e">awk</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-s">'print $5'</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-i">grep</span><span class="crayon-h"> </span><span class="crayon-s">"[0-9][0-9]*"</span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-19"><span class="crayon-st">do</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-20"><span class="crayon-h">   </span><span class="crayon-v">MIN_PG</span><span class="crayon-o">=</span><span class="crayon-sy">`</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"$SEG_BYTES/($HPG_SZ*1024)"</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">bc</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">q</span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-21"><span class="crayon-h">   </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">MIN_PG</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">gt</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-st">then</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-22"><span class="crayon-h">      </span><span class="crayon-v">NUM_PG</span><span class="crayon-o">=</span><span class="crayon-sy">`</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"$NUM_PG+$MIN_PG+1"</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">bc</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">q</span><span class="crayon-sy">`</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-23"><span class="crayon-h">   </span><span class="crayon-e">fi</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-24"><span class="crayon-v">done</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-25"><span class="crayon-p"># Finish with results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-26"><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-e">KERN </span><span class="crayon-st">in</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-27"><span class="crayon-h">   </span><span class="crayon-s">'2.4'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">HUGETLB_POOL</span><span class="crayon-o">=</span><span class="crayon-sy">`</span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"$NUM_PG*$HPG_SZ/1024"</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">bc</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">q</span><span class="crayon-sy">`</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-28"><span class="crayon-h">          </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"Recommended setting: vm.hugetlb_pool = $HUGETLB_POOL"</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-29"><span class="crayon-h">   </span><span class="crayon-s">'2.6'</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-s">'3.8'</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-s">'3.10'</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-s">'4.1'</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"Recommended setting: vm.nr_hugepages = $NUM_PG"</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-30"><span class="crayon-h">    </span><span class="crayon-o">*</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"Unrecognized kernel version $KERN. Exiting."</span><span class="crayon-h"> </span><span class="crayon-sy">;</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-31"><span class="crayon-v">esac</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b5f743160770-32"><span class="crayon-p"># End</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b5f743160770-33"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p>将它以 <code>hugepages_settings.sh</code> 为名保存到 <code>/tmp</code> 中，然后运行之：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b5ea7b64695632028" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
root@kerneltalks # sh /tmp/hugepages_settings.sh
Recommended setting: vm.nr_hugepages = 124
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b5ea7b64695632028-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b64695632028-2">2</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b64695632028-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b5ea7b64695632028-1"><span class="crayon-v">root</span><span class="crayon-sy">@</span><span class="crayon-v">kerneltalks</span><span class="crayon-h"> </span><span class="crayon-p"># sh /tmp/hugepages_settings.sh</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b64695632028-2"><span class="crayon-e">Recommended </span><span class="crayon-v">setting</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">vm</span><span class="crayon-sy">.</span><span class="crayon-v">nr_hugepages</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">124</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b64695632028-3"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>你的输出类似如上结果，只是数字会有一些出入。</p>
<p>这意味着，你系统需要 124 个每个 2MB 的“大内存页”！若你设置页面大小为 4MB，则结果就变成了 62。你明白了吧？</p>
<h3 id="toc_4">配置内核中的“大内存页”</h3>
<p>本文最后一部分内容是配置上面提到的 <a href="https://kerneltalks.com/linux/how-to-tune-kernel-parameters-in-linux/">内核参数 </a> ，然后重新加载。将下面内容添加到 <code>/etc/sysctl.conf</code> 中，然后输入 <code>sysctl -p</code> 命令重新加载配置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b5ea7b68892554060" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
vm.nr_hugepages=126
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b5ea7b68892554060-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b68892554060-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b5ea7b68892554060-1"><span class="crayon-v">vm</span><span class="crayon-sy">.</span><span class="crayon-v">nr_hugepages</span><span class="crayon-o">=</span><span class="crayon-cn">126</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b68892554060-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>注意我们这里多加了两个额外的页，因为我们希望在实际需要的页面数量之外多一些额外的空闲页。</p>
<p>现在，内核已经配置好了，但是要让应用能够使用这些“大内存页”还需要提高内存的使用阀值。新的内存阀值应该为 126 个页 x 每个页 2 MB = 252 MB，也就是 258048 KB。</p>
<p>你需要编辑 <code>/etc/security/limits.conf</code> 中的如下配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b5ea7b6c489826479" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
soft memlock 258048
hard memlock 258048
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b5ea7b6c489826479-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b5ea7b6c489826479-2">2</div><div class="crayon-num" data-line="crayon-5ac94b5ea7b6c489826479-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b5ea7b6c489826479-1"><span class="crayon-e">soft </span><span class="crayon-i">memlock</span><span class="crayon-h"> </span><span class="crayon-cn">258048</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b5ea7b6c489826479-2"><span class="crayon-e">hard </span><span class="crayon-i">memlock</span><span class="crayon-h"> </span><span class="crayon-cn">258048</span></div><div class="crayon-line" id="crayon-5ac94b5ea7b6c489826479-3"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>某些情况下，这些设置是在指定应用的文件中配置的，比如 Oracle DB 就是在 <code>/etc/security/limits.d/99-grid-oracle-limits.conf</code> 中配置的。</p>
<p>这就完成了！你可能还需要重启应用来让应用来使用这些新的巨大页。</p>
<p>（LCTT 译注：此外原文有误，“透明大内存页”和“大内存页”不同，而且，在 Redhat 系统中，“大内存页” 不是默认启用的，而“透明大内存页”是启用的。因此这个段落删除了。）</p>
<p> </p>

        
        
        
    <div class="post-adds">
        <span data-post-id="113782" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113782votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113782" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 1 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i>  评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《Linux 中的“大内存页”（hugepage）是个什么？》",
	pic:"http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="给初学者的 type 命令教程" target="_blank" href="http://blog.jobbole.com/113817/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">给初学者的 type 命令教程</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="为初学者准备的 ln 命令教程（5 个示例）" target="_blank" href="http://blog.jobbole.com/113800/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">为初学者准备的 ln 命令教程（5 个示例）</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="如何在 Linux 上安装应用程序" target="_blank" href="http://blog.jobbole.com/113793/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">如何在 Linux 上安装应用程序</a>
                         · <a href="http://blog.jobbole.com/113793/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="du 及 df 命令的使用（附带示例）" target="_blank" href="http://blog.jobbole.com/113780/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">du 及 df 命令的使用（附带示例）</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux 新用户？来试试这 8 款重要的软件" target="_blank" href="http://blog.jobbole.com/113775/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux 新用户？来试试这 8 款重要的软件</a>
                                            </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113782/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113782%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113782%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113782%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113782%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113782%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113782/
url_object_id:ab0322e9007276c76fe370fbf4a95a33
front_image_url:['http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg']
front_image_path:full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg
tag:IT技术-Linux









title:从业 24 年独立开发者：大多数同行都只看 5 年以内
create_date:2018/03/22
praise_nums:1
fav_nums:1
comments_nums:0
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113778 post type-post status-publish format-standard hentry category-career tag-797 odd" id="post-113778">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>从业 24 年独立开发者：大多数同行都只看 5 年以内</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/03/22 ·  <a href="http://blog.jobbole.com/category/career/" rel="category tag">职场</a>
            
            

            
             ·  <a href="http://blog.jobbole.com/tag/%e6%b8%b8%e6%88%8f/">游戏</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a target="_blank" href="http://www.gamelook.com.cn/2018/03/323982">GameLook</a>   </div><p>GameLook报道/有人说，游戏行业的竞争越来越激烈，游戏数量的增加使得曝光率问题日益严重，但在Jeff Vogel看来，真正热爱游戏研发的人，是不会抱怨这些问题的，因为大多数人做开发者都是从1-5年的时间看待自己的游戏研发职业生涯，而真正想要把游戏当作职业的人，往往是考虑40年或者更长的周期。</p>
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/db3f0f9a2c81173f5758eed4074b7543.jpg" alt="" width="564" height="293"></p>
<p>在24年的独立游戏研发生涯中，Spiderweb Software创始人Jeff Vogel学到了很多东西。在3月20日举行的GDC独立游戏峰会上，他分享了一些自己的心得，有些观点让人十分意外。</p>
<p><strong>游戏是朝阳产业，创新不是唯一出路</strong></p>
<p>Vogel强调，“游戏行业还是个朝阳产业，没有人无所不知，我们还有很多东西都需要弄明白，比如，如何设计这些游戏，如何创造、测试以及销售这些产品，如何为游戏做营销，如何给1亿美元预算的项目增加开箱子玩法而又不影响发布之后的口碑？”他提到自己的第一个游戏项目时候说，“这个项目并没有耗时太久，我当时有了一个想法，也就是小时候就喜欢的那些游戏，所以我要做的就是把小时候喜欢的游戏都回顾一遍，然后从每个游戏里汲取最好的创意。按照我的方法，我希望把它们变成让我觉得满意的游戏”。</p>
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/3ea9cfb97b6ce8d6c4919b5e34eb106f.jpg" alt="" width="698" height="566"></p>
<p style="text-align: center">Jeff Vogel的第一款游戏截图</p>
<p>独立游戏非常适合做创新，但创新并不是唯一的出路。你必须知道，我们游戏行业的每个人都是站在巨人的肩膀上，所有的玩法都是在原有的玩法之上演变而来，我只了解自己喜欢的，然后复制这个想法，这就是我的创意过程，他鼓励其他开发者们用类似的方式，按照自己的个人需求去寻找创意，有人把游戏创意说的很玄，比如追求自己的灵感，这样的建议，但我的建议是千万不要这样做，这是一个非常现实的建议，我来说说原因。</p>
<p>大多数人思考自己在游戏行业生涯的时候，往往是从1-5年的角度考虑问题，对于一些刚开始做游戏研发的人们来说，追寻自己的灵感似乎是非常合理的事情。但是，如果你把自己从事独立游戏研发行业的期限延长到40年或者更久的时间考虑，或许会有所帮助。</p>
<p>这是一个特别长的时间，如果你在一个行业工作这么久，就会达到最高的工作效率，因为你需要维持生存，需要一个对应的生活方式，一个长久的想法，一个可持续的过程，保持自己不至于破产，因为，如果你因为一些想法而失去了立足之本，在接下来的40年里，它都会让你不断吃亏。</p>
<p><strong>独立游戏要注重体验，远离消极玩家</strong></p>
<p>当然，Vogel的创意也并不只是抄袭其他游戏的玩法，他对自己游戏的要求也是相对较高的，比如研发续作的时候，前作25%最差的部分需要被替换，提高整体游戏质量。他非常喜欢重复使用资源、代码和引擎，并认为所有人都不应该因此感到羞辱，比如有一个狼的icon，他在15款不同的游戏里使用过，“人们一直拿这个梗开我的玩笑，但我还是没有因此失业”。</p>
<p>虽然Spiderweb的游戏有一定的用户群，而且口碑还不错，但这些游戏对于更大的用户群缺乏吸引力，有很大一部分原因是画质无法和3A游戏媲美，但Vogel说，“我非常反感所有人吐槽我的画面质量不够好，我也是投入了资金，专门招聘了美术师的，有些美术资源也是从比较大的渠道获得的，然而还是有人经常说，我的游戏画面很差，我以后再也不会浪费精力去专门提高美术质量了”。</p>
<p>对于独立游戏开发者而言，这种批评的声音也是经常遇到的，人性有一部分是刻薄的，会对某些事物提出不合理的需求，而且在Steam这样的分销平台没有出现之前，Vogel做电话销售的时候就遇到过类似的问题。而到了互联网时代，这种问题就更加严重，“通常最愤怒的人不是完全匿名的，他们可能是五年前你的游戏最忠实的粉丝，然后你对游戏做出了改变，而且改掉的恰好是他们最喜欢的东西，他们就不再是你的粉丝，你要知道，有时候爱与恨之间的界限很小”。</p>
<p>作为一个想要长期在游戏行业生存的开发者，Vogel表示，远离各种形式的骚扰是很重要的，作为一个成年人，虽然你很少会被人轻易激怒，但仍有很多事情会让你抓狂，所以Vogel基本上不会看自己的游戏在Steam平台的评论，也不访问论坛，如果被人喷，他还会暂时不登陆Twitter，等待事情平息了之后再登录，如果与一些玩家的关系闹僵，他会毫不犹豫的放弃这部分用户。Vogel说，“不要怕得罪用户，他们说客户总是对的，但实际上并非如此，用户一直是错的。但差别在于，你永远吵不赢他们。有时候你不得不对一部分玩家说，‘我的游戏不适合你，所以我不能增加你要的功能、不能做这样的资料片、不能满足你的要求’，对于你无法让他们满意的用户，退款是最好的方法”。</p>
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/b87866fb081fe1d1caf5bc8b5b63273f.jpg" alt="" width="714" height="401"></p>
<p style="text-align: center">《Geneforge 3》截图</p>
<p>对于论坛管理，他说，“如果有人在论坛挑事，直接封掉就是了。但如果有人说，‘这些人又不会影响你的生意，不应该封他们’，那你可以连这些人一起封掉，这些消极的负面声音只会给你的社区带来不利影响，真正支持你的玩家会理解你的做法”。</p>
<p>和所有的工作室一样，Spiderweb也经历了起伏，Vogel指出，2004年是最艰难的时候，那一年他的两款游戏，《Blades of Avernum》和《Geneforge 3》的销量都不佳。</p>
<p>有人说，游戏开发者就像是艺术家，遭遇挫折在所难免，但Vogel认为，作为艺术家，你必须成长，“我们更像是玩具制造者，我们卖的是娱乐体验，我们的作品是用来给人们的大脑带来消遣的，我们卖的是惊喜，而自满、平淡无奇和重复会扼杀惊喜。如果你想做续作，很好，但你的续作最好是加入一些新东西，而且是越早越好，因为，如果玩家们开始发现你的需走只是重复，那么就会以拒绝购买的方式让你看到他们的答案”。</p>
<p>最后，Vogel还提醒同行们不要过度消耗自己的健康，“不要因为熬夜工作而感到自豪，你需要睡眠才能活的长久，最好是挑一把好的椅子，因为有一天如果你的脊椎不行了，就会追悔莫及”。</p>

        
        
        
    <div class="post-adds">
        <span data-post-id="113778" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113778votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113778" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 1 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i>  评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《从业 24 年独立开发者：大多数同行都只看 5 年以内》",
	pic:"http://jbcdn2.b0.upaiyun.com/2018/03/db3f0f9a2c81173f5758eed4074b7543.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="独立游戏开发者：我做对了所有事、但还是赔掉了房子" target="_blank" href="http://blog.jobbole.com/113629/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">独立游戏开发者：我做对了所有事、但还是赔掉了房子</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="九年游戏开发经验谈" target="_blank" href="http://blog.jobbole.com/109943/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">九年游戏开发经验谈</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="13 年来，我写了这些糟糕的游戏代码" target="_blank" href="http://blog.jobbole.com/111373/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">13 年来，我写了这些糟糕的游戏代码</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Windows 纸牌游戏是我开发的，但我没从中拿到一分钱" target="_blank" href="http://blog.jobbole.com/111005/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Windows 纸牌游戏是我开发的，但我没从中拿到一分钱</a>
                         · <a href="http://blog.jobbole.com/111005/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="WASD 何时成了游戏操作的主流？" target="_blank" href="http://blog.jobbole.com/110329/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">WASD 何时成了游戏操作的主流？</a>
                                            </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113778/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113778%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113778%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113778%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113778%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113778%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113778/
url_object_id:7a3fd4e360713292fb09393642fffc46
front_image_url:['http://jbcdn2.b0.upaiyun.com/2018/03/db3f0f9a2c81173f5758eed4074b7543.jpg']
front_image_path:full/e987a29d5f8519c5dcfb6963d8ba061ebf03b879.jpg
tag:职场-游戏









title:如何在 Linux 上安装应用程序
create_date:2018/03/27
praise_nums:1
fav_nums:2
comments_nums:1
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113793 post type-post status-publish format-standard hentry category-it-tech tag-linux odd" id="post-113793">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>如何在 Linux 上安装应用程序</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/03/27 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
                            · <a href="#article-comment"> 1 评论 </a>
            

            
             ·  <a href="http://blog.jobbole.com/tag/linux/">Linux</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a ref="nofollow" target="_blank" href="https://opensource.com/article/18/1/how-install-apps-linux">Seth Kenlon</a>   译文出处：<a target="_blank" href="https://linux.cn/article-9486-1.html">Linux中国/MjSeven</a>   </div><blockquote><p>学习在你的 Linux 计算机上摆弄那些软件。</p></blockquote>
<p>如何在 Linux 上安装应用程序？因为有许多操作系统，这个问题不止有一个答案。应用程序可以可以来自许多来源 —— 几乎不可能数的清，并且每个开发团队都可以以他们认为最好的方式提供软件。知道如何安装你所得到的软件是成为操作系统高级用户的一部分。</p>
<h3 id="toc_1">仓库</h3>
<p>十多年来，Linux 已经在使用软件库来分发软件。在这种情况下，“仓库”是一个托管可安装软件包的公共服务器。Linux 发行版提供了一条命令，以及该命令的图形界面，用于从服务器获取软件并将其安装到你的计算机。这是一个非常简单的概念，它已经成为所有主流手机操作系统的模式，最近，该模式也成为了两大闭源计算机操作系统的“应用商店”。</p>
<p><img class="aligncenter" title="Linux repository" src="http://jbcdn2.b0.upaiyun.com/2018/03/760b92cca45081c6804cd6aaed0a77cc.png" alt="Linux repository"></p>
<p style="text-align: center"><em>不是应用程序商店</em></p>
<p>从软件仓库安装是在 Linux 上安装应用程序的主要方法，它应该是你寻找想要安装的任何应用程序的首选地方。</p>
<p>从软件仓库安装，通常需要一个命令，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b4268180876551626" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ sudo dnf install inkscape
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b4268180876551626-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b4268180876551626-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b4268180876551626-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">dnf </span><span class="crayon-e">install </span><span class="crayon-i">inkscape</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b4268180876551626-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>实际使用的命令取决于你所使用的 Linux 发行版。Fedora 使用 <code>dnf</code>，OpenSUSE 使用 <code>zypper</code>，Debian 和 Ubuntu 使用 <code>apt</code>，Slackware 使用 <code>sbopkg</code>，FreeBSD 使用 <code>pkg_add</code>，而基于 lllumos 的 Openlndiana 使用 <code>pkg</code>。无论你使用什么，该命令通常要搜索你想要安装应用程序的正确名称，因为有时候你认为的软件名称不是它官方或独有的名称：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b4268189241255059" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ sudo dnf search pyqt
PyQt.x86_64 : Python bindings for Qt3
PyQt4.x86_64 : Python bindings for Qt4
python-qt5.x86_64 : PyQt5 is Python bindings for Qt5
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b4268189241255059-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b4268189241255059-2">2</div><div class="crayon-num" data-line="crayon-5ac94b4268189241255059-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b4268189241255059-4">4</div><div class="crayon-num" data-line="crayon-5ac94b4268189241255059-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b4268189241255059-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">dnf </span><span class="crayon-e">search </span><span class="crayon-e">pyqt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b4268189241255059-2"><span class="crayon-v">PyQt</span><span class="crayon-sy">.</span><span class="crayon-v">x86_64</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Python </span><span class="crayon-e">bindings </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">Qt3</span></div><div class="crayon-line" id="crayon-5ac94b4268189241255059-3"><span class="crayon-v">PyQt4</span><span class="crayon-sy">.</span><span class="crayon-v">x86_64</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Python </span><span class="crayon-e">bindings </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">Qt4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b4268189241255059-4"><span class="crayon-v">python</span><span class="crayon-o">-</span><span class="crayon-v">qt5</span><span class="crayon-sy">.</span><span class="crayon-v">x86_64</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">PyQt5 </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">Python </span><span class="crayon-e">bindings </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">Qt5</span></div><div class="crayon-line" id="crayon-5ac94b4268189241255059-5"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>一旦你找到要安装的软件包的名称后，使用 <code>install</code> 子命令执行实际的下载和自动安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b426818d335418586" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ sudo dnf install python-qt5
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b426818d335418586-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b426818d335418586-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b426818d335418586-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">dnf </span><span class="crayon-e">install </span><span class="crayon-v">python</span><span class="crayon-o">-</span><span class="crayon-i">qt5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b426818d335418586-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>有关从软件仓库安装的具体信息，请参阅你的 Linux 发行版的文档。</p>
<p>图形工具通常也是如此。搜索你认为你想要的，然后安装它。</p>
<p><img class="aligncenter" src="http://jbcdn2.b0.upaiyun.com/2018/03/b69db96d52abf01b5c5bca4a7945bcb0.png" alt=""></p>
<p>与底层命令一样，图形安装程序的名称取决于你正在运行的 Linux 发行版。相关的应用程序通常使用“软件（software）”或“包（package）”等关键字进行标记，因此请在你的启动项或菜单中搜索这些词汇，然后你将找到所需的内容。 由于开源全由用户来选择，所以如果你不喜欢你的发行版提供的图形用户界面（GUI），那么你可以选择安装替代品。 你知道该如何做到这一点。</p>
<h4 id="toc_2">额外仓库</h4>
<p>你的 Linux 发行版为其打包的软件提供了标准仓库，通常也有额外的仓库。例如，<a href="https://fedoraproject.org/wiki/EPEL">EPEL</a> 服务于 Red Hat Enterprise Linux 和 CentOS，<a href="http://rpmfusion.org">RPMFusion</a> 服务于 Fedora，Ubuntu 有各种级别的支持以及个人包存档（PPA），<a href="http://packman.links2linux.org/">Packman</a> 为 OpenSUSE 提供额外的软件以及 <a href="http://slackbuilds.org">SlackBuilds.org</a> 为 Slackware 提供社区构建脚本。</p>
<p>默认情况下，你的 Linux 操作系统设置为只查看其官方仓库，因此如果你想使用其他软件集合，则必须自己添加额外库。你通常可以像安装软件包一样安装仓库。实际上，当你安装例如 <a href="https://ring.cx/en/download/gnu-linux">GNU Ring</a> 视频聊天，<a href="http://vivaldi.com">Vivaldi</a> web 浏览器，谷歌浏览器等许多软件时，你的实际安装是访问他们的私有仓库，从中将最新版本的应用程序安装到你的机器上。</p>
<p><img class="aligncenter" title="Installing a repo" src="http://jbcdn2.b0.upaiyun.com/2018/03/9c5806b523c1a55ae242c8aa66c46bcc.png" alt="Installing a repo"></p>
<p style="text-align: center"><em>安装仓库</em></p>
<p>你还可以通过编辑文本文件将仓库手动添加到你的软件包管理器的配置目录，或者运行命令来添加添加仓库。像往常一样，你使用的确切命令取决于 Linux 发行版本。例如，这是一个 <code>dnf</code> 命令，它将一个仓库添加到系统中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b4268191328559928" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ sudo dnf config-manager --add-repo=http://example.com/pub/centos/7
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b4268191328559928-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b4268191328559928-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b4268191328559928-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">dnf </span><span class="crayon-v">config</span><span class="crayon-o">-</span><span class="crayon-v">manager</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-v">add</span><span class="crayon-o">-</span><span class="crayon-v">repo</span><span class="crayon-o">=</span><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//example.com/pub/centos/7</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b4268191328559928-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<h3 id="toc_3">不使用仓库来安装应用程序</h3>
<p>仓库模型非常流行，因为它提供了用户（你）和开发人员之间的链接。重要更新发布之后，系统会提示你接受更新，并且你可以从一个集中位置接受所有更新。</p>
<p>然而，有时候一个软件包还没有放到仓库中时。这些安装包有几种形式。</p>
<h4 id="toc_4">Linux 包</h4>
<p>有时候，开发人员会以通用的 Linux 打包格式分发软件，例如 RPM、DEB 或较新但非常流行的 FlatPak 或 Snap 格式。你不是访问仓库下载的，你只是得到了这个包。</p>
<p>例如，视频编辑器 <a href="https://www.lwks.com/">Lightworks</a> 为 APT 用户提供了一个 <code>.deb</code> 文件，RPM 用户提供了 <code>.rpm</code> 文件。当你想要更新时，可以到网站下载最新的适合的文件。</p>
<p>这些一次性软件包可以使用从仓库进行安装时所用的一样的工具进行安装。如果双击下载的软件包，图形安装程序将启动并逐步完成安装过程。</p>
<p>或者，你可以从终端进行安装。这里的区别在于你从互联网下载的独立包文件不是来自仓库。这是一个“本地”安装，这意味着你的软件安装包不需要下载来安装。大多数软件包管理器都是透明处理的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b4268196460846179" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ sudo dnf install ~/Downloads/lwks-14.0.0-amd64.rpm
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b4268196460846179-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b4268196460846179-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b4268196460846179-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">sudo </span><span class="crayon-e">dnf </span><span class="crayon-v">install</span><span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-o">/</span><span class="crayon-v">Downloads</span><span class="crayon-o">/</span><span class="crayon-v">lwks</span><span class="crayon-o">-</span><span class="crayon-cn">14.0.0</span><span class="crayon-o">-</span><span class="crayon-v">amd64</span><span class="crayon-sy">.</span><span class="crayon-i">rpm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b4268196460846179-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>在某些情况下，你需要采取额外的步骤才能使应用程序运行，因此请仔细阅读有关你正在安装软件的文档。</p>
<h4 id="toc_5">通用安装脚本</h4>
<p>一些开发人员以几种通用格式发布他们的包。常见的扩展名包括 <code>.run</code> 和 <code>.sh</code>。NVIDIA 显卡驱动程序、像 Nuke 和 Mari 这样的 Foundry visual FX 软件包以及来自 <a href="http://gog.com">GOG</a> 的许多非 DRM 游戏都是用这种安装程序。（LCTT 译注：DRM 是数字版权管理。）</p>
<p>这种安装模式依赖于开发人员提供安装“向导”。一些安装程序是图形化的，而另一些只是在终端中运行。</p>
<p>有两种方式来运行这些类型的安装程序。</p>
<p>1、 你可以直接从终端运行安装程序：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b426819a822463072" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
$ sh ./game/gog_warsow_x.y.z.sh
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b426819a822463072-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b426819a822463072-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b426819a822463072-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-i">sh</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-o">/</span><span class="crayon-v">game</span><span class="crayon-o">/</span><span class="crayon-v">gog_warsow_x</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">z</span><span class="crayon-sy">.</span><span class="crayon-i">sh</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b426819a822463072-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>2、 另外，你可以通过标记其为可执行文件来运行它。要标记为安装程序可执行文件，右键单击它的图标并选择其属性。</p>
<p><img class="aligncenter" title="Giving an installer executable permission" src="http://jbcdn2.b0.upaiyun.com/2018/03/819db3a7089befb230a5c94d66686b4c.jpg" alt="Giving an installer executable permission"></p>
<p style="text-align: center"><em>给安装程序可执行权限。</em></p>
<p>一旦你允许其运行，双击图标就可以安装了。</p>
<p><img class="aligncenter" title="GOG installer" src="http://jbcdn2.b0.upaiyun.com/2018/03/53afe89b824042f9a90daabea5e29cba.jpg" alt="GOG installer"></p>
<p style="text-align: center"><em>GOG 安装程序</em></p>
<p>对于其余的安装程序，只需要按照屏幕上的说明进行操作。</p>
<h4 id="toc_6">AppImage 便携式应用程序</h4>
<p>AppImage 格式对于 Linux 相对来说比较新，尽管它的概念是基于 NeXT 和 Rox 的。这个想法很简单：运行应用程序所需的一切都应该放在一个目录中，然后该目录被视为一个“应用程序”。要运行该应用程序，只需双击该图标即可运行。不需要也要不应该把应用程序安装在传统意义的地方；它从你在硬盘上的任何地方运行都行。</p>
<p>尽管它可以作为独立应用运行，但 AppImage 通常提供一些系统集成。</p>
<p><img class="aligncenter" title="AppImage system integration" src="http://jbcdn2.b0.upaiyun.com/2018/03/59ee2073d407653a05fa297c873d7446.png" alt="AppImage system integration"></p>
<p style="text-align: center"><em>AppImage 系统集成</em></p>
<p>如果你接受此条件，则将一个本地的 <code>.desktop</code> 文件安装到你的主目录。<code>.desktop</code> 文件是 Linux 桌面的应用程序菜单和 mimetype 系统使用的一个小配置文件。实质上，只是将桌面配置文件放置在主目录的应用程序列表中“安装”应用程序，而不实际安装它。你获得了安装某些东西的所有好处，以及能够在本地运行某些东西的好处，即“便携式应用程序”。</p>
<h4 id="toc_7">应用程序目录</h4>
<p>有时，开发人员只是编译一个应用程序，然后将结果发布到下载中，没有安装脚本，也没有打包。通常，这意味着你下载了一个 TAR 文件，然后 <a href="https://opensource.com/article/17/7/how-unzip-targz-file">解压缩</a>，然后双击可执行文件（通常是你下载软件的名称）。</p>
<p><img class="aligncenter" title="Twine downloaded for Linux" src="http://jbcdn2.b0.upaiyun.com/2018/03/8ebbfff11cc8cda27c3cacbbc6fa7f4f.jpg" alt="Twine downloaded for Linux"></p>
<p style="text-align: center"><em>下载 Twine</em></p>
<p>当使用这种软件方式交付时，你可以将它放在你下载的地方，当你需要它时，你可以手动启动它，或者你可以自己进行快速但是麻烦的安装。这包括两个简单的步骤：</p>
<ol>
<li>将目录保存到一个标准位置，并在需要时手动启动它。</li>
<li>将目录保存到一个标准位置，并创建一个 <code>.desktop</code> 文件，将其集成到你的系统中。</li>
</ol>
<p>如果你只是为自己安装应用程序，那么传统上会在你的主目录中放个 <code>bin</code> （“二进制文件binary” 的简称）目录作为本地安装的应用程序和脚本的存储位置。如果你的系统上有其他用户需要访问这些应用程序，传统上将二进制文件放置在 <code>/opt</code> 中。最后，这取决于你存储应用程序的位置。</p>
<p>下载通常以带版本名称的目录进行，如 <code>twine_2.13</code> 或者 <code>pcgen-v6.07.04</code>。由于假设你将在某个时候更新应用程序，因此将版本号删除或创建目录的符号链接是个不错的主意。这样，即使你更新应用程序本身，为应用程序创建的启动程序也可以保持不变。</p>
<p>要创建一个 <code>.desktop</code> 启动文件，打开一个文本编辑器并创建一个名为 <code>twine.desktop</code> 的文件。<a href="https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html">桌面条目规范</a> 由 <a href="http://freedesktop.org">FreeDesktop.org</a> 定义。下面是一个简单的启动器，用于一个名为 Twine 的游戏开发 IDE，安装在系统范围的 <code>/opt</code> 目录中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b426819f569327940" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
[Desktop Entry]
Encoding=UTF-8
Name=Twine
GenericName=Twine
Comment=Twine
Exec=/opt/twine/Twine
Icon=/usr/share/icons/oxygen/64x64/categories/applications-games.png
Terminal=false
Type=Application
Categories=Development;IDE;
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b426819f569327940-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b426819f569327940-2">2</div><div class="crayon-num" data-line="crayon-5ac94b426819f569327940-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b426819f569327940-4">4</div><div class="crayon-num" data-line="crayon-5ac94b426819f569327940-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b426819f569327940-6">6</div><div class="crayon-num" data-line="crayon-5ac94b426819f569327940-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b426819f569327940-8">8</div><div class="crayon-num" data-line="crayon-5ac94b426819f569327940-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b426819f569327940-10">10</div><div class="crayon-num" data-line="crayon-5ac94b426819f569327940-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b426819f569327940-1"><span class="crayon-sy">[</span><span class="crayon-e">Desktop </span><span class="crayon-v">Entry</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b426819f569327940-2"><span class="crayon-v">Encoding</span><span class="crayon-o">=</span><span class="crayon-v">UTF</span><span class="crayon-o">-</span><span class="crayon-cn">8</span></div><div class="crayon-line" id="crayon-5ac94b426819f569327940-3"><span class="crayon-v">Name</span><span class="crayon-o">=</span><span class="crayon-e">Twine</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b426819f569327940-4"><span class="crayon-v">GenericName</span><span class="crayon-o">=</span><span class="crayon-e">Twine</span></div><div class="crayon-line" id="crayon-5ac94b426819f569327940-5"><span class="crayon-v">Comment</span><span class="crayon-o">=</span><span class="crayon-e">Twine</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b426819f569327940-6"><span class="crayon-v">Exec</span><span class="crayon-o">=</span><span class="crayon-o">/</span><span class="crayon-v">opt</span><span class="crayon-o">/</span><span class="crayon-v">twine</span><span class="crayon-o">/</span><span class="crayon-e">Twine</span></div><div class="crayon-line" id="crayon-5ac94b426819f569327940-7"><span class="crayon-v">Icon</span><span class="crayon-o">=</span><span class="crayon-o">/</span><span class="crayon-v">usr</span><span class="crayon-o">/</span><span class="crayon-v">share</span><span class="crayon-o">/</span><span class="crayon-v">icons</span><span class="crayon-o">/</span><span class="crayon-v">oxygen</span><span class="crayon-o">/</span><span class="crayon-cn">64x64</span><span class="crayon-o">/</span><span class="crayon-v">categories</span><span class="crayon-o">/</span><span class="crayon-v">applications</span><span class="crayon-o">-</span><span class="crayon-v">games</span><span class="crayon-sy">.</span><span class="crayon-e">png</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b426819f569327940-8"><span class="crayon-v">Terminal</span><span class="crayon-o">=</span><span class="crayon-t">false</span></div><div class="crayon-line" id="crayon-5ac94b426819f569327940-9"><span class="crayon-v">Type</span><span class="crayon-o">=</span><span class="crayon-e">Application</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b426819f569327940-10"><span class="crayon-v">Categories</span><span class="crayon-o">=</span><span class="crayon-v">Development</span><span class="crayon-sy">;</span><span class="crayon-v">IDE</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5ac94b426819f569327940-11"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>棘手的一行是 <code>Exec</code> 行。它必须包含一个有效的命令来启动应用程序。通常，它只是你下载的东西的完整路径，但在某些情况下，它更复杂一些。例如，Java 应用程序可能需要作为 Java 自身的参数启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b42681a3674266825" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
Exec=java -jar /path/to/foo.jar
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b42681a3674266825-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b42681a3674266825-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b42681a3674266825-1"><span class="crayon-v">Exec</span><span class="crayon-o">=</span><span class="crayon-v">java</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">jar</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">path</span><span class="crayon-o">/</span><span class="crayon-st">to</span><span class="crayon-o">/</span><span class="crayon-v">foo</span><span class="crayon-sy">.</span><span class="crayon-i">jar</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b42681a3674266825-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>有时，一个项目包含一个可以运行的包装脚本，这样你就不必找出正确的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac94b42681a7290848681" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
Exec=/opt/foo/foo-launcher.sh
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac94b42681a7290848681-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac94b42681a7290848681-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac94b42681a7290848681-1"><span class="crayon-v">Exec</span><span class="crayon-o">=</span><span class="crayon-o">/</span><span class="crayon-v">opt</span><span class="crayon-o">/</span><span class="crayon-v">foo</span><span class="crayon-o">/</span><span class="crayon-v">foo</span><span class="crayon-o">-</span><span class="crayon-v">launcher</span><span class="crayon-sy">.</span><span class="crayon-i">sh</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac94b42681a7290848681-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>在这个 Twine 例子中，没有与该下载的软件捆绑的图标，因此示例 <code>.desktop</code> 文件指定了 KDE 桌面附带的通用游戏图标。你可以使用类似的解决方法，但如果你更具艺术性，可以创建自己的图标，或者可以在 Internet 上搜索一个好的图标。只要 <code>Icon</code> 行指向一个有效的 PNG 或 SVG 文件，你的应用程序就会以该图标为代表。</p>
<p>示例脚本还将应用程序类别主要设置为 Development，因此在 KDE、GNOME 和大多数其他应用程序菜单中，Twine 出现在开发类别下。</p>
<p>为了让这个例子出现在应用程序菜单中，把 <code>twine.desktop</code> 文件放这到两个地方之一：</p>
<ul>
<li>如果你将应用程序存储在你自己的家目录下，那么请将其放在 <code>~/.local/share/applications</code>。</li>
<li>如果你将应用程序存储在 <code>/opt</code> 目录或者其他系统范围的位置，并希望它出现在所有用户的应用程序菜单中，请将它放在 <code>/usr/share/applications</code> 目录中。</li>
</ul>
<p>现在，该应用程序已安装，因为它需要与系统的其他部分集成。</p>
<h3 id="toc_8">从源代码编译</h3>
<p>最后，还有真正的通用格式安装格式：源代码。从源代码编译应用程序是学习如何构建应用程序，如何与系统交互以及如何定制应用程序的好方法。尽管如此，它绝不是一个点击按钮式过程。它需要一个构建环境，通常需要安装依赖库和头文件，有时还要进行一些调试。</p>
<p>要了解更多关于从源代码编译的内容，请阅读<a href="https://opensource.com/article/17/10/open-source-cats">我这篇文章</a>。</p>
<h3 id="toc_9">现在你明白了</h3>
<p>有些人认为安装软件是一个神奇的过程，只有开发人员理解，或者他们认为它“激活”了应用程序，就好像二进制可执行文件在“安装”之前无效。学习许多不同的安装方法会告诉你安装实际上只是“将文件从一个地方复制到系统中适当位置”的简写。 没有什么神秘的。只要你去了解每次安装，不是期望应该如何发生，并且寻找开发者为安装过程设置了什么，那么通常很容易，即使它与你的习惯不同。</p>
<p>重要的是安装器要诚实于你。 如果你遇到未经你的同意尝试安装其他软件的安装程序（或者它可能会以混淆或误导的方式请求同意），或者尝试在没有明显原因的情况下对系统执行检查，则不要继续安装。</p>
<p>好的软件是灵活的、诚实的、开放的。 现在你知道如何在你的计算机上获得好软件了。</p>
<p> </p>

        
        
        
    <div class="post-adds">
        <span data-post-id="113793" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113793votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113793" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 2 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i> 1 评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《如何在 Linux 上安装应用程序》",
	pic:"http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="给初学者的 type 命令教程" target="_blank" href="http://blog.jobbole.com/113817/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">给初学者的 type 命令教程</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="为初学者准备的 ln 命令教程（5 个示例）" target="_blank" href="http://blog.jobbole.com/113800/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">为初学者准备的 ln 命令教程（5 个示例）</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux 中的“大内存页”（hugepage）是个什么？" target="_blank" href="http://blog.jobbole.com/113782/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux 中的“大内存页”（hugepage）是个什么？</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="du 及 df 命令的使用（附带示例）" target="_blank" href="http://blog.jobbole.com/113780/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">du 及 df 命令的使用（附带示例）</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux 新用户？来试试这 8 款重要的软件" target="_blank" href="http://blog.jobbole.com/113775/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux 新用户？来试试这 8 款重要的软件</a>
                                            </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113793/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113793%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113793%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113793%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113793%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113793%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

                    <h5 id="comments" class="sub-title"><i class="glyphicon"></i>最新评论</h5>
            <ul class="cmnt-list">

                        <li id="comment-162367" class="comment cmnt odd">
    
    <div class="cmnt-box">
        <div class="cmnt-header">
                            <a href="http://www.jobbole.com/members/q2657976901" class="cmnt-img"><img width="37" height="37" src="http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png" alt=""></a>
                <div class="cmnt-meta">
                    <span><a href="http://www.jobbole.com/members/q2657976901">幸福丶来敲门</a><label class="comment_author_data"> </label></span>
                    <span class="c-title">
                                             </span>

                    <span class="c-date">
                        <a href="http://blog.jobbole.com/113793/#comment-162367">03/28</a>
                    </span>

                    
                    
                </div>
                    </div>
        <div class="cmnt-body">
            <p>
                </p><p>很好</p>
            
                    </div>
                    <div class="cmnt-footer">

                
                <p class="c-like">
                    <a title="赞同" alt="赞同" class="162367voteflag  t-up  href-style vote-comment-up  register-user-only   " data-comment-id="162367"><i class="fa fa-thumbs-o-up"></i> <span id="162367voteuptotal"> 赞</span></a>

                    
                    <a rel="nofollow" class="comment-reply-link register-user-only" href="http://blog.jobbole.com/113793/?replytocom=162367#respond" data-onclick='return addComment.moveForm( "comment-162367", "162367", "respond", "113793" )' aria-label="回复给幸福丶来敲门">回复 <i class="fa fa-reply"></i></a>
                </p>
            </div>
            </div>
    </li>
<!-- #comment-## -->
            </ul>
        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113793/
url_object_id:d750eaa333832623ef22835422172102
front_image_url:['http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg']
front_image_path:full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg
tag:IT技术-Linux









title:计算机如何感知大数据——聚类算法
create_date:2018/04/04
praise_nums:2
fav_nums:1
comments_nums:0
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113745 post type-post status-publish format-standard hentry category-it-tech tag-4018 tag-bigdata tag-3997 odd" id="post-113745">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>计算机如何感知大数据——聚类算法</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/04/04 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
            

            
             ·  <a href="http://blog.jobbole.com/tag/%e5%9b%be%e8%ae%ba/">图论</a>, <a href="http://blog.jobbole.com/tag/bigdata/">大数据</a>, <a href="http://blog.jobbole.com/tag/%e8%81%9a%e7%b1%bb/">聚类</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">本文由 <a href="http://blog.jobbole.com">伯乐在线</a> - <a href="http://www.jobbole.com/members/shaoai37">LynnShaw</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target="_blank" href="https://medium.freecodecamp.com/how-machines-make-sense-of-big-data-an-introduction-to-clustering-algorithms-4bd97d4fbaba">Peter Gleeso</a>。欢迎加入<a target="_blank" href="http://group.jobbole.com/category/feedback/trans-team/">翻译组</a>。</div><p>看看下面这张图片。这是一个不同形状大小的昆虫的集合。花点时间按照相似程度将它们分成几组。</p>
<p>这不是什么很有技巧性的问题。 我们从把蜘蛛分到一起开始。</p>
<h6 class="section-inner sectionLayout--outsetColumn" style="text-align: center;"><img src="http://wx4.sinaimg.cn/mw690/63918611gy1fpachr4a3bj20rs0daags.jpg"></h6>
<h6 style="text-align: center;">图片来自Google图片搜索，标记以便重用</h6>
<p>做完了吗？虽然这里没有必要有所谓的正确答案，不过你极有可能将这些虫子分成四组。蜘蛛分成一组，蜗牛一组，蝴蝶和蛾子一族，黄蜂和蜜蜂总共三个一组。</p>
<p class="section-inner sectionLayout--outsetColumn">不算太糟糕，是吧？如果虫子数量是这个的两倍你可能还是会这么分，对吧？如果你有空余的时间——或者对昆虫学的热情——你甚至可能用相同方法对一百年个虫子这样分类。</p>
<p class="section-inner sectionLayout--outsetColumn">然而对一个机器来说，将十个目标分成多个有意义的群组是个不小的任务，多亏了数学中一个令人费解的分支<a href="https://en.wikipedia.org/wiki/Bell_number">组合数学</a>，它告诉我们将十个昆虫分组共有115975种不同的可能。如果对二十个虫子进行分组，将会有<a href="https://www.wolframalpha.com/input/?i=bell%27s+number+%2820%29">超过五十万亿</a>种不同的可能。</p>
<p class="section-inner sectionLayout--outsetColumn"> 如果对一百个虫子分类——方案数将是<a href="https://www.wolframalpha.com/input/?i=particles+in+universe">宇宙中粒子的数量</a>的很多倍。多少倍呢？通过我的计算，大概是<a href="https://www.wolframalpha.com/input/?i=BellB%5B100%5D+%2F+number+of+particles+in+universe">5*10的35次方倍</a>。事实上，有<a href="https://www.wolframalpha.com/input/?i=BellB%5B100%5D+%2F+googol">四千万亿googol</a>多种方案（<a href="https://www.wolframalpha.com/input/?i=googol">什么是googol?</a>）。仅仅是一百个目标。</p>
<p class="section-inner sectionLayout--outsetColumn">而这些方案几乎都是没有意义的——虽然从这些数量异常庞大的可能的选择中，你可以很快地找到为数不多的对虫子分类的有用的方式。</p>
<p class="section-inner sectionLayout--outsetColumn">我们人类理所当然的可以很快地对大量数据理解并分类。无论是一段文字，或者屏幕上的图像，或是一系列的目标——人类通常可以相当有效地搞清世界给我们的任何数据。</p>
<p class="section-inner sectionLayout--outsetColumn">鉴于发展人工智能和机器学习的一个关键方面就是让机器迅速理解庞大的输入数据集，那么有什么捷径吗？在这本文中，你将会看到三个聚类算法，机器可以这些算法快速理解大型数据集。这决不是一个详尽的清单——还有很多其他的算法——但这三个算法代表了一个良好的开端！</p>
<p class="section-inner sectionLayout--outsetColumn">当你想要使用它们的时候，你会得到对于每一个问题的总结，一个总体的功能介绍以及一个更细致的，一步一步实现的例子。我相信在现实中实现对于理解是非常有帮助的。如果你真的<em>很喜欢</em>这些，你会发现最好的学习方式是用笔和纸。加油去吧——没人评判哪种方式更好！</p>
<h6 class="section-inner sectionLayout--outsetColumn" style="text-align: center;"><img src="http://wx3.sinaimg.cn/mw690/63918611gy1fpachstvd8j20m80em762.jpg"></h6>
<h6 class="section-inner sectionLayout--outsetColumn" style="text-align: center;">三个整齐的聚类，K=3</h6>
<h3 id="c662" class="graf graf--h3 graf-after--figure">K-均值聚类</h3>
<h4 id="cf9b" class="graf graf--h4 graf-after--h3"><strong>适用场景：</strong></h4>
<p>预先已经知道要分成多少组。</p>
<h4 id="71dc" class="graf graf--h4 graf-after--p"><strong>如何工作：</strong></h4>
<p id="ad35" class="graf graf--p graf-after--h4">算法首先将每一个观测点随机地分配到<em>K</em>个类别中的一个，然后计算每一个类别的<em>均值</em>。下一步，在重新计算均值之前算法将每一个点重新分配给均值与该点数据最接近的类别。不断重复这一步直到不需要再重新分配。</p>
<h4 id="6699" class="graf graf--h4 graf-after--p"><strong>实现例子：</strong></h4>
<p id="cd33" class="graf graf--p graf-after--h4">考虑有12个足球运动员的一个足球队，这些运动员每个人在本赛季都获得了一定的进球数（3-30之间）。现在我们来将他们分成三个单独的聚类。</p>
<p class="graf graf--p graf-after--h4"><strong>第一步</strong>需要我们随机地将这些运动员分成三组并计算每组的均值。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbf8b822505775" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
Group 1
Player A (5 goals), Player B (20 goals), Player C (11 goals) 
Group Mean = (5 + 20 + 11) / 3 = 12

Group 2
Player D (5 goals), Player E (3 goals), Player F (19 goals)
Group Mean = 9

Group 3
Player G (30 goals), Player H (3 goals), Player I (15 goals)
Group Mean = 16</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbf8b822505775-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf8b822505775-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf8b822505775-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf8b822505775-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf8b822505775-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf8b822505775-6">6</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf8b822505775-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf8b822505775-8">8</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf8b822505775-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf8b822505775-10">10</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf8b822505775-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbf8b822505775-1"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf8b822505775-2"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">A</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">B</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">C</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">11</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5ac97c4bbbf8b822505775-3"><span class="crayon-e">Group </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf8b822505775-4"> </div><div class="crayon-line" id="crayon-5ac97c4bbbf8b822505775-5"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf8b822505775-6"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">D</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">E</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">F</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">19</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c4bbbf8b822505775-7"><span class="crayon-e">Group </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf8b822505775-8"> </div><div class="crayon-line" id="crayon-5ac97c4bbbf8b822505775-9"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf8b822505775-10"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">G</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">30</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">H</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">I</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">15</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c4bbbf8b822505775-11"><span class="crayon-e">Group </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0029 seconds] -->
<p></p>
<p class="graf graf--p graf-after--h4"><strong>第二步：</strong>对每一个运动员，将它们重新分配到均值离他们最近的组。即，运动员A（进球数5）被分配到第2个组（均值=9）。然后重新计算这几组的均值。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbf95843918449" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
Group 1 (Old Mean = 12)
Player C (11 goals) 
New Mean = 11

Group 2 (Old Mean = 9)
Player A (5 goals), Player D (5 goals), Player E (3 goals), Player H (3 goals)
New Mean = 4

Group 3 (Old Mean = 16)
Player G (30 goals), Player I (15 goals), Player B (20 goals), Player F (19 goals)
New Mean = 21</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbf95843918449-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf95843918449-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf95843918449-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf95843918449-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf95843918449-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf95843918449-6">6</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf95843918449-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf95843918449-8">8</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf95843918449-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbf95843918449-10">10</div><div class="crayon-num" data-line="crayon-5ac97c4bbbf95843918449-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbf95843918449-1"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Old </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf95843918449-2"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">C</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">11</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5ac97c4bbbf95843918449-3"><span class="crayon-r">New</span><span class="crayon-h"> </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">11</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf95843918449-4"> </div><div class="crayon-line" id="crayon-5ac97c4bbbf95843918449-5"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Old </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">9</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf95843918449-6"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">A</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">D</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">E</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">H</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c4bbbf95843918449-7"><span class="crayon-r">New</span><span class="crayon-h"> </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf95843918449-8"> </div><div class="crayon-line" id="crayon-5ac97c4bbbf95843918449-9"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Old </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">16</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbf95843918449-10"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">G</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">30</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">I</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">15</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">B</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">F</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">19</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c4bbbf95843918449-11"><span class="crayon-r">New</span><span class="crayon-h"> </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">21</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<p>不断<strong>重复</strong>第二步直到所有组的均值不再变化。对于这个有些不太好的例子，下一次重复就会达到终止条件。<strong>停止！</strong>现在你已经形成三个聚类的数据集！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfa7033106772" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
Group 1 (Old Mean = 11)
Player C (11 goals), Player I (15 goals)
Final Mean = 13

Group 2 (Old Mean = 4)
Player A (5 goals), Player D (5 goals), Player E (3 goals), Player H (3 goals)
Final Mean = 4

Group 3 (Old Mean = 21)
Player G (30 goals), Player B (20 goals), Player F (19 goals)
Final Mean = 23</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfa7033106772-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfa7033106772-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfa7033106772-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfa7033106772-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfa7033106772-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfa7033106772-6">6</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfa7033106772-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfa7033106772-8">8</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfa7033106772-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfa7033106772-10">10</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfa7033106772-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfa7033106772-1"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Old </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfa7033106772-2"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">C</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">11</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">I</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">15</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfa7033106772-3"><span class="crayon-m">Final</span><span class="crayon-h"> </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">13</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfa7033106772-4"> </div><div class="crayon-line" id="crayon-5ac97c4bbbfa7033106772-5"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Old </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfa7033106772-6"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">A</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">D</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">E</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">H</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfa7033106772-7"><span class="crayon-m">Final</span><span class="crayon-h"> </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfa7033106772-8"> </div><div class="crayon-line" id="crayon-5ac97c4bbbfa7033106772-9"><span class="crayon-i">Group</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Old </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">21</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfa7033106772-10"><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">G</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">30</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">B</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">Player</span><span class="crayon-h"> </span><span class="crayon-e">F</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">19</span><span class="crayon-h"> </span><span class="crayon-v">goals</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfa7033106772-11"><span class="crayon-m">Final</span><span class="crayon-h"> </span><span class="crayon-v">Mean</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">23</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->
<p>在这个例子中，聚类可能对应于球员在场上的位置——如后卫、中场和前锋。k-均值在这里使用因为我们合理地预期数据可以分成这三类。</p>
<p>通过这种方式，给出一系列性能统计数据，机器可以合理地评估任何团体运动中运动员的位置——这对运动分析很有用，对任何其他的将数据集按照预定义的组别进行分类也可以提供相关的见解。</p>
<h4 id="27e9" class="graf graf--h4 graf-after--p"><strong>细节：</strong></h4>
<p id="7aa0" class="graf graf--p graf-after--h4">这个算法有一些变体。对聚类进行“seeding”的初始化方法有好几种方式。在这里，我们将每个球员随机分配到一个小组，然后计算出这些组的均值。这会导致初始生成的组之间的均值很接近，致使后面有更多重复步骤。</p>
<p class="graf graf--p graf-after--h4">另一种方法是初始化每个聚类时只分配一个球员，然后将其它球员分配到最近的聚类。这样返回的聚类比初始化seeding得到的聚类更有意义，降低了变化很大的数据集中的重复性。但是，这种方法可能会减少完成算法所需的迭代次数，因为这些组将花费较少的时间完成收敛。</p>
<p class="graf graf--p graf-after--h4">K-均值聚类的一个明显的缺点是你必须提供关于你期望找到多少个聚类的<em>先验</em>假设。 有一些方法可以评估一组特定的聚类结果。 例如，聚类内平方和（<em class="markup--em markup--p-em">Within-Cluster  </em><a href="https://en.wikipedia.org/wiki/Partition_of_sums_of_squares"><em>Sum-of-Squares</em></a>）是每个聚类内方差的度量。 聚类效果越好，整体WCSS越低。</p>
<h3 id="acbe" class="graf graf--h3 graf-after--p">层次聚类</h3>
<h4 id="1eb8" class="graf graf--h4 graf-after--h3"><strong>什么时候使用：</strong></h4>
<p>…你希望发掘出你的观测数据之间的潜在关系。</p>
<p><strong>如何工作：</strong></p>
<p id="6625" class="graf graf--p graf-after--h4">计算距离矩阵，其中矩阵元素(i,j)的值是观察值i和j之间的距离度量值。 然后，将最接近的两个观察值进行配对并计算其平均值。通过将配对的观测值合并成一个单一的对象，形成一个新的距离矩阵。 从这个距离矩阵中，配对最近的两个观察值并计算它们的平均值。 重复这个过程，直到所有的观察结果合并在一起。</p>
<p><strong>实例：</strong></p>
<p id="6bb0" class="graf graf--p graf-after--h4">这是一个关于鲸鱼和海豚物种选择的超简化数据集。作为一名训练有素的生物学家，我可以向您保证，我们通常会使用更多更详细的数据集来<a href="https://en.wikipedia.org/wiki/Phylogenetic_tree">重建系统发生树</a>。 现在我们来看看这六种物种的典型体长。 我们将只使用两个重复的步骤。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfb2851195532" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
Species          Initials  Length(m)
Bottlenose Dolphin     BD        3.0
Risso's Dolphin        RD        3.6
Pilot Whale            PW        6.5
Killer Whale           KW        7.5
Humpback Whale         HW       15.0
Fin Whale              FW       20.0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfb2851195532-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfb2851195532-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfb2851195532-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfb2851195532-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfb2851195532-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfb2851195532-6">6</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfb2851195532-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfb2851195532-1"><span class="crayon-e">Species          </span><span class="crayon-e">Initials  </span><span class="crayon-e">Length</span><span class="crayon-sy">(</span><span class="crayon-v">m</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfb2851195532-2"><span class="crayon-e">Bottlenose </span><span class="crayon-e">Dolphin     </span><span class="crayon-i">BD</span><span class="crayon-h">        </span><span class="crayon-cn">3.0</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfb2851195532-3"><span class="crayon-i">Risso</span>'<span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-e">Dolphin        </span><span class="crayon-i">RD</span><span class="crayon-h">        </span><span class="crayon-cn">3.6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfb2851195532-4"><span class="crayon-e">Pilot </span><span class="crayon-e">Whale            </span><span class="crayon-i">PW</span><span class="crayon-h">        </span><span class="crayon-cn">6.5</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfb2851195532-5"><span class="crayon-e">Killer </span><span class="crayon-e">Whale           </span><span class="crayon-i">KW</span><span class="crayon-h">        </span><span class="crayon-cn">7.5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfb2851195532-6"><span class="crayon-e">Humpback </span><span class="crayon-e">Whale         </span><span class="crayon-i">HW</span><span class="crayon-h">       </span><span class="crayon-cn">15.0</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfb2851195532-7"><span class="crayon-e">Fin </span><span class="crayon-e">Whale              </span><span class="crayon-i">FW</span><span class="crayon-h">       </span><span class="crayon-cn">20.0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p></p>
<p class="graf graf--p graf-after--h4"><strong>步骤1：</strong>计算每个物种之间的距离矩阵。在这里，我们将使用<a href="https://en.wikipedia.org/wiki/Euclidean_distance">欧式距离</a>——数据点之间的距离。你可以计算出距离就像在道路图上查看距离图一样。可以通过读取相关行和列的交点处的值来查找任何物种对之间的长度差异。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfb6071663196" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
    BD   RD   PW   KW   HW
RD  0.6                    
PW  3.5  2.9               
KW  4.5  3.9  1.0          
HW 12.0 11.4  8.5  7.5     
FW 17.0 16.4 13.5 12.5  5.0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfb6071663196-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfb6071663196-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfb6071663196-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfb6071663196-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfb6071663196-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfb6071663196-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfb6071663196-1"><span class="crayon-h">    </span><span class="crayon-e">BD   </span><span class="crayon-e">RD   </span><span class="crayon-e">PW   </span><span class="crayon-e">KW   </span><span class="crayon-e">HW</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfb6071663196-2"><span class="crayon-i">RD</span><span class="crayon-h">  </span><span class="crayon-cn">0.6</span><span class="crayon-h">                    </span></div><div class="crayon-line" id="crayon-5ac97c4bbbfb6071663196-3"><span class="crayon-i">PW</span><span class="crayon-h">  </span><span class="crayon-cn">3.5</span><span class="crayon-h">  </span><span class="crayon-cn">2.9</span><span class="crayon-h">               </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfb6071663196-4"><span class="crayon-i">KW</span><span class="crayon-h">  </span><span class="crayon-cn">4.5</span><span class="crayon-h">  </span><span class="crayon-cn">3.9</span><span class="crayon-h">  </span><span class="crayon-cn">1.0</span><span class="crayon-h">          </span></div><div class="crayon-line" id="crayon-5ac97c4bbbfb6071663196-5"><span class="crayon-i">HW</span><span class="crayon-h"> </span><span class="crayon-cn">12.0</span><span class="crayon-h"> </span><span class="crayon-cn">11.4</span><span class="crayon-h">  </span><span class="crayon-cn">8.5</span><span class="crayon-h">  </span><span class="crayon-cn">7.5</span><span class="crayon-h">     </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfb6071663196-6"><span class="crayon-i">FW</span><span class="crayon-h"> </span><span class="crayon-cn">17.0</span><span class="crayon-h"> </span><span class="crayon-cn">16.4</span><span class="crayon-h"> </span><span class="crayon-cn">13.5</span><span class="crayon-h"> </span><span class="crayon-cn">12.5</span><span class="crayon-h">  </span><span class="crayon-cn">5.0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p></p>
<p id="7109" class="graf graf--p graf-after--pre"><strong>步骤2：</strong>配对两个最接近的物种。在这里，两个最接近的物种是宽吻海豚和灰海豚，平均长度为3.3米。</p>
<p id="d409" class="graf graf--p graf-after--p"><strong>重复</strong>步骤1重新计算距离矩阵，但是这次将宽吻海豚和灰海豚合并成长度为3.3m的单个对象。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfba921769152" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
    [BD, RD]   PW   KW   HW
PW       3.2               
KW       4.2   1.0          
HW      11.7   8.5  7.5     
FW      16.7  13.5 12.5  5.0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfba921769152-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfba921769152-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfba921769152-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfba921769152-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfba921769152-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfba921769152-1"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-v">BD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">RD</span><span class="crayon-sy">]</span><span class="crayon-h">   </span><span class="crayon-e">PW   </span><span class="crayon-e">KW   </span><span class="crayon-e">HW</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfba921769152-2"><span class="crayon-i">PW</span><span class="crayon-h">       </span><span class="crayon-cn">3.2</span><span class="crayon-h">               </span></div><div class="crayon-line" id="crayon-5ac97c4bbbfba921769152-3"><span class="crayon-i">KW</span><span class="crayon-h">       </span><span class="crayon-cn">4.2</span><span class="crayon-h">   </span><span class="crayon-cn">1.0</span><span class="crayon-h">          </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfba921769152-4"><span class="crayon-i">HW</span><span class="crayon-h">      </span><span class="crayon-cn">11.7</span><span class="crayon-h">   </span><span class="crayon-cn">8.5</span><span class="crayon-h">  </span><span class="crayon-cn">7.5</span><span class="crayon-h">     </span></div><div class="crayon-line" id="crayon-5ac97c4bbbfba921769152-5"><span class="crayon-i">FW</span><span class="crayon-h">      </span><span class="crayon-cn">16.7</span><span class="crayon-h">  </span><span class="crayon-cn">13.5</span><span class="crayon-h"> </span><span class="crayon-cn">12.5</span><span class="crayon-h">  </span><span class="crayon-cn">5.0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p></p>
<p id="77af" class="graf graf--p graf-after--pre"><strong>接下来</strong>，用这个新距离矩阵重复步骤2。现在，距离最小的是领航鲸与逆戟鲸，所以我们计算他们的平均——7.0米。</p>
<p class="graf graf--p graf-after--p"><strong>然后</strong>，我们重复第1步——重新计算距离矩阵，但是现在我们已经将领航鲸与逆戟鲸合并成了一个长度为7.0米的单个对象。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfbe184321328" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
         [BD, RD] [PW, KW]   HW
[PW, KW]      3.7              
HW           11.7      8.0     
FW           16.7     13.0   5.0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfbe184321328-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfbe184321328-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfbe184321328-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfbe184321328-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfbe184321328-1"><span class="crayon-h">         </span><span class="crayon-sy">[</span><span class="crayon-v">BD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">RD</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">PW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">KW</span><span class="crayon-sy">]</span><span class="crayon-h">   </span><span class="crayon-i">HW</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfbe184321328-2"><span class="crayon-sy">[</span><span class="crayon-v">PW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">KW</span><span class="crayon-sy">]</span><span class="crayon-h">      </span><span class="crayon-cn">3.7</span><span class="crayon-h">              </span></div><div class="crayon-line" id="crayon-5ac97c4bbbfbe184321328-3"><span class="crayon-i">HW</span><span class="crayon-h">           </span><span class="crayon-cn">11.7</span><span class="crayon-h">      </span><span class="crayon-cn">8.0</span><span class="crayon-h">     </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfbe184321328-4"><span class="crayon-i">FW</span><span class="crayon-h">           </span><span class="crayon-cn">16.7</span><span class="crayon-h">     </span><span class="crayon-cn">13.0</span><span class="crayon-h">   </span><span class="crayon-cn">5.0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p></p>
<p id="da48" class="graf graf--p graf-after--pre"><strong>接下来</strong>，我们用这个距离矩阵重复步骤2。最小距离是两个合并对象之间的（3.7米）——现在我们将它们合并成一个更大的对象，并取平均值（即5.2米）。</p>
<p class="graf graf--p graf-after--p"><strong>然后</strong>，我们重复步骤1并计算一个新的距离矩阵，合并了宽吻海豚和灰海豚与领航鲸与逆戟鲸。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfc2988756091" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
   [[BD, RD] , [PW, KW]]    HW
HW                   9.8    
FW                  14.8   5.0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfc2988756091-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfc2988756091-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfc2988756091-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfc2988756091-1"><span class="crayon-h">   </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-v">BD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">RD</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">PW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">KW</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h">    </span><span class="crayon-e">HW</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfc2988756091-2"><span class="crayon-i">HW</span><span class="crayon-h">                   </span><span class="crayon-cn">9.8</span><span class="crayon-h">    </span></div><div class="crayon-line" id="crayon-5ac97c4bbbfc2988756091-3"><span class="crayon-i">FW</span><span class="crayon-h">                  </span><span class="crayon-cn">14.8</span><span class="crayon-h">   </span><span class="crayon-cn">5.0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p></p>
<p id="cf09" class="graf graf--p graf-after--pre"><strong>接下来</strong>，我们重复步骤2。最小的距离（5.0米）在座头鲸与长须鲸之间，所以我们将它们合并成一个单一的对象，取平均值（17.5米）。</p>
<p id="a88d" class="graf graf--p graf-after--p"><strong>然后</strong>，返回步骤1——计算距离矩阵，座头鲸与长须鲸已经合并。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfc5596255937" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
         [[BD, RD] , [PW, KW]]
[HW, FW]                  12.3</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfc5596255937-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfc5596255937-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfc5596255937-1"><span class="crayon-h">         </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-v">BD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">RD</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">PW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">KW</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfc5596255937-2"><span class="crayon-sy">[</span><span class="crayon-v">HW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">FW</span><span class="crayon-sy">]</span><span class="crayon-h">                  </span><span class="crayon-cn">12.3</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p></p>
<p class="graf graf--p graf-after--p"><strong>最后</strong>，我们重复步骤2——在这个矩阵中只有一个距离（12.3米），我们把所有东西都放在一个大对象中，现在我们可以停下来了！我们来看看最后的合并对象：</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfc9340596776" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
[[[BD, RD],[PW, KW]],[HW, FW]]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfc9340596776-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfc9340596776-1"><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-v">BD</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">RD</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-sy">[</span><span class="crayon-v">PW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">KW</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-sy">[</span><span class="crayon-v">HW</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">FW</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p></p>
<p class="graf graf--p graf-after--p">它有一个嵌套的结构（可以认为是<a href="http://json.org/example.html">JSON</a>），可以把它绘制成一个树状的图形或者树形图。 它读取的方式与家谱相同。 两个观察结果在树上离得越近，就被认为是更相似或更密切相关的。</p>
<div class="aspectRatioPlaceholder is-locked"> <img src="http://wx4.sinaimg.cn/mw690/63918611gy1fpachtrft4j20dc0dc3yh.jpg"></div>
<p class="graf graf--p graf-after--p">在<a href="http://www.r-fiddle.org/#">R-Fiddle.org</a>上生成一个简单的树状图</p>
<p id="e2dc" class="graf graf--p graf-after--figure">树状图的结构使我们能够深入了解数据集的结构。在我们的例子中，我们看到两个主要分支，一个分支是 HW 和 FW，另一个是 BD、RD、PW、KW。</p>
<p id="5b08" class="graf graf--p graf-after--p">在进化生物学中，具有更多样本和测量的更大的数据集以这种方式被用来推断它们之间的分类关系。 除了生物学之外，层次聚类在数据挖掘和机器学习环境中也有应用。</p>
<p id="a111" class="graf graf--p graf-after--p">很酷的是，这种方法不需要假设你正在寻找的聚类数量。 您可以通过在给定高度“切割”树来将返回的树形图划分为聚类。 这个高度可以通过多种方式进行选择，具体取决于你希望对数据进行聚类的分辨率。</p>
<p id="c890" class="graf graf--p graf-after--p">例如，从上面的树状图可以看出，如果我们在高度为10的情况下绘制一条水平线，我们就会将两条主要分支分割，将树状图分成两个子图。 如果我们在高度= 2切割，树状图就被分成三个聚类。</p>
<p><strong>细节：</strong></p>
<p id="a2ce" class="graf graf--p graf-after--h4">关于层次聚类算法可以出现的变化，基本上有三个方面。</p>
<p class="graf graf--p graf-after--h4">最根本的是方法——在这里，我们使用了一个<em>凝聚</em>的过程，我们从单个数据点开始，并将它们迭代地聚集在一起，直到剩下一个大聚类。 另一种（但是计算量更大）的方法是从一个大聚类开始，然后将数据分成越来越小的聚类，直到剩下孤立的数据点为止。</p>
<p class="graf graf--p graf-after--h4">还有一系列的方法可以用来计算距离矩阵。 很多情况下，欧几里得距离（参考毕达哥拉斯定理）就足够了，但是在某些情况下还有其他可能更适用的选择。</p>
<p class="graf graf--p graf-after--h4">最后，连接标准也可以变化。 聚类根据彼此之间的距离而相互连接，但是我们定义“近”的方式是灵活的。 在上面的例子中，我们测量了每个组的平均值（或“质心”）之间的距离，并将最近的组进行配对。 但是， 你可能想要使用其他的定义。</p>
<p class="graf graf--p graf-after--h4">例如，每个聚类由多个离散点组成。 我们可以将两个聚类之间的距离定义为任意点之间的最小（或最大）距离——如下图所示。 还有其他方法来定义连接标准，它们可能适用于不同的环境。</p>
<p class="graf graf--p graf-after--h4"><img src="http://wx2.sinaimg.cn/mw690/63918611gy1fpachuzciuj20m80cgmyu.jpg"></p>
<p class="graf graf--p graf-after--h4" style="text-align: center;">红/蓝：形心连接；红色/绿色：最少连接；绿/蓝：最大连接</p>
<h3 id="b664" class="graf graf--h3 graf-after--figure">图社区发现</h3>
<h4 id="f884" class="graf graf--h4 graf-after--h3"><strong>什么时候使用：</strong></h4>
<p id="7a65" class="graf graf--p graf-after--h4">…你可以将数据表示为网络或“图”的时候。</p>
<h4 id="71dc" class="graf graf--h4 graf-after--p"><strong>如何工作：</strong></h4>
<p id="6e96" class="graf graf--p graf-after--h4">图中的社区通常被定义为与网络其余部分相比，彼此连接更多的顶点的子集。 存在各种算法来基于更具体的定义来识别社区。 算法包括但不限于：Edge Betweenness，Modularity-Maximsation，Walktrap，Clique Percolation，Leading Eigenvector …</p>
<h4 id="6699" class="graf graf--h4 graf-after--p"><strong>实现例子：</strong></h4>
<p id="6cc8" class="graf graf--p graf-after--h4"><a href="https://en.wikipedia.org/wiki/Graph_theory">图论</a>或网络的数学研究是数学的一个有趣的分支，它让我们将复杂系统建模为由“线”（或边）连接的“点”（或顶点）的抽象集合。</p>
<p id="a226" class="graf graf--p graf-after--p">最直观的案例研究也许就是社交网络了。在这里，顶点代表人，边连接的是朋友/关注者的顶点。 然而，如果你能证明一个方法可以有意义地连接不同的部分，任何系统都可以被建模为一个网络。 图论中聚类的创新应用包括从图像数据中提取特征，分析基因调控网络。</p>
<p id="30e4" class="graf graf--p graf-after--p">作为一个入门级的例子，看看这个快速组合在一起的图。 它显示了我最近访问过的八个网站，根据它们各自的维基百科文章是否彼此连接而连接在一起。 您可以手动组合这些数据，但是对于大型项目，编写Python脚本执行相同的操作要快得多。<a href="https://raw.githubusercontent.com/pg0408/Medium-articles/master/graph_maker.py">这是我之前写的一个</a>。</p>
<p id="3c6b" class="graf graf--p graf-after--figure"><img src="http://wx2.sinaimg.cn/mw690/63918611gy1fpachw50t6j20et093gm1.jpg"></p>
<p class="graf graf--p graf-after--figure">根据其社区成员对顶点进行着色，并根据其中心位置来确定大小。 看看Google和Twitter是最中心的吧？</p>
<p class="graf graf--p graf-after--p">而且，这些聚类在现实世界中也很有意义（一直一个重要的性能指标）。黄色的顶点通常是参考/搜索网站；蓝色顶点全部用于在线发布（文章，推文或代码）；红色的顶点包括YouTube，因为Youtube是由前PayPal员工创建的。 机器推论的不错！</p>
<p class="graf graf--p graf-after--p">除了作为有用的大型系统可视化的方式之外，网络的真正威力是其数学分析。 让我们开始把我们的这张网络图片变成一种更加数学的格式。 以下是网络的邻接矩阵。</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfd1794206287" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
         GH Gl  M  P  Q  T  W  Y
GitHub    0  1  0  0  0  1  0  0  
Google    1  0  1  1  1  1  1  1
Medium    0  1  0  0  0  1  0  0
PayPal    0  1  0  0  0  1  0  1
Quora     0  1  0  0  0  1  1  0
Twitter   1  1  1  1  1  0  0  1
Wikipedia 0  1  0  0  1  0  0  0
YouTube   0  1  0  1  0  1  0  0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfd1794206287-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfd1794206287-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfd1794206287-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfd1794206287-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfd1794206287-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfd1794206287-6">6</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfd1794206287-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfd1794206287-8">8</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfd1794206287-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfd1794206287-1"><span class="crayon-h">         </span><span class="crayon-e">GH </span><span class="crayon-i">Gl</span><span class="crayon-h">  </span><span class="crayon-i">M</span><span class="crayon-h">  </span><span class="crayon-i">P</span><span class="crayon-h">  </span><span class="crayon-i">Q</span><span class="crayon-h">  </span><span class="crayon-i">T</span><span class="crayon-h">  </span><span class="crayon-i">W</span><span class="crayon-h">  </span><span class="crayon-i">Y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfd1794206287-2"><span class="crayon-i">GitHub</span><span class="crayon-h">    </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span></div><div class="crayon-line" id="crayon-5ac97c4bbbfd1794206287-3"><span class="crayon-i">Google</span><span class="crayon-h">    </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfd1794206287-4"><span class="crayon-i">Medium</span><span class="crayon-h">    </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfd1794206287-5"><span class="crayon-i">PayPal</span><span class="crayon-h">    </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfd1794206287-6"><span class="crayon-i">Quora</span><span class="crayon-h">     </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfd1794206287-7"><span class="crayon-i">Twitter</span><span class="crayon-h">   </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfd1794206287-8"><span class="crayon-i">Wikipedia</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfd1794206287-9"><span class="crayon-i">YouTube</span><span class="crayon-h">   </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">1</span><span class="crayon-h">  </span><span class="crayon-cn">0</span><span class="crayon-h">  </span><span class="crayon-cn">0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<p></p>
<p id="7ad5" class="graf graf--p graf-after--pre">每行和每列交点处的值记录该对顶点之间是否存在边。例如，Medium和Twitter之间存在一条边（惊喜！），所以它们的行/列相交的值是1。同样，Medium和PayPal之间没有边，所以它们行/列交点的值为0。</p>
<p id="fd3d" class="graf graf--p graf-after--p">在邻接矩阵内进行编码就会得到这个网络的所有属性——它给了我们解锁各种有价值见解的钥匙。首先，将任意列（或行）相加，就可以得出每个顶点的度数——即连接了多少个顶点。通常用字母<em>k</em>表示。</p>
<p id="7634" class="graf graf--p graf-after--p">同样，将每个顶点的度数相加并除以2得到L，即网络中边（或“连接”）的数量。行数/列数即网络中顶点（或“节点”）的数量，用<em>N</em>表示。</p>
<p id="bc6b" class="graf graf--p graf-after--p">知道<em>k</em>，<em>L</em>，<em>N</em>和邻接矩阵<em>A</em>中每个单元的值，就可以计算任意给定的网络聚类的<em><a href="https://en.wikipedia.org/wiki/Modularity_%28networks%29">模块性</a></em>。</p>
<p id="facf" class="graf graf--p graf-after--p">假设我们已经将网络聚类成了一些社区。我们可以使用模块性评分来评估这个聚类的“质量”。更高的分数将表明我们已经把网络分成了“准确”的社区，而低分表明我们的聚类更随机。下面的图片说明了这一点。</p>
<figure id="b803" class="graf graf--figure graf-after--p">
<figcaption class="imageCaption"><img src="http://wx4.sinaimg.cn/mw690/63918611gy1fpachxk96wj20m80aggnj.jpg"></figcaption>
<figcaption class="imageCaption">模块性是衡量分区“质量”的指标。</figcaption>
</figure>
<p id="e812" class="graf graf--p graf-after--figure">模块性可以使用下面的公式计算：</p>
<p id="4d1a" class="graf graf--p graf-after--figure"><img src="http://wx1.sinaimg.cn/mw690/63918611gy1fpachz41ulj20m8089t94.jpg"></p>
<p class="graf graf--p graf-after--figure">这个公示包含相当数量的数学知识，但我们可以一点一点地分解它，使它更好理解。</p>
<p class="graf graf--p graf-after--p"><em>M</em>当然是我们正在计算的——模块性。</p>
<p class="graf graf--p graf-after--p">1/2<em>L</em>告诉我们把后面所有的东西除以2<em>L</em>，即网络中边的数量的两倍。到现在为止，一切都很好理解。</p>
<p class="graf graf--p graf-after--figure"><strong>Σ</strong>符号告诉我们对右边的所有东西求和，并迭代邻接矩阵<em>A</em>中的每一行和列。对于那些不熟悉求和符号的人来说，<em>i，j = 1</em>和<em>N</em>的作用非常像编程中的嵌套for循环。在Python中，你可以这样写：</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfd6800567866" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
sum = 0

for i in range(1,N):
    for j in range(1,N):
        ans = #stuff with i and j as indices
        sum += ans</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfd6800567866-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfd6800567866-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfd6800567866-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfd6800567866-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfd6800567866-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfd6800567866-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfd6800567866-1"><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfd6800567866-2"> </div><div class="crayon-line" id="crayon-5ac97c4bbbfd6800567866-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">N</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfd6800567866-4"><span class="crayon-h">    </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">N</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfd6800567866-5"><span class="crayon-h">        </span><span class="crayon-v">ans</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-p">#stuff with i and j as indices</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfd6800567866-6"><span class="crayon-h">        </span><span class="crayon-v">sum</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">ans</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p></p>
<p class="graf graf--p graf-after--figure"><code class="markup--code markup--p-code">那么#stuff with i and j</code> 具体是什么？</p>
<p id="1f91" class="graf graf--p graf-after--p">括号里的东西告诉我们从<em>A_ij</em>中减去<em>（k_i k_j）/ 2L</em>。</p>
<p id="4555" class="graf graf--p graf-after--p"><em>A_ij</em>是邻接矩阵中第<em>i</em>行第<em>j</em>列的值。</p>
<p id="1ca6" class="graf graf--p graf-after--p"><em>k_i</em>和<em>k_j</em>的值是每个顶点的度数——通过将第<em>i</em>行和第<em>j</em>列中的项分别相加而得到。将它们相乘并除以<em>2L</em>得到如果网络是随机分布的顶点<em>i</em>和<em>j</em>之间的期望的边数。</p>
<p class="graf graf--p graf-after--p">总的来说，括号中的项表示网络的真实结构和随机重组的预期结构之间的差异。研究这个值表明，当<em>A_ij = 1，（k_i k_j）/ 2L</em>小的时候，它返回最大值。这意味着如果在顶点<em>i</em>和<em>j</em>之间存在“非预期”边缘，我们会看到更大的值。</p>
<p class="graf graf--p graf-after--p">最后，我们将括号中的项和后面几个符号相乘。</p>
<p class="graf graf--p graf-after--p"><em>δc_i</em>，<em>c_j</em>就是有名的 <em class="markup--em markup--p-em">Kronecker-delta </em><em>函数</em>。 这里是其Python解释：</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac97c4bbbfda479864053" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
def Kronecker_Delta(ci, cj):
    if ci == cj:
        return 1
    else:
        return 0

Kronecker_Delta("A","A")    #returns 1
Kronecker_Delta("A","B")    #returns 0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac97c4bbbfda479864053-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfda479864053-2">2</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfda479864053-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfda479864053-4">4</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfda479864053-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfda479864053-6">6</div><div class="crayon-num" data-line="crayon-5ac97c4bbbfda479864053-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac97c4bbbfda479864053-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac97c4bbbfda479864053-1"><span class="crayon-e">def </span><span class="crayon-e">Kronecker_Delta</span><span class="crayon-sy">(</span><span class="crayon-v">ci</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cj</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfda479864053-2"><span class="crayon-h">    </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">ci</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">cj</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfda479864053-3"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfda479864053-4"><span class="crayon-h">    </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5ac97c4bbbfda479864053-5"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfda479864053-6"> </div><div class="crayon-line" id="crayon-5ac97c4bbbfda479864053-7"><span class="crayon-e">Kronecker_Delta</span><span class="crayon-sy">(</span><span class="crayon-s">"A"</span><span class="crayon-sy">,</span><span class="crayon-s">"A"</span><span class="crayon-sy">)</span><span class="crayon-h">    </span><span class="crayon-p">#returns 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac97c4bbbfda479864053-8"><span class="crayon-e">Kronecker_Delta</span><span class="crayon-sy">(</span><span class="crayon-s">"A"</span><span class="crayon-sy">,</span><span class="crayon-s">"B"</span><span class="crayon-sy">)</span><span class="crayon-h">    </span><span class="crayon-p">#returns 0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p></p>
<p class="graf graf--p graf-after--p">是的——这真的很简单。Kronecker-delta函数有两个参数，如果相同则返回1，否则返回0。</p>
<p class="graf graf--p graf-after--p">这意味着如果顶点i和j已经被放入同一个聚类中，则δc_i，c_j = 1。否则，如果它们在不同的聚类中，则该函数返回0。</p>
<p class="graf graf--p graf-after--p">我们用这个Kronecker-delta函数乘以括号中的项，我们发现对于嵌套总和Σ，当分配给同一个聚类很多“非预期”的连接顶点的边时，其结果是最高的。因此，模块性是衡量图如何聚类到不同社区中的一种衡量标准。</p>
<p id="7643" class="graf graf--p graf-after--p">除以<em>2L</em>这一操作将模块性的上限值界定为1。模块性分数接近或低于0表示网络的当前聚类实际上是无用的。模块性值越高，网络分散到不同社区的聚类越好。通过最大化模块性，我们可以找到聚类网络的最佳方式。</p>
<p id="4f28" class="graf graf--p graf-after--p">请注意，我们必须预先定义图形如何聚类，以找出聚类实际上的“好”。不幸的是，使用暴力对图的每一种可能的聚类方式进行计算，以找到<br>
具有最高模块性分数的方式，即使是在有限样本大小的情况下也是不可能的。</p>
<p class="graf graf--p graf-after--p"><a href="https://en.wikipedia.org/wiki/Partition_of_a_set#Counting_partitions">组合学</a>告诉我们，对于只有8个顶点的网络，有4140种不同的聚类方式。 规模两倍的16个顶点的网络将有超过一百亿种可能的聚集顶点的方式。再次将网络加倍（对一个非常适中的32个顶点）将会产生128 septillion （128*10^24）种可能的方式，而且有八十个顶点的网络的聚类方式将比<a href="https://www.wolframalpha.com/input/?i=991267988808424794443839434655920239360814764000951599022939879419136287216681744888844&amp;lk=1&amp;rawformassumption=%22ClashPrefs%22+-%3E+%7B%22Math%22%7D">宇宙中可观察的原子数还多</a>。</p>
<p class="graf graf--p graf-after--p">所以，我们不得不转向一种<em>启发式的</em>方法，该方法在评估可以产生最高模块性分数的聚类方面做得相当不错，而不是尝试每一种可能性。 这是一种叫Fast-Greedy Modularity-Maximization的算法，它有点类似于上面描述的凝聚层次聚类算法。 “Mod-Max”不是根据距离进行合并，而是根据模块性的变化来合并。它是这样工作的：</p>
<p id="db81" class="graf graf--p graf-after--p"><strong>首先</strong>将每个顶点分配到自己的社区，然后计算整个网络的模块性。</p>
<p id="80a1" class="graf graf--p graf-after--p"><strong>第一步</strong>要求每一个社区至少被一条单边连接，如果两个社区合并为一个，算法计算模块性的变化结果<em>ΔM</em>。</p>
<p id="09cd" class="graf graf--p graf-after--p">然后，<strong>步骤2</strong>将使得<em>ΔM</em>增加最多的一对社区合并。为这个聚类计算新的模块性<em>M</em>，并记录下来。</p>
<p id="8228" class="graf graf--p graf-after--p"><strong>重复</strong>步骤1和2——每次合并产生最大<em>ΔM</em>增益的社区，然后记录新的聚类模式及其相关的模块性评分<em>M</em>。</p>
<p id="80a6" class="graf graf--p graf-after--p">当所有的顶点被分成一个大聚类时<strong>停下来</strong>。现在，算法检查它整个过程的记录，并确定返回最高值<em>M</em>的聚类模式。这就是返回的社区结构。</p>
<p><strong>细节：</strong></p>
<p id="37cf" class="graf graf--p graf-after--h4">这需要进行的计算太多了，至少对于我们人类来说。图论中有丰富的计算难题，通常是NP-hard问题，但它也具有难以置信的潜力，为复杂的系统和数据集提供有价值的见解。与Larry Page同名的PageRank算法——帮助Google在不到一代人的时间里从初创阶段发展到了几乎统治世界——完全基于图论。</p>
<p id="8eec" class="graf graf--p graf-after--p">社区发现是当前图论研究的一个焦点问题，模块性最大化有许多替代方案，虽然有用，但也有一些缺点。</p>
<p id="7379" class="graf graf--p graf-after--p">一开始，其聚集的方法往往将小而明确的社区吞并为大的社区。 这就是所谓的分辨率限制——算法不会在一定大小以内找到社区。 另一个挑战是，Mod-Max方法实际上倾向于产生许多具有类似的高模块性分数组成的“高原”，而不是一个独特的，易于到达的全局高峰值，这导致有时候难以确定最大分数。</p>
<p id="3c5a" class="graf graf--p graf-after--p">其他算法使用不同的方式来定义和处理社区发现。<em class="markup--em markup--p-em">Edge-Betweenness</em>是一个分裂的算法，从所有顶点分组在一个大聚类开始。持续迭代去除网络中最不重要的边，直到所有的顶点都被分开。这个过程产生了一个层级结构，类似的顶点在层级结构中更接近。</p>
<p id="dd08" class="graf graf--p graf-after--p">另一种算法是<em class="markup--em markup--p-em">Clique Percolation</em>，它考虑了图社区之间可能的重叠。 还有另一组算法是基于图上的<a href="https://en.wikipedia.org/wiki/Random_walk">随机漫步</a>，然后是<em><a href="https://en.wikipedia.org/wiki/Spectral_clustering">谱聚类</a></em>方法，它从邻接矩阵和由其导出的其它矩阵的特征分解开始研究。这些方法被用于例如计算机视觉等领域的特征提取。</p>
<p id="b391" class="graf graf--p graf-after--p">给每个算法提供一个深入的实例，这已经远远超出了本文的范围。我想说的是，这是一个活跃的研究领域，它提供了强大的方法来理解数据，即使在十年前还是个非常困难的过程。</p>
<h3 id="6ec6" class="graf graf--h3 graf-after--p">结论</h3>
<p id="4fee" class="graf graf--p graf-after--h3">希望这篇文章能够让你更好地理解机器如何理解大数据。未来瞬息万变，其中许多变化将由在下一代或两代中的产生的技术所驱动。</p>
<p id="e236" class="graf graf--p graf-after--p">正如介绍中所概述的，机器学习是一个雄心勃勃的研究领域，其中大量复杂的问题需要尽可能准确和高效地解决。对于我们人类来说任何容易完成的任务都需要机器采取创新的解决方案。</p>
<p id="49ba" class="graf graf--p graf-after--p graf--trailing">这个领域内还有很大的进步空间，谁来贡献下一个突破的想法，无疑将会得到丰厚的回报。 也许读了这篇文章的某个人就会发明下一个强大的算法？所有伟大的想法都必须从某处开始！</p>

        
        
        
    <div class="post-adds">
        <span data-post-id="113745" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113745votetotal">2</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113745" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 1 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i>  评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->

<div id="author-bio">
	
	<h3 class="widget-title">
	关于作者：<a target="_blank" href="http://www.jobbole.com/members/shaoai37">LynnShaw</a>
	</h3>
	<div class="alignleft">
		<a target="_blank" href="http://www.jobbole.com/members/shaoai37">
			<img src="http://www.jobbole.com/wp-content/uploads/avatars/104743/4e04a90ce037ac8e7d76fe8ac03d6610-bpthumb.jpg">
		</a>
	</div>

    <div class="author-bio-info">

        <span class="author-bio-info-block">
            微博：@萧萧萧宁        </span>
        <span class="author-bio-info-block">
            <a href="http://www.jobbole.com/members/shaoai37" target="_blank"><i class="fa fa-user"></i> 个人主页</a> ·
            <a href="http://blog.jobbole.com/author/shaoai37/" target="_blank"><i class="fa fa-file-text-o"></i> 我的文章</a>

             · <a title="声望值" target="_blank" href="http://www.jobbole.com/members/shaoai37/reputation/"><i class="fa fa-graduation-cap"></i> 35</a>        </span>
    </div>
	<div class="clear"></div>
</div>

<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《计算机如何感知大数据——聚类算法》",
	pic:"http://wx4.sinaimg.cn/mw690/63918611gy1fpachr4a3bj20rs0daags.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="当今世界最NB的25位大数据科学家" target="_blank" href="http://blog.jobbole.com/109186/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">当今世界最NB的25位大数据科学家</a>
                         · <a href="http://blog.jobbole.com/109186/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Apache Spark：大数据处理统一引擎" target="_blank" href="http://blog.jobbole.com/108564/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Apache Spark：大数据处理统一引擎</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="漫画：什么是大数据？" target="_blank" href="http://blog.jobbole.com/107507/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">漫画：什么是大数据？</a>
                         · <a href="http://blog.jobbole.com/107507/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="大数据到底是什么鬼" target="_blank" href="http://blog.jobbole.com/105016/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">大数据到底是什么鬼</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="4个小例子告诉你，如何成为一名数据极客" target="_blank" href="http://blog.jobbole.com/102268/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">4个小例子告诉你，如何成为一名数据极客</a>
                                            </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113745/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113745%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113745%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113745%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113745%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113745%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113745/
url_object_id:19e4dca035c34d14347d07439ad43f77
front_image_url:['http://wx4.sinaimg.cn/mw690/63918611gy1fpachr4a3bj20rs0daags.jpg']
front_image_path:full/7c651e0fce13acb304e7b99f8851cc540be4decd.jpg
tag:IT技术-图论-大数据-聚类









title:程序员如何规划职业路线？
create_date:2018/03/13
praise_nums:1
fav_nums:4
comments_nums:3
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-112048 post type-post status-publish format-standard hentry category-career tag-368 tag-253 odd" id="post-112048">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>程序员如何规划职业路线？</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/03/13 ·  <a href="http://blog.jobbole.com/category/career/" rel="category tag">职场</a>
            
                            · <a href="#article-comment"> 3 评论 </a>
            

            
             ·  <a href="http://blog.jobbole.com/tag/%e7%a8%8b%e5%ba%8f%e5%91%98/">程序员</a>, <a href="http://blog.jobbole.com/tag/%e8%81%8c%e5%9c%ba/">职场</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a target="_blank" href="https://my.oschina.net/huangyong/blog/1633257">黄勇</a>   </div><p>社区中并不缺少有关软件工程师职业发展的文章，甚至可以说是泛滥。很多人都能在这个话题上说两句，三五年工作经验的编程老鸟也好，架构师也好，技术 VP 也好，CTO 也好，都有各自的看法与实践经验。没有哪一套方法是适用于所有人的，这一套软件工程师职业发展纲要，也不过是在你踽踽前行的路上，迷茫时可用来参考借鉴。你的核心竞争力，永远是你的自身实力。切记！</p>
<h1 id="h1_0">一、专业技能学习捷径</h1>
<h2 id="h2_1">1、爱上你的编码神器</h2>
<p>众所周知，软件工程师要做的工作就是写代码，准确地说，你的目标应该是写出满足业务需求并且无法找出 Bug 的代码，而不是写一大堆没用的文字。既然你的任务是写出高质量的代码，那么你首先应该训练的就是打字速度，你需要掌握键盘盲打技能，甚至还要爱上你的“编码神器”，并做到将此工具的用法烂熟于心，闭上眼睛都能正确敲中你想要的快捷键。</p>
<h2 id="h2_2">2、熟悉底层技术原理</h2>
<p>当你完全驾驭了计算机的输入设备以后，你需要进一步了解计算机的内部工作原理，不是让你把机器大卸八块，而是你需要全面了解计算机的组成结构与工作原理。如果你不是计算机科班出生也没关系，在网上买一本关于计算机组成原理的书自学即可。你无需做到精通，能全面了解即可，因为接下来你需要在编程的世界中，慢慢去体会计算机的工作感受，你就是计算机的管理者。</p>
<h2 id="h2_3">3、深入一门编程语言</h2>
<p>好了，现在是时候学习一门编程语言了，最好的选择是 Java，为什么呢？原因很简单，因为市场需求量最大，我敢保证，你学 Java 肯定比学 PHP 更容易找到工作（希望 PHP 程序员们淡定一些，其实我始终认为 PHP 是世界上最好的编程语言）。当你在学习 Java 时，首先需要掌握它啰里吧嗦的编程语法，此时没有什么比写一个“Hello World”来得更爽快一些。随后你需要深刻理解的是 Java 的面向对象概念（每次我说到面向对象，总会被一些单身汉吐槽，其实我想说，对象是可以 new 出来的），这些概念看上去比较虚，但是它们却能撑起一个强大的软件架构。所以，在面向对象技术上面花再多功夫都不为过，因为它能训练我们对业务的抽象能力，就像当初我们学习数学一样，它能训练我们的逻辑思维能力。</p>
<h2 id="h2_4">4、选择一位对的老师</h2>
<p>看书、看视频、看源码、看技术文档，其实这些都是较为低效的学习方法，掌握编程技能的捷径就是拜一位资深的程序员为师，你可以尊称他为“码神”，记得一定要把他伺候好，让他愿意传授一些编程技能给你，其实也就是一个微笑外加一顿小龙虾的事情，他就能被你征服。一定要看他写的代码，思考为什么他会这样写，一定要将你不理解的地方记录下来，并且在下班之前紧紧地抓住他，让他一次给你讲个够，此时你一定会有一种打通任督二脉的畅快之感。所谓“师傅领进门，修行在个人”，你需要比你师傅更加努力，甚至十倍于他人的付出，才能在编程之路上尝到甜头。此时你需要学习更加高深的武功，研究更加优秀的源码，实践更有挑战的项目，还需要花整块时间，系统地看技术文档以及技术参考书。假如你想成为架构师，不妨看看我所著的《架构探险》这本书，也许它会对你的专业技能有所帮助。</p>
<h2 id="h2_5">5、乐于分享你的技能</h2>
<p>你最好要让自己变成一位豁达开朗之人，千万不要吝啬，一定要懂得分享你所学的专业技能。可以尝试做点自己的开源项目，并让这个开源项目变得更加开放，不妨结合开源，写点技术博客，并厚着脸皮给你身边的朋友阅读。这件事情一定要持之以恒，不要担心有人吐槽你，你肯定会被吐槽，那是因为大家在关注你，此时你需要更加努力，让自己变得足够专业。当你成为真正的“大神”时，就不会有人再吐槽你了，他们只会吐槽自己的技术不如你，此时你将得到的是无限的膜拜和称赞。相信我，这绝不是奇迹。在学习专业技能之路上，多一点自信，多一点勤奋，多一点思考，再争取一点机会，你就会成功。</p>
<h1 id="h1_6">二、不可或缺的软技能</h1>
<h2 id="h2_7">1、软技能 ≠ 务虚</h2>
<p>如果将专业技能比喻为“硬技能”，那么在我们的职场中，与专业性无关的技能就可以归纳为“软技能”了。但每当我提到软技能时，难免会让人误解为这是“务虚”的一种功夫，我们虽然是“吃软饭的”（做软件开发的），但我们却十分讨厌虚伪。没错！我也很厌恶虚伪之人，尤其是在职场中遇到这样的人物，我从心底鄙视他们，但我从来不会和他们发生任何冲突，反而还能和他们愉快地共事，这种本领靠的就是软技能。</p>
<p>软件工程师每天都在和机器打交道，机器是没有感情的，你告诉它是0，它一定不会认为是1。但我们与人打交道却不一样，你告诉他是真，他却可能认为是假。与人打交道，正是软件工程师们最为欠缺的方面，有些软件工程师甚至害怕与人交流，害怕在公开场合讲话，害怕抛头露面，害怕做一些组织性的工作。如果你也有以上这些心里负担，那么恭喜你！因为你即将从本文中找到克服这些困难的灵丹妙药，至少我希望是这样。</p>
<p>需要强调的是，软技能是一种职场必备的核心技能，我敢直言，如果缺乏这方面的技能，你的职业生涯将会变得非常糟糕。软技能包括的方面非常广泛，沟通、协调、组织、气场这些都是最基本的软技能，甚至情商也是一种软技能，会不会讲话，听不听得明白，这些都是软技能。那么我们不妨先从沟通这项软技能开始吧，因为我认为他是软件工程师最重要的软技能之一。</p>
<h2 id="h2_8">2、口语流利 ≠ 会沟通</h2>
<p>很多人都容易将沟通理解为讲话，说一个人语言很流利，很会讲话，口若悬河，夸夸其谈，其实并非他的沟通能力很强。我认为，沟通可以理解为两方面，即“沟”和“通”。“沟”指的是你将心中所想很清晰地表达出来给对方听，考验的是你的表达能力；“通”指的是让你确信对方是否真明白你所表达的意思，考验的是你的倾听能力。所以，我们很多时候都是在“沟”，往往忽略了“通”，从而形成了“沟而不通”的情况，因此，现在全世界人民都在提倡如何“有效沟通”。还是用一个示例来说话吧。</p>
<p>当领导交给你一项棘手的工作，但你不知道如何开始进行这项工作，此时你应该如何应对当前的挑战呢？绝大多数人会硬着头皮去做，他们希望通过自己的努力，可以顺利完成任务，但结果往往却无法让领导满意。少数人会主动向领导咨询，以寻求领导对自己的帮助。此时应该如何与领导对话呢？似乎并非很多人都清楚。下面这段话是我的套路，仅供参考。</p>
<blockquote><p>我：勇哥（他是我的领导），最近我遇到了一点麻烦的事情，想听听您的看法（勾起领导的兴趣，让他认真听我说下去，记得一定要说“您”，而不是“你”）。</p>
<p>领导：哦？说来听听（证明领导此时不忙，他有时间让我占用，如果他此时很忙，你应该能感受出来的）。</p>
<p>我：感谢您对我的信任，昨天您交给我一项任务，回到家我一直都在想这项任务，我在想……（一定要对领导表示感激，是他给了我这次锻炼自己的机会，并强调我是“回到家”都在思考，而不是只在在公司里思考，道理你懂的）</p>
<p>领导：可能是我没说清楚，你把这项任务想复杂了，其实……（可见这是一位 nice 的领导，跟着他，你能学到很多东西）</p>
<p>我：我还想再清楚一下，您期待这项工作的结果是怎样的？（一定要明确领导想要的结果，他只会为结果买单）</p>
<p>领导：我希望……（领导娓娓道来，此处省略1万字，你千万不要打断领导的讲话，他讲累了自然就会停，你只需要认真听他怎么讲）</p>
<p>我：好的，我明白了，您希望我……（一定要学会复述领导讲过的话，而且要用自己的理解来表达，不要当复读机）</p>
<p>领导：没错，就是这样。（领导表示认可了，此时你应该表示给领导一个微笑，让他感到欣慰）</p>
<p>我：感谢勇哥！如果我在执行过程中遇到问题，可以再向您请教吗？（一定要感谢，而且要表现出虚心向领导请教，为下一次求救做好准备）</p>
<p>领导：当然，随时交流。（你真心拿他当领导，他才会无条件帮助你，你不懂得用好这位领导，那是你自己的损失）</p></blockquote>
<p>沟通是不是很有趣？其实沟通是一门学问，我们花一辈子时间都在学习，都在改进自己的沟通方式，目的仅为愉快地和身边的人一起“玩耍”，让此生感到愉悦。</p>
<p>当你已经掌握了必备的专业技能，也具备了让你脱颖而出的软技能，那么接下来你将思考的是自己该走那条路了，继续做软件工程师，还是做软件工程师的 leader？下面这段话将告诉你答案。</p>
<h1 id="h1_9">三、正确制定职业路线</h1>
<h2 id="h2_10">1、给自己提几个问题</h2>
<p>首先要澄清的是：我并非职业导师，更不是人生教父，所有的路都由你自己选择，我的责任是告诉你，我认为行之有效的方法。</p>
<p>当你正走在职场的十字路口徘徊，思考走技术，还是走管理？我的答案只有一个：根据你自己的优势来决定。合理利用好自己的优势，会让自己走的更加顺畅，让自己无怨无悔。还是举一个例子来说明吧。</p>
<p>前段时间有位朋友在微信上私聊我，他也遇到了这个问题，继续做技术，还是转管理？我当时是这样问他的，但我希望你可以用这样的方式来问自己。</p>
<blockquote><p>我：你工作多久了？</p>
<p>朋友：时间不长，写了10年的代码。</p>
<p>我：那相当资深啊，现在还对写代码有激情吗？</p>
<p>朋友：喜欢写，周末有时都会宅在家里写。</p>
<p>我：那你还在纠结什么呢？</p>
<p>朋友：我都工作10年了，身边的人要么当 CTO，要么做总监，自己却还在撸代码，我现在到底该不该转管理？</p>
<p>我：你为什么会考虑转管理？说说你在管理上的优势吧。</p>
<p>朋友：我觉得自己对技术有一定深度，可以帮助团队解决一些技术难题。</p>
<p>我：如果你团队中有位小伙伴遇到一个很棘手的技术问题，没辙了，你会做些什么？</p>
<p>朋友：撸起袖子，就地帮他解决掉。</p>
<p>我：建议你走技术专家路线，这条路也许更加适合你。</p>
<p>朋友：……</p></blockquote>
<h2 id="h2_11">2、转管理之前，先理解管理</h2>
<p>当我们在纠结是否应该转管理时，不妨首先理解一下什么是管理？以及什么是管理者？只有当我们正确理解了这些概念以后，再来思考自己是否具备这样的特征，才能顺利帮助自己转型。</p>
<p>管理（management）是协调和监督他人的工作，从而使他人的工作可以有效率且有成效地完成。效率（efficiency）指的是以尽可能少的投入，以获得尽可能多的产出，效率常常被说成“正确地做事”，即不浪费资源。成效（effectiveness）常常被称为“做正确的事”，即做那些可以实现目标的工作活动。管理者（manager）就是完成所有管理工作，并使组织目标能够实现的人。管理者的工作包括计划（planning）、组织（organizing）、领导（leading）和控制（controlling）四种职能。</p>
<p>以上都是管理学告诉我们的知识，如果你想成为一名管理者，那么你必须首先正确理解这些概念的真实含义，才能完全驾驭管理者的岗位，否则你会从管理岗位上摔下来，自己一定伤得不轻。</p>
<p>如果你想成为一名优秀的管理者，那么你需要做些什么呢？</p>
<ul>
<li>亲自且专业地给团队激励。</li>
<li>激励团队完成你无法独立完成的任务。</li>
<li>对问题提供指导和指引。</li>
<li>对团队的表现给予反馈。</li>
<li>帮助团队改善绩效。</li>
<li>使团队对组织的改变知情。</li>
<li>改善团队小伙伴们的生活。</li>
</ul>
<p>如果团队和你共事过，那么团队应该觉得他们是幸运的，因为你能够让他们更加愉快和高效地工作。</p>
<h1 id="h1_12">写在最后</h1>
<p>不论选择技术还是管理，在任何时候都不要放弃你的硬技能，因为它是你的“生存之本”，同时你也需要具备强大的软技能，因为它是你的“发展之源”。</p>
<p>学习硬技能其实是有捷径的，你无需一味地学习这些知识点，更多的其实是与人交流以及加以应用。软技能其实是可以训练的，你只需抓住一切可以抓住的机会，有意识地加以训练和反思，你就能悟出很多宝贵的经验。软件开发是一门艺术，你需要能够静得下心，不断地优化和雕琢你的作品，因此你需要具备工匠精神。如果你想成为一名工匠领袖，那么你就应该比他人思考得更多、更高、更深、更全面，你需要更多的软技能。你只有认识到自己的优势，才能正确地选择自己的职业路线。</p>
<p>祝你成功！</p>

        
        
        
    <div class="post-adds">
        <span data-post-id="112048" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="112048votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="112048" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 4 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i> 3 评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《程序员如何规划职业路线？》",
	pic:"http://jbcdn2.b0.upaiyun.com/2017/03/4f255bd43f956c3db484a99d448b198e.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="IT 职场新人碰到的几个常见误区" target="_blank" href="http://blog.jobbole.com/112038/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">IT 职场新人碰到的几个常见误区</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="100 倍价值的工程师" target="_blank" href="http://blog.jobbole.com/113710/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">100 倍价值的工程师</a>
                         · <a href="http://blog.jobbole.com/113710/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="我只想安静地写代码，领导却跟我谈大局、讲奉献" target="_blank" href="http://blog.jobbole.com/113705/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">我只想安静地写代码，领导却跟我谈大局、讲奉献</a>
                         · <a href="http://blog.jobbole.com/113705/#comments" target="_blank"><i class="fa fa-comments-o"></i> 3</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="为什么程序员找不到工作：4 个恐怖故事" target="_blank" href="http://blog.jobbole.com/113652/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">为什么程序员找不到工作：4 个恐怖故事</a>
                         · <a href="http://blog.jobbole.com/113652/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="一个技术大牛对程序员招聘的吐槽和建议" target="_blank" href="http://blog.jobbole.com/113532/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">一个技术大牛对程序员招聘的吐槽和建议</a>
                         · <a href="http://blog.jobbole.com/113532/#comments" target="_blank"><i class="fa fa-comments-o"></i> 24</a>                    </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/112048/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F112048%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F112048%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F112048%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F112048%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F112048%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

                    <h5 id="comments" class="sub-title"><i class="glyphicon"></i>最新评论</h5>
            <ul class="cmnt-list">

                        <li id="comment-162336" class="comment cmnt odd">
    
    <div class="cmnt-box">
        <div class="cmnt-header">
                            <a href="http://www.jobbole.com/members/onice" class="cmnt-img"><img width="37" height="37" src="http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png" alt=""></a>
                <div class="cmnt-meta">
                    <span><a href="http://www.jobbole.com/members/onice">onice</a><label class="comment_author_data"> （ <a title="声望值" target="_blank" href="http://www.jobbole.com/members/onice/reputation/"><i class="fa fa-graduation-cap"></i> 1</a> ）</label></span>
                    <span class="c-title">
                                             </span>

                    <span class="c-date">
                        <a href="http://blog.jobbole.com/112048/#comment-162336">03/16</a>
                    </span>

                    
                    
                </div>
                    </div>
        <div class="cmnt-body">
            <p>
                </p><p>我觉得讲得很好啊，受益匪浅</p>
            
                    </div>
                    <div class="cmnt-footer">

                
                <p class="c-like">
                    <a title="赞同" alt="赞同" class="162336voteflag  t-up  href-style vote-comment-up  register-user-only   " data-comment-id="162336"><i class="fa fa-thumbs-o-up"></i> <span id="162336voteuptotal"> 赞</span></a>

                    
                    <a rel="nofollow" class="comment-reply-link register-user-only" href="http://blog.jobbole.com/112048/?replytocom=162336#respond" data-onclick='return addComment.moveForm( "comment-162336", "162336", "respond", "112048" )' aria-label="回复给onice">回复 <i class="fa fa-reply"></i></a>
                </p>
            </div>
            </div>
    </li>
<!-- #comment-## -->
        <li id="comment-162352" class="comment cmnt even">
    
    <div class="cmnt-box">
        <div class="cmnt-header">
                            <a href="http://www.jobbole.com/members/%E8%8B%A5%E5%85%AE" class="cmnt-img"><img width="37" height="37" src="http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png" alt=""></a>
                <div class="cmnt-meta">
                    <span><a href="http://www.jobbole.com/members/%E8%8B%A5%E5%85%AE">若兮</a><label class="comment_author_data"> </label></span>
                    <span class="c-title">
                        python爬虫工程师                    </span>

                    <span class="c-date">
                        <a href="http://blog.jobbole.com/112048/#comment-162352">03/23</a>
                    </span>

                    
                    
                </div>
                    </div>
        <div class="cmnt-body">
            <p>
                </p><p>求师傅</p>
            
                    </div>
                    <div class="cmnt-footer">

                
                <p class="c-like">
                    <a title="赞同" alt="赞同" class="162352voteflag  t-up  href-style vote-comment-up  register-user-only   " data-comment-id="162352"><i class="fa fa-thumbs-o-up"></i> <span id="162352voteuptotal"> 赞</span></a>

                    
                    <a rel="nofollow" class="comment-reply-link register-user-only" href="http://blog.jobbole.com/112048/?replytocom=162352#respond" data-onclick='return addComment.moveForm( "comment-162352", "162352", "respond", "112048" )' aria-label="回复给若兮">回复 <i class="fa fa-reply"></i></a>
                </p>
            </div>
            </div>
    </li>
<!-- #comment-## -->
        <li id="comment-162357" class="comment cmnt odd">
    
    <div class="cmnt-box">
        <div class="cmnt-header">
                            <a href="http://www.jobbole.com/members/q2911053410" class="cmnt-img"><img width="37" height="37" src="http://q.qlogo.cn/qqapp/208656/2A7D28B31833C25226A440FB143C272D/100" alt=""></a>
                <div class="cmnt-meta">
                    <span><a href="http://www.jobbole.com/members/q2911053410">飞雨星辰</a><label class="comment_author_data"> </label></span>
                    <span class="c-title">
                                             </span>

                    <span class="c-date">
                        <a href="http://blog.jobbole.com/112048/#comment-162357">03/25</a>
                    </span>

                    
                    
                </div>
                    </div>
        <div class="cmnt-body">
            <p>
                </p><p>写的很专业，获益匪浅</p>
            
                    </div>
                    <div class="cmnt-footer">

                
                <p class="c-like">
                    <a title="赞同" alt="赞同" class="162357voteflag  t-up  href-style vote-comment-up  register-user-only   " data-comment-id="162357"><i class="fa fa-thumbs-o-up"></i> <span id="162357voteuptotal"> 赞</span></a>

                    
                    <a rel="nofollow" class="comment-reply-link register-user-only" href="http://blog.jobbole.com/112048/?replytocom=162357#respond" data-onclick='return addComment.moveForm( "comment-162357", "162357", "respond", "112048" )' aria-label="回复给飞雨星辰">回复 <i class="fa fa-reply"></i></a>
                </p>
            </div>
            </div>
    </li>
<!-- #comment-## -->
            </ul>
        
    </div>
		

	
</div>
url:http://blog.jobbole.com/112048/
url_object_id:c8f7206fc12fb03862d494d19208fd22
front_image_url:['http://jbcdn2.b0.upaiyun.com/2017/03/4f255bd43f956c3db484a99d448b198e.jpg']
front_image_path:full/d102994dcc342e0686843d89a7518432502d5ff3.jpg
tag:职场-程序员-职场









title:Linux 启动过程分析
create_date:2018/03/13
praise_nums:1
fav_nums:5
comments_nums:1
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113768 post type-post status-publish format-standard hentry category-it-tech tag-linux odd" id="post-113768">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>Linux 启动过程分析</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/03/13 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
                            · <a href="#article-comment"> 1 评论 </a>
            

            
             ·  <a href="http://blog.jobbole.com/tag/linux/">Linux</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a ref="nofollow" target="_blank" href="https://opensource.com/article/18/1/analyzing-linux-boot-process">Alison Chaiken</a>   译文出处：<a target="_blank" href="https://linux.cn/article-9437-1.html">Linux中国/jessie-pang</a>   </div><blockquote><p>理解运转良好的系统对于处理不可避免的故障是最好的准备。</p></blockquote>
<p>关于开源软件最古老的笑话是：“代码是自具文档化的self-documenting”。经验表明，阅读源代码就像听天气预报一样：明智的人依然出门会看看室外的天气。本文讲述了如何运用调试工具来观察和分析 Linux 系统的启动。分析一个功能正常的系统启动过程，有助于用户和开发人员应对不可避免的故障。</p>
<p>从某些方面看，启动过程非常简单。内核在单核上以单线程和同步状态启动，似乎可以理解。但内核本身是如何启动的呢？<a href="https://en.wikipedia.org/wiki/Initial_ramdisk">initrd（initial ramdisk）</a> 和引导程序bootloader具有哪些功能？还有，为什么以太网端口上的 LED 灯是常亮的呢？</p>
<p>请继续阅读寻找答案。在 GitHub 上也提供了 <a href="https://github.com/chaiken/LCA2018-Demo-Code">介绍演示和练习的代码</a>。</p>
<h3 id="toc_1">启动的开始：OFF 状态</h3>
<h4 id="toc_2">局域网唤醒Wake-on-LAN</h4>
<p>OFF 状态表示系统没有上电，没错吧？表面简单，其实不然。例如，如果系统启用了局域网唤醒机制（WOL），以太网指示灯将亮起。通过以下命令来检查是否是这种情况：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9423d85261812768546" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
# sudo ethtool &lt;interface name&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9423d85261812768546-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9423d85261812768546-1"><span class="crayon-p"># sudo ethtool &lt;interface name&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>其中 &lt;interface name&gt;<code></code> 是网络接口的名字，比如 <code>eth0</code>。（<code>ethtool</code> 可以在同名的 Linux 软件包中找到。）如果输出中的 <code>Wake-on</code> 显示 <code>g</code>，则远程主机可以通过发送 <a href="https://en.wikipedia.org/wiki/Wake-on-LAN">魔法数据包MagicPacket</a> 来启动系统。如果您无意远程唤醒系统，也不希望其他人这样做，请在系统 BIOS 菜单中将 WOL 关闭，或者用以下方式：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9423d8526a290921785" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
# sudo ethtool -s &lt;interface name&gt; wol d
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9423d8526a290921785-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d8526a290921785-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9423d8526a290921785-1"><span class="crayon-p"># sudo ethtool -s &lt;interface name&gt; wol d</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d8526a290921785-2"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>响应魔法数据包的处理器可能是网络接口的一部分，也可能是 <a href="https://lwn.net/Articles/630778/">底板管理控制器Baseboard Management Controller</a>（BMC）。</p>
<h4 id="toc_3">英特尔管理引擎、平台控制器单元和 Minix</h4>
<p>BMC 不是唯一的在系统关闭时仍在监听的微控制器（MCU）。x86_64 系统还包含了用于远程管理系统的英特尔管理引擎（IME）软件套件。从服务器到笔记本电脑，各种各样的设备都包含了这项技术，它开启了如 KVM 远程控制和英特尔功能许可服务等 <a href="https://www.youtube.com/watch?v=iffTJ1vPCSo&amp;amp;amp;amp;amp;amp;index=65&amp;amp;amp;amp;amp;amp;list=PLbzoR-pLrL6pISWAq-1cXP4_UZAyRtesk">功能</a>。根据 <a href="https://www.intel.com/content/www/us/en/support/articles/000025619/software.html">Intel 自己的检测工具</a>，<a href="https://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00086&amp;amp;amp;amp;amp;amp;languageid=en-fr">IME 存在尚未修补的漏洞</a>。坏消息是，要禁用 IME 很难。Trammell Hudson 发起了一个 <a href="https://github.com/corna/me_cleaner">me_cleaner 项目</a>，它可以清除一些相对恶劣的 IME 组件，比如嵌入式 Web 服务器，但也可能会影响运行它的系统。</p>
<p>IME 固件和系统管理模式System Management Mode（SMM）软件是 <a href="https://lwn.net/Articles/738649/">基于 Minix 操作系统</a> 的，并运行在单独的平台控制器单元Platform Controller Hub上（LCTT 译注：即南桥芯片），而不是主 CPU 上。然后，SMM 启动位于主处理器上的通用可扩展固件接口Universal Extensible Firmware Interface（UEFI）软件，相关内容 <a href="https://lwn.net/Articles/699551/">已被提及多次</a>。Google 的 Coreboot 小组已经启动了一个雄心勃勃的 <a href="https://trmm.net/NERF">非扩展性缩减版固件Non-Extensible Reduced Firmware</a>（NERF）项目，其目的不仅是要取代 UEFI，还要取代早期的 Linux 用户空间组件，如 systemd。在我们等待这些新成果的同时，Linux 用户现在就可以从 Purism、System76 或 Dell 等处购买 <a href="https://www.extremetech.com/computing/259879-dell-now-shipping-laptops-intels-management-engine-disabled">禁用了 IME</a> 的笔记本电脑，另外 <a href="https://lwn.net/Articles/733837/">带有 ARM 64 位处理器笔记本电脑</a> 还是值得期待的。</p>
<h4 id="toc_4">引导程序</h4>
<p>除了启动那些问题不断的间谍软件外，早期引导固件还有什么功能呢？引导程序的作用是为新上电的处理器提供通用操作系统（如 Linux）所需的资源。在开机时，不但没有虚拟内存，在控制器启动之前连 DRAM 也没有。然后，引导程序打开电源，并扫描总线和接口，以定位内核镜像和根文件系统的位置。U-Boot 和 GRUB 等常见的引导程序支持 USB、PCI 和 NFS 等接口，以及更多的嵌入式专用设备，如 NOR 闪存和 NAND 闪存。引导程序还与 <a href="https://linuxplumbersconf.org/2017/ocw/events/LPC2017/tracks/639">可信平台模块Trusted Platform Module</a>（TPM）等硬件安全设备进行交互，在启动最开始建立信任链。</p>
<p><img class="aligncenter" title="Running the U-boot bootloader" src="http://jbcdn2.b0.upaiyun.com/2018/03/a1db74d1a0f049a3aabdb89e5079bbce.png" alt="Running the U-boot bootloader"></p>
<p style="text-align: center"><em>在构建主机上的沙盒中运行 U-boot 引导程序。</em></p>
<p>包括树莓派、任天堂设备、汽车主板和 Chromebook 在内的系统都支持广泛使用的开源引导程序 <a href="http://www.denx.de/wiki/DULG/Manual">U-Boot</a>。它没有系统日志，当发生问题时，甚至没有任何控制台输出。为了便于调试，U-Boot 团队提供了一个沙盒，可以在构建主机甚至是夜间的持续集成（CI）系统上测试补丁程序。如果系统上安装了 Git 和 GNU Compiler Collection（GCC）等通用的开发工具，使用 U-Boot 沙盒会相对简单：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9423d85271989913527" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
# git clone git://git.denx.de/u-boot; cd u-boot
# make ARCH=sandbox defconfig
# make; ./u-boot
=&gt; printenv
=&gt; help
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9423d85271989913527-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85271989913527-2">2</div><div class="crayon-num" data-line="crayon-5ac9423d85271989913527-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85271989913527-4">4</div><div class="crayon-num" data-line="crayon-5ac9423d85271989913527-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85271989913527-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9423d85271989913527-1"><span class="crayon-p"># git clone git://git.denx.de/u-boot; cd u-boot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85271989913527-2"><span class="crayon-p"># make ARCH=sandbox defconfig</span></div><div class="crayon-line" id="crayon-5ac9423d85271989913527-3"><span class="crayon-p"># make; ./u-boot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85271989913527-4"><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">printenv</span></div><div class="crayon-line" id="crayon-5ac9423d85271989913527-5"><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">help</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85271989913527-6"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>在 x86_64 上运行 U-Boot，可以测试一些棘手的功能，如 <a href="https://github.com/chaiken/LCA2018-Demo-Code">模拟存储设备</a> 的重新分区、基于 TPM 的密钥操作以及 USB 设备热插拔等。U-Boot 沙盒甚至可以在 GDB 调试器下单步执行。使用沙盒进行开发的速度比将引导程序刷新到电路板上的测试快 10 倍，并且可以使用 <code>Ctrl + C</code> 恢复一个“变砖”的沙盒。</p>
<h3 id="toc_5">启动内核</h3>
<h4 id="toc_6">配置引导内核</h4>
<p>引导程序完成任务后将跳转到已加载到主内存中的内核代码，并开始执行，传递用户指定的任何命令行选项。内核是什么样的程序呢？用命令 <code>file /boot/vmlinuz</code> 可以看到它是一个 “bzImage”，意思是一个大的压缩的镜像。Linux 源代码树包含了一个可以解压缩这个文件的工具—— <a href="https://github.com/torvalds/linux/blob/master/scripts/extract-vmlinux">extract-vmlinux</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9423d85275461496119" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
# scripts/extract-vmlinux /boot/vmlinuz-$(uname -r) &gt; vmlinux
# file vmlinux
vmlinux: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically
linked, stripped
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9423d85275461496119-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85275461496119-2">2</div><div class="crayon-num" data-line="crayon-5ac9423d85275461496119-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85275461496119-4">4</div><div class="crayon-num" data-line="crayon-5ac9423d85275461496119-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9423d85275461496119-1"><span class="crayon-p"># scripts/extract-vmlinux /boot/vmlinuz-$(uname -r) &gt; vmlinux</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85275461496119-2"><span class="crayon-p"># file vmlinux</span></div><div class="crayon-line" id="crayon-5ac9423d85275461496119-3"><span class="crayon-v">vmlinux</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">ELF</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-o">-</span><span class="crayon-e">bit </span><span class="crayon-e">LSB </span><span class="crayon-v">executable</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x86</span><span class="crayon-o">-</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">version</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">SYSV</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">statically</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85275461496119-4"><span class="crayon-v">linked</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">stripped</span></div><div class="crayon-line" id="crayon-5ac9423d85275461496119-5"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>内核是一个 <a href="http://man7.org/linux/man-pages/man5/elf.5.html">可执行与可链接格式 Executable and Linking Format</a>（ELF）的二进制文件，就像 Linux 的用户空间程序一样。这意味着我们可以使用 <code>binutils</code> 包中的命令，如 <code>readelf</code> 来检查它。比较一下输出，例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9423d85279093963854" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
# readelf -S /bin/date
# readelf -S vmlinux
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9423d85279093963854-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85279093963854-2">2</div><div class="crayon-num" data-line="crayon-5ac9423d85279093963854-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9423d85279093963854-1"><span class="crayon-p"># readelf -S /bin/date</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85279093963854-2"><span class="crayon-p"># readelf -S vmlinux</span></div><div class="crayon-line" id="crayon-5ac9423d85279093963854-3"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>这两个二进制文件中的段内容大致相同。</p>
<p>所以内核必须像其他的 Linux ELF 文件一样启动，但用户空间程序是如何启动的呢？在 <code>main()</code> 函数中？并不确切。</p>
<p>在 <code>main()</code> 函数运行之前，程序需要一个执行上下文，包括堆栈内存以及 <code>stdio</code>、<code>stdout</code> 和 <code>stderr</code> 的文件描述符。用户空间程序从标准库（多数 Linux 系统在用 “glibc”）中获取这些资源。参照以下输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9423d8527d574356498" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
# file /bin/date
/bin/date: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically
linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32,
BuildID[sha1]=14e8563676febeb06d701dbee35d225c5a8e565a,
stripped
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9423d8527d574356498-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d8527d574356498-2">2</div><div class="crayon-num" data-line="crayon-5ac9423d8527d574356498-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d8527d574356498-4">4</div><div class="crayon-num" data-line="crayon-5ac9423d8527d574356498-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d8527d574356498-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9423d8527d574356498-1"><span class="crayon-p"># file /bin/date</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d8527d574356498-2"><span class="crayon-o">/</span><span class="crayon-v">bin</span><span class="crayon-o">/</span><span class="crayon-v">date</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">ELF</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-o">-</span><span class="crayon-e">bit </span><span class="crayon-e">LSB </span><span class="crayon-e">shared </span><span class="crayon-t">object</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x86</span><span class="crayon-o">-</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">version</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">SYSV</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">dynamically</span></div><div class="crayon-line" id="crayon-5ac9423d8527d574356498-3"><span class="crayon-v">linked</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interpreter</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">lib64</span><span class="crayon-o">/</span><span class="crayon-v">ld</span><span class="crayon-o">-</span><span class="crayon-v">linux</span><span class="crayon-o">-</span><span class="crayon-v">x86</span><span class="crayon-o">-</span><span class="crayon-cn">64.so.2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">GNU</span><span class="crayon-o">/</span><span class="crayon-i">Linux</span><span class="crayon-h"> </span><span class="crayon-cn">2.6.32</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d8527d574356498-4"><span class="crayon-v">BuildID</span><span class="crayon-sy">[</span><span class="crayon-v">sha1</span><span class="crayon-sy">]</span><span class="crayon-o">=</span><span class="crayon-cn">14e8563676febeb06d701dbee35d225c5a8e565a</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5ac9423d8527d574356498-5"><span class="crayon-i">stripped</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d8527d574356498-6"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>ELF 二进制文件有一个解释器，就像 Bash 和 Python 脚本一样，但是解释器不需要像脚本那样用 <code>#!</code> 指定，因为 ELF 是 Linux 的原生格式。ELF 解释器通过调用 <code>_start()</code> 函数来用所需资源 <a href="https://0xax.gitbooks.io/linux-insides/content/Misc/program_startup.html">配置一个二进制文件</a>，这个函数可以从 glibc 源代码包中找到，可以 <a href="https://github.com/chaiken/LCA2018-Demo-Code/commit/e543d9812058f2dd65f6aed45b09dda886c5fd4e">用 GDB 查看</a>。内核显然没有解释器，必须自我配置，这是怎么做到的呢？</p>
<p>用 GDB 检查内核的启动给出了答案。首先安装内核的调试软件包，内核中包含一个未剥离的unstripped vmlinux，例如 <code>apt-get install linux-image-amd64-dbg</code>，或者从源代码编译和安装你自己的内核，可以参照 <a href="http://kernel-handbook.alioth.debian.org/">Debian Kernel Handbook</a> 中的指令。<code>gdb vmlinux</code> 后加 <code>info files</code> 可显示 ELF 段 <code>init.text</code>。在 <code>init.text</code> 中用 <code>l *(address)</code> 列出程序执行的开头，其中 <code>address</code> 是 <code>init.text</code> 的十六进制开头。用 GDB 可以看到 x86_64 内核从内核文件 <a href="https://github.com/torvalds/linux/blob/master/arch/x86/boot/compressed/head_64.S">arch/x86/kernel/head_64.S</a> 开始启动，在这个文件中我们找到了汇编函数 <code>start_cpu0()</code>，以及一段明确的代码显示在调用 <code>x86_64 start_kernel()</code> 函数之前创建了堆栈并解压了 zImage。ARM 32 位内核也有类似的文件 <a href="https://github.com/torvalds/linux/blob/master/arch/arm/boot/compressed/head.S">arch/arm/kernel/head.S</a>。<code>start_kernel()</code> 不针对特定的体系结构，所以这个函数驻留在内核的 <a href="https://github.com/torvalds/linux/blob/master/init/main.c">init/main.c</a> 中。<code>start_kernel()</code> 可以说是 Linux 真正的 <code>main()</code> 函数。</p>
<h3 id="toc_7">从 start_kernel() 到 PID 1</h3>
<h4 id="toc_8">内核的硬件清单：设备树和 ACPI 表</h4>
<p>在引导时，内核需要硬件信息，不仅仅是已编译过的处理器类型。代码中的指令通过单独存储的配置数据进行扩充。有两种主要的数据存储方法：<a href="https://www.youtube.com/watch?v=m_NyYEBxfn8">设备树device-tree</a> 和 <a href="http://events.linuxfoundation.org/sites/events/files/slides/x86-platform.pdf">高级配置和电源接口（ACPI）表</a>。内核通过读取这些文件了解每次启动时需要运行的硬件。</p>
<p>对于嵌入式设备，设备树是已安装硬件的清单。设备树只是一个与内核源代码同时编译的文件，通常与 <code>vmlinux</code> 一样位于 <code>/boot</code> 目录中。要查看 ARM 设备上的设备树的内容，只需对名称与 <code>/boot/*.dtb</code> 匹配的文件执行 <code>binutils</code> 包中的 <code>strings</code> 命令即可，这里 <code>dtb</code> 是指设备树二进制文件device-tree binary。显然，只需编辑构成它的类 JSON 的文件并重新运行随内核源代码提供的特殊 <code>dtc</code> 编译器即可修改设备树。虽然设备树是一个静态文件，其文件路径通常由命令行引导程序传递给内核，但近年来增加了一个 <a href="http://lwn.net/Articles/616859/">设备树覆盖</a> 的功能，内核在启动后可以动态加载热插拔的附加设备。</p>
<p>x86 系列和许多企业级的 ARM64 设备使用 <a href="http://events.linuxfoundation.org/sites/events/files/slides/x86-platform.pdf">ACPI</a> 机制。与设备树不同的是，ACPI 信息存储在内核在启动时通过访问板载 ROM 而创建的 <code>/sys/firmware/acpi/tables</code> 虚拟文件系统中。读取 ACPI 表的简单方法是使用 <code>acpica-tools</code> 包中的 <code>acpidump</code> 命令。例如：</p>
<p><img class="aligncenter" title="ACPI tables on Lenovo laptops" src="http://jbcdn2.b0.upaiyun.com/2018/03/e1c561f573bf3f14de98b441ff6443d5.png" alt="ACPI tables on Lenovo laptops"></p>
<p style="text-align: center"><em>联想笔记本电脑的 ACPI 表都是为 Windows 2001 设置的。</em></p>
<p>是的，你的 Linux 系统已经准备好用于 Windows 2001 了，你要考虑安装吗？与设备树不同，ACPI 具有方法和数据，而设备树更多地是一种硬件描述语言。ACPI 方法在启动后仍处于活动状态。例如，运行 <code>acpi_listen</code> 命令（在 <code>apcid</code> 包中），然后打开和关闭笔记本机盖会发现 ACPI 功能一直在运行。暂时地和动态地 <a href="https://www.mjmwired.net/kernel/Documentation/acpi/method-customizing.txt">覆盖 ACPI 表</a> 是可能的，而永久地改变它需要在引导时与 BIOS 菜单交互或刷新 ROM。如果你遇到那么多麻烦，也许你应该 <a href="https://www.coreboot.org/Supported_Motherboards">安装 coreboot</a>，这是开源固件的替代品。</p>
<h4 id="toc_9">从 start_kernel() 到用户空间</h4>
<p><a href="https://github.com/torvalds/linux/blob/master/init/main.c">init/main.c</a> 中的代码竟然是可读的，而且有趣的是，它仍然在使用 1991 – 1992 年的 Linus Torvalds 的原始版权。在一个刚启动的系统上运行 <code>dmesg | head</code>，其输出主要来源于此文件。第一个 CPU 注册到系统中，全局数据结构被初始化，并且调度程序、中断处理程序（IRQ）、定时器和控制台按照严格的顺序逐一启动。在 <code>timekeeping_init()</code> 函数运行之前，所有的时间戳都是零。内核初始化的这部分是同步的，也就是说执行只发生在一个线程中，在最后一个完成并返回之前，没有任何函数会被执行。因此，即使在两个系统之间，<code>dmesg</code> 的输出也是完全可重复的，只要它们具有相同的设备树或 ACPI 表。Linux 的行为就像在 MCU 上运行的 RTOS（实时操作系统）一样，如 QNX 或 VxWorks。这种情况持续存在于函数 <code>rest_init()</code> 中，该函数在终止时由 <code>start_kernel()</code> 调用。</p>
<p><img class="aligncenter" title="Summary of early kernel boot process." src="http://jbcdn2.b0.upaiyun.com/2018/03/731faee0c0adb28504bce94e646b22a2.png" alt="Summary of early kernel boot process."></p>
<p style="text-align: center"><em>早期的内核启动流程。</em></p>
<p>函数 <code>rest_init()</code> 产生了一个新进程以运行 <code>kernel_init()</code>，并调用了 <code>do_initcalls()</code>。用户可以通过将 <code>initcall_debug</code> 附加到内核命令行来监控 <code>initcalls</code>，这样每运行一次 <code>initcall</code> 函数就会产生 一个 <code>dmesg</code> 条目。<code>initcalls</code> 会历经七个连续的级别：early、core、postcore、arch、subsys、fs、device 和 late。<code>initcalls</code> 最为用户可见的部分是所有处理器外围设备的探测和设置：总线、网络、存储和显示器等等，同时加载其内核模块。<code>rest_init()</code> 也会在引导处理器上产生第二个线程，它首先运行 <code>cpu_idle()</code>，然后等待调度器分配工作。</p>
<p><code>kernel_init()</code> 也可以 <a href="http://free-electrons.com/pub/conferences/2014/elc/clement-smp-bring-up-on-arm-soc">设置对称多处理（SMP）结构</a>。在较新的内核中，如果 <code>dmesg</code> 的输出中出现 “Bringing up secondary CPUs…” 等字样，系统便使用了 SMP。SMP 通过“热插拔” CPU 来进行，这意味着它用状态机来管理其生命周期，这种状态机在概念上类似于热插拔的 U 盘一样。内核的电源管理系统经常会使某个核core离线，然后根据需要将其唤醒，以便在不忙的机器上反复调用同一段的 CPU 热插拔代码。观察电源管理系统调用 CPU 热插拔代码的 <a href="http://www.brendangregg.com/ebpf.html">BCC 工具</a> 称为 <code>offcputime.py</code>。</p>
<p>请注意，<code>init/main.c</code> 中的代码在 <code>smp_init()</code> 运行时几乎已执行完毕：引导处理器已经完成了大部分一次性初始化操作，其它核无需重复。尽管如此，跨 CPU 的线程仍然要在每个核上生成，以管理每个核的中断（IRQ）、工作队列、定时器和电源事件。例如，通过 <code>ps -o psr</code> 命令可以查看服务每个 CPU 上的线程的 softirqs 和 workqueues。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->

		<div id="crayon-5ac9423d85285315227603" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" show" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 18.2px !important; line-height: 18.2px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
# ps -o pid,psr,comm $(pgrep ksoftirqd)  
 PID PSR COMMAND 
   7   0 ksoftirqd/0 
  16   1 ksoftirqd/1 
  22   2 ksoftirqd/2 
  28   3 ksoftirqd/3 

# ps -o pid,psr,comm $(pgrep kworker)
PID  PSR COMMAND 
   4   0 kworker/0:0H 
  18   1 kworker/1:0H 
  24   2 kworker/2:0H 
  30   3 kworker/3:0H
[ . . . ]
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5ac9423d85285315227603-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85285315227603-2">2</div><div class="crayon-num" data-line="crayon-5ac9423d85285315227603-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85285315227603-4">4</div><div class="crayon-num" data-line="crayon-5ac9423d85285315227603-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85285315227603-6">6</div><div class="crayon-num" data-line="crayon-5ac9423d85285315227603-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85285315227603-8">8</div><div class="crayon-num" data-line="crayon-5ac9423d85285315227603-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85285315227603-10">10</div><div class="crayon-num" data-line="crayon-5ac9423d85285315227603-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85285315227603-12">12</div><div class="crayon-num" data-line="crayon-5ac9423d85285315227603-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5ac9423d85285315227603-14">14</div><div class="crayon-num" data-line="crayon-5ac9423d85285315227603-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5ac9423d85285315227603-1"><span class="crayon-p"># ps -o pid,psr,comm $(pgrep ksoftirqd)  </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85285315227603-2"><span class="crayon-h"> </span><span class="crayon-e">PID </span><span class="crayon-e">PSR </span><span class="crayon-i">COMMAND</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5ac9423d85285315227603-3"><span class="crayon-h">   </span><span class="crayon-cn">7</span><span class="crayon-h">   </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-v">ksoftirqd</span><span class="crayon-o">/</span><span class="crayon-cn">0</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85285315227603-4"><span class="crayon-h">  </span><span class="crayon-cn">16</span><span class="crayon-h">   </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-v">ksoftirqd</span><span class="crayon-o">/</span><span class="crayon-cn">1</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5ac9423d85285315227603-5"><span class="crayon-h">  </span><span class="crayon-cn">22</span><span class="crayon-h">   </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-v">ksoftirqd</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85285315227603-6"><span class="crayon-h">  </span><span class="crayon-cn">28</span><span class="crayon-h">   </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-v">ksoftirqd</span><span class="crayon-o">/</span><span class="crayon-cn">3</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5ac9423d85285315227603-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85285315227603-8"><span class="crayon-p"># ps -o pid,psr,comm $(pgrep kworker)</span></div><div class="crayon-line" id="crayon-5ac9423d85285315227603-9"><span class="crayon-e">PID  </span><span class="crayon-e">PSR </span><span class="crayon-i">COMMAND</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85285315227603-10"><span class="crayon-h">   </span><span class="crayon-cn">4</span><span class="crayon-h">   </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-v">kworker</span><span class="crayon-o">/</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">0H</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5ac9423d85285315227603-11"><span class="crayon-h">  </span><span class="crayon-cn">18</span><span class="crayon-h">   </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-v">kworker</span><span class="crayon-o">/</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-cn">0H</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85285315227603-12"><span class="crayon-h">  </span><span class="crayon-cn">24</span><span class="crayon-h">   </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-v">kworker</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-cn">0H</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5ac9423d85285315227603-13"><span class="crayon-h">  </span><span class="crayon-cn">30</span><span class="crayon-h">   </span><span class="crayon-cn">3</span><span class="crayon-h"> </span><span class="crayon-v">kworker</span><span class="crayon-o">/</span><span class="crayon-cn">3</span><span class="crayon-o">:</span><span class="crayon-cn">0H</span></div><div class="crayon-line crayon-striped-line" id="crayon-5ac9423d85285315227603-14"><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5ac9423d85285315227603-15"> </div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>其中，PSR 字段代表“处理器processor”。每个核还必须拥有自己的定时器和 <code>cpuhp</code> 热插拔处理程序。</p>
<p>那么用户空间是如何启动的呢？在最后，<code>kernel_init()</code> 寻找可以代表它执行 <code>init</code> 进程的 <code>initrd</code>。如果没有找到，内核直接执行 <code>init</code> 本身。那么为什么需要 <code>initrd</code> 呢？</p>
<h4 id="toc_10">早期的用户空间：谁规定要用 initrd？</h4>
<p>除了设备树之外，在启动时可以提供给内核的另一个文件路径是 <code>initrd</code> 的路径。<code>initrd</code> 通常位于 <code>/boot</code> 目录中，与 x86 系统中的 bzImage 文件 vmlinuz 一样，或是与 ARM 系统中的 uImage 和设备树相同。用 <code>initramfs-tools-core</code> 软件包中的 <code>lsinitramfs</code> 工具可以列出 <code>initrd</code> 的内容。发行版的 <code>initrd</code> 方案包含了最小化的 <code>/bin</code>、<code>/sbin</code> 和 <code>/etc</code> 目录以及内核模块，还有 <code>/scripts</code> 中的一些文件。所有这些看起来都很熟悉，因为 <code>initrd</code> 大致上是一个简单的最小化 Linux 根文件系统。看似相似，其实不然，因为位于虚拟内存盘中的 <code>/bin</code> 和 <code>/sbin</code> 目录下的所有可执行文件几乎都是指向 <a href="https://www.mjmwired.net/kernel/Documentation/acpi/initrd_table_override.txt">BusyBox 二进制文件</a> 的符号链接，由此导致 <code>/bin</code> 和 <code>/sbin</code> 目录比 glibc 的小 10 倍。</p>
<p>如果要做的只是加载一些模块，然后在普通的根文件系统上启动 <code>init</code>，为什么还要创建一个 <code>initrd</code> 呢？想想一个加密的根文件系统，解密可能依赖于加载一个位于根文件系统 <code>/lib/modules</code> 的内核模块，当然还有 <code>initrd</code> 中的。加密模块可能被静态地编译到内核中，而不是从文件加载，但有多种原因不希望这样做。例如，用模块静态编译内核可能会使其太大而不能适应存储空间，或者静态编译可能会违反软件许可条款。不出所料，存储、网络和人类输入设备（HID）驱动程序也可能存在于 <code>initrd</code> 中。<code>initrd</code> 基本上包含了任何挂载根文件系统所必需的非内核代码。<code>initrd</code> 也是用户存放 <a href="https://www.mjmwired.net/kernel/Documentation/acpi/initrd_table_override.txt">自定义ACPI</a> 表代码的地方。</p>
<p><img class="aligncenter" title="Rescue shell and a custom &lt;code&gt;initrd&lt;/code&gt;." src="http://jbcdn2.b0.upaiyun.com/2018/03/610e633892133afdd175eab9e33620d8.png" alt="Rescue shell and a custom &lt;code&gt;initrd&lt;/code&gt;."></p>
<p style="text-align: center"><em>救援模式的 shell 和自定义的 <code>initrd</code> 还是很有意思的。</em></p>
<p><code>initrd</code> 对测试文件系统和数据存储设备也很有用。将这些测试工具存放在 <code>initrd</code> 中，并从内存中运行测试，而不是从被测对象中运行。</p>
<p>最后，当 <code>init</code> 开始运行时，系统就启动啦！由于第二个处理器现在在运行，机器已经成为我们所熟知和喜爱的异步、可抢占、不可预测和高性能的生物。的确，<code>ps -o pid,psr,comm -p 1</code> 很容易显示用户空间的 <code>init</code> 进程已不在引导处理器上运行了。</p>
<h3 id="toc_11">总结</h3>
<p>Linux 引导过程听起来或许令人生畏，即使是简单嵌入式设备上的软件数量也是如此。但换个角度来看，启动过程相当简单，因为启动中没有抢占、RCU 和竞争条件等扑朔迷离的复杂功能。只关注内核和 PID 1 会忽略了引导程序和辅助处理器为运行内核执行的大量准备工作。虽然内核在 Linux 程序中是独一无二的，但通过一些检查 ELF 文件的工具也可以了解其结构。学习一个正常的启动过程，可以帮助运维人员处理启动的故障。</p>
<p>要了解更多信息，请参阅 Alison Chaiken 的演讲——<a href="https://rego.linux.conf.au/schedule/presentation/16/">Linux: The first second</a>，已于 1 月 22 日至 26 日在悉尼举行。参见 <a href="https://linux.conf.au/index.html">linux.conf.au</a>。</p>
<p>感谢 <a href="http://shallowsky.com/">Akkana Peck</a> 的提议和指正。</p>
<p> </p>

        
        
        
    <div class="post-adds">
        <span data-post-id="113768" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113768votetotal">1</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113768" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 5 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i> 1 评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《Linux 启动过程分析》",
	pic:"http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="给初学者的 type 命令教程" target="_blank" href="http://blog.jobbole.com/113817/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">给初学者的 type 命令教程</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="为初学者准备的 ln 命令教程（5 个示例）" target="_blank" href="http://blog.jobbole.com/113800/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">为初学者准备的 ln 命令教程（5 个示例）</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="如何在 Linux 上安装应用程序" target="_blank" href="http://blog.jobbole.com/113793/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">如何在 Linux 上安装应用程序</a>
                         · <a href="http://blog.jobbole.com/113793/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="Linux 中的“大内存页”（hugepage）是个什么？" target="_blank" href="http://blog.jobbole.com/113782/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">Linux 中的“大内存页”（hugepage）是个什么？</a>
                                            </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="du 及 df 命令的使用（附带示例）" target="_blank" href="http://blog.jobbole.com/113780/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">du 及 df 命令的使用（附带示例）</a>
                                            </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113768/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113768%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113768%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113768%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113768%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113768%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

                    <h5 id="comments" class="sub-title"><i class="glyphicon"></i>最新评论</h5>
            <ul class="cmnt-list">

                        <li id="comment-162376" class="comment cmnt odd">
    
    <div class="cmnt-box">
        <div class="cmnt-header">
                            <a href="http://www.jobbole.com/members/q4066793751" class="cmnt-img"><img width="37" height="37" src="http://q.qlogo.cn/qqapp/208656/786427CB086A3E9D96847EC7398A10B3/100" alt=""></a>
                <div class="cmnt-meta">
                    <span><a href="http://www.jobbole.com/members/q4066793751">┾Bad guy ゞ°</a><label class="comment_author_data"> </label></span>
                    <span class="c-title">
                                             </span>

                    <span class="c-date">
                        <a href="http://blog.jobbole.com/113768/#comment-162376">6 天前</a>
                    </span>

                    
                    
                </div>
                    </div>
        <div class="cmnt-body">
            <p>
                </p><p>说的太好了</p>
            
                    </div>
                    <div class="cmnt-footer">

                
                <p class="c-like">
                    <a title="赞同" alt="赞同" class="162376voteflag  t-up  href-style vote-comment-up  register-user-only   " data-comment-id="162376"><i class="fa fa-thumbs-o-up"></i> <span id="162376voteuptotal"> 赞</span></a>

                    
                    <a rel="nofollow" class="comment-reply-link register-user-only" href="http://blog.jobbole.com/113768/?replytocom=162376#respond" data-onclick='return addComment.moveForm( "comment-162376", "162376", "respond", "113768" )' aria-label="回复给┾Bad guy ゞ°">回复 <i class="fa fa-reply"></i></a>
                </p>
            </div>
            </div>
    </li>
<!-- #comment-## -->
            </ul>
        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113768/
url_object_id:20d0b326ed26dff7f3c5708bdf46c1a5
front_image_url:['http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg']
front_image_path:full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg
tag:IT技术-Linux









title:刚开始学编程？这几款小工具能让你事半功倍
create_date:2018/03/26
praise_nums:2
fav_nums:6
comments_nums:1
content:<div class="grid-8">

		
	<!-- BEGIN .post -->
<div class="post-113785 post type-post status-publish format-standard hentry category-it-tech tag-web tag-389 odd" id="post-113785">
	
	<!-- BEGIN .entry-header -->
	<div class="entry-header">
	
				
		<h1>刚开始学编程？这几款小工具能让你事半功倍</h1>
		
							
	</div>
	<!-- BEGIN .entry-header -->
	
	<!-- BEGIN .entry-meta -->
	<div class="entry-meta">
	
		<p class="entry-meta-hide-on-mobile">

            2018/03/26 ·  <a href="http://blog.jobbole.com/category/it-tech/" rel="category tag">IT技术</a>
            
                            · <a href="#article-comment"> 1 评论 </a>
            

            
             ·  <a href="http://blog.jobbole.com/tag/web%e5%89%8d%e7%ab%af/">Web前端</a>, <a href="http://blog.jobbole.com/tag/%e7%bc%96%e7%a8%8b/">编程</a>
            
</p>

<!-- JiaThis Button BEGIN -->
<div class="jiathis_style" style="display: block; margin: 0 0px; clear: both;"><span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_fb"></a>
<a class="jiathis_button_douban"></a>
<a class="jiathis_button_readitlater"></a>
<a class="jiathis_button_evernote"></a>
<a class="jiathis_button_ydnote"></a>
<a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"></a>
</div>
<!-- JiaThis Button END -->


	</div>
	<!-- END .entry-meta -->

	<!-- BEGIN .entry -->
	<div class="entry">

        			<div class="textwidget"></div>
		
		<div class="copyright-area">原文出处： <a ref="nofollow" target="_blank" href="https://medium.freecodecamp.org/tools-i-wish-i-had-known-about-when-i-started-coding-57849efd9248">Mario Hoyos</a>   译文出处：<a target="_blank" href="http://36kr.com/p/5121154.html">36氪</a>   </div><p><img src="https://pic.36krcnd.com/201803/10141844/8fkz2ekh01zhphjt.jpeg!1200" alt="åå¼å§å­¦ç¼ç¨ï¼è¿å æ¬¾å°å·¥å·è½è®©ä½ äºååå"></p>
<p>科技行业里，可供人们使用的工具成百上千，你要怎么知道用哪一种上手最合适呢？</p>
<p>拿最近刚进入编程这行的人来说吧，大量的工具信息堆砌过来其实毫无益处，反而会无从下手。我发现在自己的开发过程中，很多安装的扩展工具不仅没有真正起到助益作用，反而常常妨碍了正常的开发工作。</p>
<p>我不是专家，不过随着时间的推移，我还是编制了一份工具清单，这些工具已经证明对我非常有用。如果你刚刚开始学习怎么编程的话，这个清单能给你提供一些指导。如果你是个经验丰富的开发人员，也希望你能从中学到一些新的东西。</p>
<p>我将把这篇文章分为Chrome扩展程序和VS代码扩展扩展程序两部分。我知道还有其他的浏览器和文本编辑器，但是我想你当然只能在你能找到的工具里选择，所以还是别因为个人喜好而引起一场宗教般的争论。</p>
<p>请随便选。</p>
<h3>Chrome扩展程序</h3>
<p><span class="load-html-img loaded"><img src="http://jbcdn2.b0.upaiyun.com/2018/03/8b4aab0d40f4316375f7cd578ff0286e.jpeg" alt="刚开始学编程？这几款小工具能让你事半功倍"></span></p>
<p>现在设我是一位web开发人员，以Chrome为阵地。下面是一些能让我少花点时间的工具：</p>
<ul class=" list-paddingleft-2">
<li><a href="https://chrome.google.com/webstore/detail/whatfont/jabopobgcpjmedljpbcaablpmlmfcogm?hl=en">WhatFont</a> —— 名字就说明了一切。这是找出你最喜欢网站使用的字体的简单方法，这样你就可以为己所用了。</li>
<li><a href="https://chrome.google.com/webstore/detail/pesticide-for-chrome/bblbgcheenepgnnajgfpiicnbbdmmooh?hl=en">Pesticide</a>—— 修改CSS的绝佳程序。当我试着学习匣子模型的时候，它简直就是救命稻草般的存在。</li>
<li><a href="https://chrome.google.com/webstore/detail/colorzilla/bhlhnicpbhignbdhedgjhgdocnmhomnp?hl=en">Colorzilla</a> ——用于复制确切颜色的一个网站，用它可以将颜色直接复制到剪贴板上，这样你就没必要花太多时间获得正确的RGBA组合了。</li>
<li><a href="https://chrome.google.com/webstore/detail/css-peeper/mbnbehikldjhnfehhnaidhjhoofhpehk?hl=en">CSS Peeper</a>——查看网站使用的颜色时非常方便。在你一开始山寨你认为酷的网站的时候很管用。这个程序能让你查看它们的幕后的色彩方案。</li>
<li><a href="https://chrome.google.com/webstore/detail/wappalyzer/gppongmhjkpfnbhagpmjfkannfbllamg?hl=en">Wappalyzer</a> ——想要获悉你在网站上看到的是什么技术，这个程序很有用。想知道某网站使用什么样的框架或者它承载了什么服务？这个照样管用。</li>
<li><a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en">React Dev Tools</a>——一款用于调试应用程序的工具。有一点要提一下，它只有在你编写React程序时才有用。</li>
<li><a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=en">Redux Dev Tools</a>——一款用于调试应用程序的工具。有一点要提一下，它只有在你编写Redux程序时才有用。</li>
<li><a href="https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=en">JSON Formatter</a> ——让JSON在浏览器中看起来更一目了然的不二之选。也许麻烦的JSON让你苦不堪言，不过只要用了这个软件，找到你要找的东西，所花费的时间会大幅缩短。</li>
<li><a href="https://chrome.google.com/webstore/detail/vimeo-repeat-speed/noonakfaafcdaagngpjehilgegefdima?hl=en">Vimeo Repeat and Speed</a> ——加速Vimeo视频的绝佳工具。如果你像大多数的web开发人员一样观看视频教程，你就会知道用1.25倍的常规回放速度观看它们是多么的方便。本程序同时也有适用于YouTube的版本。</li>
</ul>
<h3>VS Code扩展程序</h3>
<p><span class="load-html-img loaded"><img src="http://jbcdn2.b0.upaiyun.com/2018/03/6f53b4a3d95c1c5b648380d21c6e90fa.jpeg" alt="刚开始学编程？这几款小工具能让你事半功倍"></span></p>
<p>Visual Studio Code是我写代码时的不二之选。</p>
<p>每个人都有他自己喜欢的文本编辑器，我也不例外。不过，我还是想把这些扩展程序介绍给你，而它们对你所使用的大多数编辑器都适用。看看我最喜欢的扩展程序有哪些：</p>
<ul class=" list-paddingleft-2">
<li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-rename-tag">Auto Rename Tag </a>——自动重命名成对的HTML标记。假如你创建了一个&lt;p&gt;标记。现在你想更改它。有了这个软件，你只需要更改一个就行，另一个会自动修改。从理论上来说，使用这个软件可以把你的工作效率提升一倍。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ecmel.vscode-html-css">HTML CSS Support</a> ——HTML文档的CSS支持工具。该工具在获得一些简洁的语法高亮显示和代码建议方面非常有用。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=abusaidm.html-snippets">HTML Snippets</a> ——这一工具在代码分段方面非常有用，可以为你节省大量的时间。它能跟Emmet配对，这样一来你甚至都不用再真正键入HTML了。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=dzannotti.vscode-babel-coloring">Babel ES6/ES7</a> ——JavaScript Babel的辅助工具。如果你用的是Babel，这个工具可以让你更容易区分代码。如果你喜欢JavaScript，那务必也不要错过这款软件。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer">Bracket Pair Colorizer </a>——色彩可视化工具。如果你没有准确地括号，那这个工具对于发现因此导致的许多常见漏洞十分方便。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">ESLint </a>——你在编写代码的时候，利用这个软件可以轻易获取有关漏洞的提示，而且在编码过程中，它还可以帮助你养成良好的编码习惯。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=spywhere.guides">Guides</a> ——这一工具可以被用来添加额外的指导行代码。这是另一个视觉提示，以确保你正确地括号了。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=whtouche.vscode-js-console-utils">JavaScript Console Utils </a>——使控制台日志记录变得更为简单可行。如果你像大多数开发人员一样，你会发现自己需要在调试流中登录到控制台（我知道我们应该使用调试器）。这个实用的程序使得创建有用的console.log()语句变得易如反掌。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker">Code Spell Checker</a> ——这一工具正如其名，是拼写检查程序。漏洞的的另一个常见来源是变量或函数名。这一拼写检查工具可以查找不常见的单词，而且还可以把我们用JavaScript编写的东西进行有效的审核。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens">Git Lens</a> ——可以让我们对某文件何时、以及由何人进行更改变得一目了然。当代码被破坏时，我们就能找到该负责任的人，而不是让你当替罪羊了。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense">Path Intellisense</a> ——文件路径自动完成程序。这样一来从其他文件中导入重要的东西就非常方便了。这一工具使文件导航变得轻而易举。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">Prettier </a>——自动代码格式化程序。忘掉那些你不得不手动缩进代码的日子吧，有了这个工具，事情就变得简单多啦。这个程序会比你自己做得更快更好。对这个程序我是鼎力推荐的。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=robertohuertasm.vscode-icons">VSCode-Icons</a> ——将图标添加到文件谱中。如果文件结构非常不科学，你的眼睛想罢工的话，这个程序可能会有所帮助。它对于你正在制作的任何文件都能提供有用的图标辅助，能使你更为轻易地区分看到的内容。</li>
</ul>
<h3>总结</h3>
<p>你肯定也有自己中意的工具，这些工具对你的开发工作来说是必不可少的。也希望我上面提到的一些工具能够提高你的工作效率。</p>
<p>但是千万不要落入贪多不烂的陷阱，因为它可能耗费很多时间。</p>
<p>希望你能在评论区留下你最喜欢的工具，这样我们就可以共同进步了。</p>

        
        
        
    <div class="post-adds">
        <span data-post-id="113785" class=" btn-bluet-bigger href-style vote-post-up   register-user-only "><i class="fa  fa-thumbs-o-up"></i> <h10 id="113785votetotal">2</h10> 赞</span>
        <span data-book-type="1" data-site-id="2" data-item-id="113785" data-item-type="1" class=" btn-bluet-bigger href-style bookmark-btn  register-user-only "><i class="fa fa-bookmark-o  "></i> 6 收藏</span>

                    <a href="#article-comment"><span class="btn-bluet-bigger href-style hide-on-480"><i class="fa fa-comments-o"></i> 1 评论</span></a>
        
        
        
        <!-- JiaThis Button BEGIN -->
        <div class="jiathis_style_24x24" style="display: inline-flex; position: relative; margin: 0; clear: both;float: right;">
            <a class="jiathis_button_tsina"></a>
            <a class="jiathis_button_weixin"></a>
            <a class="jiathis_button_qzone"></a>
            <a class="jiathis_button_fb hide-on-480"></a>
            <a href="http://www.jiathis.com/share?uid=1745061" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
        </div>

    </div>




        <!-- BEGIN #author-bio -->


<!-- END #author-bio -->
	</div>
	<!-- END .entry -->


<script type="text/javascript">
var jiathis_config={
	data_track_clickback:false,
	title:"分享从伯乐在线看到的一篇好文章 ",
	summary:"《刚开始学编程？这几款小工具能让你事半功倍》",
	pic:"https://pic.36krcnd.com/201803/10141844/8fkz2ekh01zhphjt.jpeg!1200",
	appkey:{
         "tsina": 1473879058    },
	ralateuid:{
		"tsina": 1670481425	},
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1745061" charset="utf-8"></script>
<!-- JiaThis Button END -->
			<div class="textwidget"><p><a href="http://group.jobbole.com/22945/" target="_blank"><img src="http://wx4.sinaimg.cn/mw690/bfdcef89gy1fknwaqrq59j20h803caau.jpg"></a></p>
</div>
		
</div>
<!-- END .post -->
            <div style="text-align: left;">
            <h3>相关文章</h3>
            <ul style="font-size: 13px; list-style: disc inside;">
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="不要浪费时间写完美的代码" target="_blank" href="http://blog.jobbole.com/112564/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">不要浪费时间写完美的代码</a>
                         · <a href="http://blog.jobbole.com/112564/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="如何向 6 岁的孩子解释何为编程" target="_blank" href="http://blog.jobbole.com/112375/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">如何向 6 岁的孩子解释何为编程</a>
                         · <a href="http://blog.jobbole.com/112375/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="编程趋势：21 个热门和 21 个要降温的" target="_blank" href="http://blog.jobbole.com/112238/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">编程趋势：21 个热门和 21 个要降温的</a>
                         · <a href="http://blog.jobbole.com/112238/#comments" target="_blank"><i class="fa fa-comments-o"></i> 1</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="什么是现代化编程？" target="_blank" href="http://blog.jobbole.com/112071/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">什么是现代化编程？</a>
                         · <a href="http://blog.jobbole.com/112071/#comments" target="_blank"><i class="fa fa-comments-o"></i> 4</a>                    </span>
                    </li>
                                    <li>
                    <span class="digg-item-updated-title">
                        <a title="写给自学者的入门指南" target="_blank" href="http://blog.jobbole.com/112052/?utm_source=blog.jobbole.com&amp;utm_medium=relatedPosts">写给自学者的入门指南</a>
                         · <a href="http://blog.jobbole.com/112052/#comments" target="_blank"><i class="fa fa-comments-o"></i> 3</a>                    </span>
                    </li>
                            </ul>
        </div>
    
    
<div style="text-align: left;">
    <h3>可能感兴趣的话题</h3>
    <ul style="font-size: 13px; list-style: disc inside;">
                        <li>
                    <a href="http://group.jobbole.com/33039/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实现方式 (16kb)" target="_blank">Eng  ---  React ,Vue ,Angular全家桶套餐外的另一种超轻量级实...</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/33038/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="28岁刚入门，靠谱不？" target="_blank">28岁刚入门，靠谱不？</a>
                     · <a href="http://group.jobbole.com/33038/#comments" target="_blank"><i class="fa fa-comments-o"></i> 7</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32985/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作四年，该如何晋级架构师？" target="_blank">工作四年，该如何晋级架构师？</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32958/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="java 的nio和网络编程nio 的区别" target="_blank">java 的nio和网络编程nio 的区别</a>
                                    </li>
                            <li>
                    <a href="http://group.jobbole.com/32933/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……" target="_blank">工作压力大，然后出错多。。然后工作压力大。该怎么调整自己的状态……</a>
                     · <a href="http://group.jobbole.com/32933/#comments" target="_blank"><i class="fa fa-comments-o"></i> 5</a>                </li>
                            <li>
                    <a href="http://group.jobbole.com/32879/?utm_source=blog.jobbole.com&amp;utm_medium=article-related-group-topic" title="是去北上广深闯几年还是留在二线城市？" target="_blank">是去北上广深闯几年还是留在二线城市？</a>
                     · <a href="http://group.jobbole.com/32879/#comments" target="_blank"><i class="fa fa-comments-o"></i> 2</a>                </li>
                </ul>
</div>
	
            <div id="article-comment" class="dot-box center-align">

                        <a href="http://www.jobbole.com/login?redirect=http://blog.jobbole.com/113785/"><button type="button" class="btn btn-non-transparent">登录后评论</button></a>
            
            <a target="_blank" href="http://www.jobbole.com/register"><button type="button" class="btn btn-primary">新用户注册</button></a>

            <br><br>
            <span>直接登录</span>
            <style type="text/css">.t_login_text{margin:0; padding:0;}.t_login_button{margin:0; padding: 5px 0;}.t_login_button a{margin:0; padding-right:3px; line-height:25px}.t_login_button img{display:inline; border:none;}</style><!-- 使用社交帐号登录 来自 WordPress连接微博 插件 --><span class="connectBox1 t_login_button"><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=weixin&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113785%2F" title="微信" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_weixin.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=qzone&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113785%2F" title="QQ" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_qzone.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=sina&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113785%2F" title="新浪微博" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_sina.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=douban&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113785%2F" title="豆瓣" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_douban.png"></a><a href="http://blog.jobbole.com/wp-content/plugins/wp-connect/login.php?go=github&amp;redirect_url=http%3A%2F%2Fblog.jobbole.com%2F113785%2F" title="GitHub" rel="nofollow"><img src="http://blog.jobbole.com/wp-content/plugins/wp-connect/images/login/btn_github.png"></a></span>        </div>
    

    <div id="comment_list" class="comments">

                    <h5 id="comments" class="sub-title"><i class="glyphicon"></i>最新评论</h5>
            <ul class="cmnt-list">

                        <li id="comment-162358" class="comment cmnt odd">
    
    <div class="cmnt-box">
        <div class="cmnt-header">
                            <a href="http://www.jobbole.com/members/evolighting" class="cmnt-img"><img width="37" height="37" src="http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png" alt=""></a>
                <div class="cmnt-meta">
                    <span><a href="http://www.jobbole.com/members/evolighting">evolighting</a><label class="comment_author_data"> （ <a title="声望值" target="_blank" href="http://www.jobbole.com/members/evolighting/reputation/"><i class="fa fa-graduation-cap"></i> 1</a> ）</label></span>
                    <span class="c-title">
                        master                    </span>

                    <span class="c-date">
                        <a href="http://blog.jobbole.com/113785/#comment-162358">03/26</a>
                    </span>

                    
                    
                </div>
                    </div>
        <div class="cmnt-body">
            <p>
                </p><p>刚开始学编程？</p>
<p>那么你就不应该去碰chrome和vscode这种有着深刻的“巨头”背景的东西；</p>
<p> </p>
<p>当然，这取决于你的目的的和价值观，如果只想挣钱，当巨头的走狗对一无所有的人来说确实是最快的</p>
            
                    </div>
                    <div class="cmnt-footer">

                
                <p class="c-like">
                    <a title="赞同" alt="赞同" class="162358voteflag  t-up  href-style vote-comment-up  register-user-only   " data-comment-id="162358"><i class="fa fa-thumbs-o-up"></i> <span id="162358voteuptotal">1 赞</span></a>

                    
                    <a rel="nofollow" class="comment-reply-link register-user-only" href="http://blog.jobbole.com/113785/?replytocom=162358#respond" data-onclick='return addComment.moveForm( "comment-162358", "162358", "respond", "113785" )' aria-label="回复给evolighting">回复 <i class="fa fa-reply"></i></a>
                </p>
            </div>
            </div>
    </li>
<!-- #comment-## -->
            </ul>
        
    </div>
		

	
</div>
url:http://blog.jobbole.com/113785/
url_object_id:86a8795768a1192f6a4d22bbb49ab0d7
front_image_url:['https://pic.36krcnd.com/201803/10141844/8fkz2ekh01zhphjt.jpeg!1200']
front_image_path:full/4f40ac43ac01e64e0f4b96cceb82a2b2bd8898a3.jpg
tag:IT技术-Web前端-编程









